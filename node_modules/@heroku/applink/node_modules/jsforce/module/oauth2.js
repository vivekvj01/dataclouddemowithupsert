import _Object$defineProperty from "@babel/runtime-corejs3/core-js-stable/object/define-property";
import _Object$defineProperties from "@babel/runtime-corejs3/core-js-stable/object/define-properties";
import _Object$getOwnPropertyDescriptors from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptors";
import _forEachInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/for-each";
import _Object$getOwnPropertyDescriptor from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptor";
import _filterInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/filter";
import _Object$getOwnPropertySymbols from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-symbols";
import _Object$keys from "@babel/runtime-corejs3/core-js-stable/object/keys";
import "core-js/modules/es.promise";
import "core-js/modules/es.string.replace";
import _indexOfInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/index-of";
import _sliceInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/slice";
import _defineProperty from "@babel/runtime-corejs3/helpers/defineProperty";
function ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = _filterInstanceProperty(symbols).call(symbols, function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }
function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { var _context3; _forEachInstanceProperty(_context3 = ownKeys(Object(source), true)).call(_context3, function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { var _context4; _forEachInstanceProperty(_context4 = ownKeys(Object(source))).call(_context4, function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }
/**
 *
 */
import { createHash, randomBytes } from 'crypto';
import querystring from 'querystring';
import Transport, { XdProxyTransport, HttpProxyTransport } from './transport';
const defaultOAuth2Config = {
  loginUrl: 'https://login.salesforce.com'
};

// Makes a nodejs base64 encoded string compatible with rfc4648 alternative encoding for urls.
// @param base64Encoded a nodejs base64 encoded string
function base64UrlEscape(base64Encoded) {
  // builtin node js base 64 encoding is not 64 url compatible.
  // See https://toolsn.ietf.org/html/rfc4648#section-5
  return base64Encoded.replace(/\+/g, '-').replace(/\//g, '_').replace(/=/g, '');
}

/**
 * type defs
 */

/**
 * OAuth2 class
 */
export class OAuth2 {
  /**
   *
   */
  constructor(config) {
    _defineProperty(this, "loginUrl", void 0);
    _defineProperty(this, "authzServiceUrl", void 0);
    _defineProperty(this, "tokenServiceUrl", void 0);
    _defineProperty(this, "revokeServiceUrl", void 0);
    _defineProperty(this, "clientId", void 0);
    _defineProperty(this, "clientSecret", void 0);
    _defineProperty(this, "redirectUri", void 0);
    _defineProperty(this, "codeVerifier", void 0);
    _defineProperty(this, "_transport", void 0);
    const {
      loginUrl,
      authzServiceUrl,
      tokenServiceUrl,
      revokeServiceUrl,
      clientId,
      clientSecret,
      redirectUri,
      proxyUrl,
      httpProxy,
      useVerifier
    } = config;
    if (authzServiceUrl && tokenServiceUrl) {
      var _context;
      this.loginUrl = _sliceInstanceProperty(_context = authzServiceUrl.split('/')).call(_context, 0, 3).join('/');
      this.authzServiceUrl = authzServiceUrl;
      this.tokenServiceUrl = tokenServiceUrl;
      this.revokeServiceUrl = revokeServiceUrl || `${this.loginUrl}/services/oauth2/revoke`;
    } else {
      this.loginUrl = loginUrl || defaultOAuth2Config.loginUrl;
      this.authzServiceUrl = `${this.loginUrl}/services/oauth2/authorize`;
      this.tokenServiceUrl = `${this.loginUrl}/services/oauth2/token`;
      this.revokeServiceUrl = `${this.loginUrl}/services/oauth2/revoke`;
    }
    this.clientId = clientId;
    this.clientSecret = clientSecret;
    this.redirectUri = redirectUri;
    if (proxyUrl) {
      this._transport = new XdProxyTransport(proxyUrl);
    } else if (httpProxy) {
      this._transport = new HttpProxyTransport(httpProxy);
    } else {
      this._transport = new Transport();
    }
    if (useVerifier) {
      // Set a code verifier string for OAuth authorization
      this.codeVerifier = base64UrlEscape(randomBytes(Math.ceil(128)).toString('base64'));
    }
  }

  /**
   * Get Salesforce OAuth2 authorization page URL to redirect user agent.
   */
  getAuthorizationUrl(params = {}) {
    var _context2;
    if (this.codeVerifier) {
      // code verifier must be a base 64 url encoded hash of 128 bytes of random data. Our random data is also
      // base 64 url encoded. See Connection.create();
      const codeChallenge = base64UrlEscape(createHash('sha256').update(this.codeVerifier).digest('base64'));
      params.code_challenge = codeChallenge;
    }
    const _params = _objectSpread(_objectSpread({}, params), {}, {
      response_type: 'code',
      client_id: this.clientId,
      redirect_uri: this.redirectUri
    });
    return this.authzServiceUrl + (_indexOfInstanceProperty(_context2 = this.authzServiceUrl).call(_context2, '?') >= 0 ? '&' : '?') + querystring.stringify(_params);
  }

  /**
   * OAuth2 Refresh Token Flow
   */
  async refreshToken(refreshToken) {
    if (!this.clientId) {
      throw new Error('No OAuth2 client id information is specified');
    }
    const params = {
      grant_type: 'refresh_token',
      refresh_token: refreshToken,
      client_id: this.clientId
    };
    if (this.clientSecret) {
      params.client_secret = this.clientSecret;
    }
    const ret = await this._postParams(params);
    return ret;
  }

  /**
   * Send access token request to the token endpoint.
   * When a code (string) is passed in first argument, it will use Web Server Authentication Flow (Authorization Code Grant).
   * Otherwise, it will use the specified `grant_type` and pass parameters to the endpoint.
   */
  async requestToken(codeOrParams, params = {}) {
    if (typeof codeOrParams === 'string' && (!this.clientId || !this.redirectUri)) {
      throw new Error('No OAuth2 client id or redirect uri configuration is specified');
    }
    const _params = _objectSpread(_objectSpread({}, params), typeof codeOrParams === 'string' ? {
      grant_type: 'authorization_code',
      code: codeOrParams
    } : codeOrParams);
    if (this.clientId) {
      _params.client_id = this.clientId;
    }
    if (this.clientSecret) {
      _params.client_secret = this.clientSecret;
    }
    if (this.redirectUri) {
      _params.redirect_uri = this.redirectUri;
    }
    const ret = await this._postParams(_params);
    return ret;
  }

  /**
   * OAuth2 Username-Password Flow (Resource Owner Password Credentials)
   */
  async authenticate(username, password) {
    if (!this.clientId || !this.clientSecret || !this.redirectUri) {
      throw new Error('No valid OAuth2 client configuration set');
    }
    const ret = await this._postParams({
      grant_type: 'password',
      username,
      password,
      client_id: this.clientId,
      client_secret: this.clientSecret,
      redirect_uri: this.redirectUri
    });
    return ret;
  }

  /**
   * OAuth2 Revoke Session Token
   */
  async revokeToken(token) {
    const response = await this._transport.httpRequest({
      method: 'POST',
      url: this.revokeServiceUrl,
      body: querystring.stringify({
        token
      }),
      headers: {
        'content-type': 'application/x-www-form-urlencoded'
      }
    });
    if (response.statusCode >= 400) {
      let res = querystring.parse(response.body);
      if (!res || !res.error) {
        res = {
          error: `ERROR_HTTP_${response.statusCode}`,
          error_description: response.body
        };
      }
      throw new class extends Error {
        constructor({
          error,
          error_description
        }) {
          super(error_description);
          this.name = error;
        }
      }(res);
    }
  }

  /**
   * @private
   */
  async _postParams(params) {
    if (this.codeVerifier) params.code_verifier = this.codeVerifier;
    const response = await this._transport.httpRequest({
      method: 'POST',
      url: this.tokenServiceUrl,
      body: querystring.stringify(params),
      headers: {
        'content-type': 'application/x-www-form-urlencoded'
      }
    });
    let res;
    try {
      res = JSON.parse(response.body);
    } catch (e) {
      /* eslint-disable no-empty */
    }
    if (response.statusCode >= 400) {
      res = res || {
        error: `ERROR_HTTP_${response.statusCode}`,
        error_description: response.body
      };
      throw new class extends Error {
        constructor({
          error,
          error_description
        }) {
          super(error_description);
          this.name = error;
        }
      }(res);
    }
    return res;
  }
}
export default OAuth2;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjcmVhdGVIYXNoIiwicmFuZG9tQnl0ZXMiLCJxdWVyeXN0cmluZyIsIlRyYW5zcG9ydCIsIlhkUHJveHlUcmFuc3BvcnQiLCJIdHRwUHJveHlUcmFuc3BvcnQiLCJkZWZhdWx0T0F1dGgyQ29uZmlnIiwibG9naW5VcmwiLCJiYXNlNjRVcmxFc2NhcGUiLCJiYXNlNjRFbmNvZGVkIiwicmVwbGFjZSIsIk9BdXRoMiIsImNvbnN0cnVjdG9yIiwiY29uZmlnIiwiX2RlZmluZVByb3BlcnR5IiwiYXV0aHpTZXJ2aWNlVXJsIiwidG9rZW5TZXJ2aWNlVXJsIiwicmV2b2tlU2VydmljZVVybCIsImNsaWVudElkIiwiY2xpZW50U2VjcmV0IiwicmVkaXJlY3RVcmkiLCJwcm94eVVybCIsImh0dHBQcm94eSIsInVzZVZlcmlmaWVyIiwiX2NvbnRleHQiLCJfc2xpY2VJbnN0YW5jZVByb3BlcnR5Iiwic3BsaXQiLCJjYWxsIiwiam9pbiIsIl90cmFuc3BvcnQiLCJjb2RlVmVyaWZpZXIiLCJNYXRoIiwiY2VpbCIsInRvU3RyaW5nIiwiZ2V0QXV0aG9yaXphdGlvblVybCIsInBhcmFtcyIsIl9jb250ZXh0MiIsImNvZGVDaGFsbGVuZ2UiLCJ1cGRhdGUiLCJkaWdlc3QiLCJjb2RlX2NoYWxsZW5nZSIsIl9wYXJhbXMiLCJfb2JqZWN0U3ByZWFkIiwicmVzcG9uc2VfdHlwZSIsImNsaWVudF9pZCIsInJlZGlyZWN0X3VyaSIsIl9pbmRleE9mSW5zdGFuY2VQcm9wZXJ0eSIsInN0cmluZ2lmeSIsInJlZnJlc2hUb2tlbiIsIkVycm9yIiwiZ3JhbnRfdHlwZSIsInJlZnJlc2hfdG9rZW4iLCJjbGllbnRfc2VjcmV0IiwicmV0IiwiX3Bvc3RQYXJhbXMiLCJyZXF1ZXN0VG9rZW4iLCJjb2RlT3JQYXJhbXMiLCJjb2RlIiwiYXV0aGVudGljYXRlIiwidXNlcm5hbWUiLCJwYXNzd29yZCIsInJldm9rZVRva2VuIiwidG9rZW4iLCJyZXNwb25zZSIsImh0dHBSZXF1ZXN0IiwibWV0aG9kIiwidXJsIiwiYm9keSIsImhlYWRlcnMiLCJzdGF0dXNDb2RlIiwicmVzIiwicGFyc2UiLCJlcnJvciIsImVycm9yX2Rlc2NyaXB0aW9uIiwibmFtZSIsImNvZGVfdmVyaWZpZXIiLCJKU09OIiwiZSJdLCJzb3VyY2VzIjpbIi4uL3NyYy9vYXV0aDIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKlxuICovXG5pbXBvcnQgeyBjcmVhdGVIYXNoLCByYW5kb21CeXRlcyB9IGZyb20gJ2NyeXB0byc7XG5pbXBvcnQgcXVlcnlzdHJpbmcgZnJvbSAncXVlcnlzdHJpbmcnO1xuaW1wb3J0IFRyYW5zcG9ydCwgeyBYZFByb3h5VHJhbnNwb3J0LCBIdHRwUHJveHlUcmFuc3BvcnQgfSBmcm9tICcuL3RyYW5zcG9ydCc7XG5pbXBvcnQgeyBPcHRpb25hbCB9IGZyb20gJy4vdHlwZXMnO1xuXG5jb25zdCBkZWZhdWx0T0F1dGgyQ29uZmlnID0ge1xuICBsb2dpblVybDogJ2h0dHBzOi8vbG9naW4uc2FsZXNmb3JjZS5jb20nLFxufTtcblxuLy8gTWFrZXMgYSBub2RlanMgYmFzZTY0IGVuY29kZWQgc3RyaW5nIGNvbXBhdGlibGUgd2l0aCByZmM0NjQ4IGFsdGVybmF0aXZlIGVuY29kaW5nIGZvciB1cmxzLlxuLy8gQHBhcmFtIGJhc2U2NEVuY29kZWQgYSBub2RlanMgYmFzZTY0IGVuY29kZWQgc3RyaW5nXG5mdW5jdGlvbiBiYXNlNjRVcmxFc2NhcGUoYmFzZTY0RW5jb2RlZDogc3RyaW5nKTogc3RyaW5nIHtcbiAgLy8gYnVpbHRpbiBub2RlIGpzIGJhc2UgNjQgZW5jb2RpbmcgaXMgbm90IDY0IHVybCBjb21wYXRpYmxlLlxuICAvLyBTZWUgaHR0cHM6Ly90b29sc24uaWV0Zi5vcmcvaHRtbC9yZmM0NjQ4I3NlY3Rpb24tNVxuICByZXR1cm4gYmFzZTY0RW5jb2RlZFxuICAgIC5yZXBsYWNlKC9cXCsvZywgJy0nKVxuICAgIC5yZXBsYWNlKC9cXC8vZywgJ18nKVxuICAgIC5yZXBsYWNlKC89L2csICcnKTtcbn1cblxuLyoqXG4gKiB0eXBlIGRlZnNcbiAqL1xuZXhwb3J0IHR5cGUgT0F1dGgyQ29uZmlnID0ge1xuICBjbGllbnRJZD86IHN0cmluZztcbiAgY2xpZW50U2VjcmV0Pzogc3RyaW5nO1xuICByZWRpcmVjdFVyaT86IHN0cmluZztcbiAgbG9naW5Vcmw/OiBzdHJpbmc7XG4gIGF1dGh6U2VydmljZVVybD86IHN0cmluZztcbiAgdG9rZW5TZXJ2aWNlVXJsPzogc3RyaW5nO1xuICByZXZva2VTZXJ2aWNlVXJsPzogc3RyaW5nO1xuICBwcm94eVVybD86IHN0cmluZztcbiAgaHR0cFByb3h5Pzogc3RyaW5nO1xuICB1c2VWZXJpZmllcj86IGJvb2xlYW47XG59O1xuXG5leHBvcnQgdHlwZSBBdXRoelJlcXVlc3RQYXJhbXMgPSB7XG4gIHNjb3BlPzogc3RyaW5nO1xuICBzdGF0ZT86IHN0cmluZztcbiAgY29kZV9jaGFsbGVuZ2U/OiBzdHJpbmc7XG59ICYge1xuICBbYXR0cjogc3RyaW5nXTogc3RyaW5nO1xufTtcblxuZXhwb3J0IHR5cGUgVG9rZW5SZXNwb25zZSA9IHtcbiAgdG9rZW5fdHlwZTogJ0JlYXJlcic7XG4gIC8qKlxuICAgKiBJZGVudGl0eSBVUkxcbiAgICpcbiAgICogVGhlIGZvcm1hdCBvZiB0aGUgVVJMIGlzIGh0dHBzOi8vbG9naW4uc2FsZXNmb3JjZS5jb20vaWQvb3JnSUQvdXNlcklELlxuICAgKi9cbiAgaWQ6IHN0cmluZztcbiAgYWNjZXNzX3Rva2VuOiBzdHJpbmc7XG4gIHJlZnJlc2hfdG9rZW4/OiBzdHJpbmc7XG4gIHNpZ25hdHVyZTogc3RyaW5nO1xuICBpc3N1ZWRfYXQ6IHN0cmluZztcbiAgaW5zdGFuY2VfdXJsOiBzdHJpbmc7XG4gIHNmZGNfY29tbXVuaXR5X3VybD86IHN0cmluZztcbiAgc2ZkY19jb21tdW5pdHlfaWQ/OiBzdHJpbmc7XG59O1xuXG4vKipcbiAqIE9BdXRoMiBjbGFzc1xuICovXG5leHBvcnQgY2xhc3MgT0F1dGgyIHtcbiAgbG9naW5Vcmw6IHN0cmluZztcbiAgYXV0aHpTZXJ2aWNlVXJsOiBzdHJpbmc7XG4gIHRva2VuU2VydmljZVVybDogc3RyaW5nO1xuICByZXZva2VTZXJ2aWNlVXJsOiBzdHJpbmc7XG4gIGNsaWVudElkOiBPcHRpb25hbDxzdHJpbmc+O1xuICBjbGllbnRTZWNyZXQ6IE9wdGlvbmFsPHN0cmluZz47XG4gIHJlZGlyZWN0VXJpOiBPcHRpb25hbDxzdHJpbmc+O1xuICBjb2RlVmVyaWZpZXI6IE9wdGlvbmFsPHN0cmluZz47XG5cbiAgX3RyYW5zcG9ydDogVHJhbnNwb3J0O1xuXG4gIC8qKlxuICAgKlxuICAgKi9cbiAgY29uc3RydWN0b3IoY29uZmlnOiBPQXV0aDJDb25maWcpIHtcbiAgICBjb25zdCB7XG4gICAgICBsb2dpblVybCxcbiAgICAgIGF1dGh6U2VydmljZVVybCxcbiAgICAgIHRva2VuU2VydmljZVVybCxcbiAgICAgIHJldm9rZVNlcnZpY2VVcmwsXG4gICAgICBjbGllbnRJZCxcbiAgICAgIGNsaWVudFNlY3JldCxcbiAgICAgIHJlZGlyZWN0VXJpLFxuICAgICAgcHJveHlVcmwsXG4gICAgICBodHRwUHJveHksXG4gICAgICB1c2VWZXJpZmllcixcbiAgICB9ID0gY29uZmlnO1xuICAgIGlmIChhdXRoelNlcnZpY2VVcmwgJiYgdG9rZW5TZXJ2aWNlVXJsKSB7XG4gICAgICB0aGlzLmxvZ2luVXJsID0gYXV0aHpTZXJ2aWNlVXJsLnNwbGl0KCcvJykuc2xpY2UoMCwgMykuam9pbignLycpO1xuICAgICAgdGhpcy5hdXRoelNlcnZpY2VVcmwgPSBhdXRoelNlcnZpY2VVcmw7XG4gICAgICB0aGlzLnRva2VuU2VydmljZVVybCA9IHRva2VuU2VydmljZVVybDtcbiAgICAgIHRoaXMucmV2b2tlU2VydmljZVVybCA9XG4gICAgICAgIHJldm9rZVNlcnZpY2VVcmwgfHwgYCR7dGhpcy5sb2dpblVybH0vc2VydmljZXMvb2F1dGgyL3Jldm9rZWA7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubG9naW5VcmwgPSBsb2dpblVybCB8fCBkZWZhdWx0T0F1dGgyQ29uZmlnLmxvZ2luVXJsO1xuICAgICAgdGhpcy5hdXRoelNlcnZpY2VVcmwgPSBgJHt0aGlzLmxvZ2luVXJsfS9zZXJ2aWNlcy9vYXV0aDIvYXV0aG9yaXplYDtcbiAgICAgIHRoaXMudG9rZW5TZXJ2aWNlVXJsID0gYCR7dGhpcy5sb2dpblVybH0vc2VydmljZXMvb2F1dGgyL3Rva2VuYDtcbiAgICAgIHRoaXMucmV2b2tlU2VydmljZVVybCA9IGAke3RoaXMubG9naW5Vcmx9L3NlcnZpY2VzL29hdXRoMi9yZXZva2VgO1xuICAgIH1cbiAgICB0aGlzLmNsaWVudElkID0gY2xpZW50SWQ7XG4gICAgdGhpcy5jbGllbnRTZWNyZXQgPSBjbGllbnRTZWNyZXQ7XG4gICAgdGhpcy5yZWRpcmVjdFVyaSA9IHJlZGlyZWN0VXJpO1xuICAgIGlmIChwcm94eVVybCkge1xuICAgICAgdGhpcy5fdHJhbnNwb3J0ID0gbmV3IFhkUHJveHlUcmFuc3BvcnQocHJveHlVcmwpO1xuICAgIH0gZWxzZSBpZiAoaHR0cFByb3h5KSB7XG4gICAgICB0aGlzLl90cmFuc3BvcnQgPSBuZXcgSHR0cFByb3h5VHJhbnNwb3J0KGh0dHBQcm94eSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX3RyYW5zcG9ydCA9IG5ldyBUcmFuc3BvcnQoKTtcbiAgICB9XG4gICAgaWYgKHVzZVZlcmlmaWVyKSB7XG4gICAgICAvLyBTZXQgYSBjb2RlIHZlcmlmaWVyIHN0cmluZyBmb3IgT0F1dGggYXV0aG9yaXphdGlvblxuICAgICAgdGhpcy5jb2RlVmVyaWZpZXIgPSBiYXNlNjRVcmxFc2NhcGUoXG4gICAgICAgIHJhbmRvbUJ5dGVzKE1hdGguY2VpbCgxMjgpKS50b1N0cmluZygnYmFzZTY0JyksXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgU2FsZXNmb3JjZSBPQXV0aDIgYXV0aG9yaXphdGlvbiBwYWdlIFVSTCB0byByZWRpcmVjdCB1c2VyIGFnZW50LlxuICAgKi9cbiAgZ2V0QXV0aG9yaXphdGlvblVybChwYXJhbXM6IEF1dGh6UmVxdWVzdFBhcmFtcyA9IHt9KSB7XG4gICAgaWYgKHRoaXMuY29kZVZlcmlmaWVyKSB7XG4gICAgICAvLyBjb2RlIHZlcmlmaWVyIG11c3QgYmUgYSBiYXNlIDY0IHVybCBlbmNvZGVkIGhhc2ggb2YgMTI4IGJ5dGVzIG9mIHJhbmRvbSBkYXRhLiBPdXIgcmFuZG9tIGRhdGEgaXMgYWxzb1xuICAgICAgLy8gYmFzZSA2NCB1cmwgZW5jb2RlZC4gU2VlIENvbm5lY3Rpb24uY3JlYXRlKCk7XG4gICAgICBjb25zdCBjb2RlQ2hhbGxlbmdlID0gYmFzZTY0VXJsRXNjYXBlKFxuICAgICAgICBjcmVhdGVIYXNoKCdzaGEyNTYnKS51cGRhdGUodGhpcy5jb2RlVmVyaWZpZXIpLmRpZ2VzdCgnYmFzZTY0JyksXG4gICAgICApO1xuICAgICAgcGFyYW1zLmNvZGVfY2hhbGxlbmdlID0gY29kZUNoYWxsZW5nZTtcbiAgICB9XG5cbiAgICBjb25zdCBfcGFyYW1zID0ge1xuICAgICAgLi4ucGFyYW1zLFxuICAgICAgcmVzcG9uc2VfdHlwZTogJ2NvZGUnLFxuICAgICAgY2xpZW50X2lkOiB0aGlzLmNsaWVudElkLFxuICAgICAgcmVkaXJlY3RfdXJpOiB0aGlzLnJlZGlyZWN0VXJpLFxuICAgIH07XG4gICAgcmV0dXJuIChcbiAgICAgIHRoaXMuYXV0aHpTZXJ2aWNlVXJsICtcbiAgICAgICh0aGlzLmF1dGh6U2VydmljZVVybC5pbmRleE9mKCc/JykgPj0gMCA/ICcmJyA6ICc/JykgK1xuICAgICAgcXVlcnlzdHJpbmcuc3RyaW5naWZ5KF9wYXJhbXMgYXMgeyBbbmFtZTogc3RyaW5nXTogYW55IH0pXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBPQXV0aDIgUmVmcmVzaCBUb2tlbiBGbG93XG4gICAqL1xuICBhc3luYyByZWZyZXNoVG9rZW4ocmVmcmVzaFRva2VuOiBzdHJpbmcpOiBQcm9taXNlPFRva2VuUmVzcG9uc2U+IHtcbiAgICBpZiAoIXRoaXMuY2xpZW50SWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignTm8gT0F1dGgyIGNsaWVudCBpZCBpbmZvcm1hdGlvbiBpcyBzcGVjaWZpZWQnKTtcbiAgICB9XG4gICAgY29uc3QgcGFyYW1zOiB7IFtwcm9wOiBzdHJpbmddOiBzdHJpbmcgfSA9IHtcbiAgICAgIGdyYW50X3R5cGU6ICdyZWZyZXNoX3Rva2VuJyxcbiAgICAgIHJlZnJlc2hfdG9rZW46IHJlZnJlc2hUb2tlbixcbiAgICAgIGNsaWVudF9pZDogdGhpcy5jbGllbnRJZCxcbiAgICB9O1xuICAgIGlmICh0aGlzLmNsaWVudFNlY3JldCkge1xuICAgICAgcGFyYW1zLmNsaWVudF9zZWNyZXQgPSB0aGlzLmNsaWVudFNlY3JldDtcbiAgICB9XG4gICAgY29uc3QgcmV0ID0gYXdhaXQgdGhpcy5fcG9zdFBhcmFtcyhwYXJhbXMpO1xuICAgIHJldHVybiByZXQgYXMgVG9rZW5SZXNwb25zZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZW5kIGFjY2VzcyB0b2tlbiByZXF1ZXN0IHRvIHRoZSB0b2tlbiBlbmRwb2ludC5cbiAgICogV2hlbiBhIGNvZGUgKHN0cmluZykgaXMgcGFzc2VkIGluIGZpcnN0IGFyZ3VtZW50LCBpdCB3aWxsIHVzZSBXZWIgU2VydmVyIEF1dGhlbnRpY2F0aW9uIEZsb3cgKEF1dGhvcml6YXRpb24gQ29kZSBHcmFudCkuXG4gICAqIE90aGVyd2lzZSwgaXQgd2lsbCB1c2UgdGhlIHNwZWNpZmllZCBgZ3JhbnRfdHlwZWAgYW5kIHBhc3MgcGFyYW1ldGVycyB0byB0aGUgZW5kcG9pbnQuXG4gICAqL1xuICBhc3luYyByZXF1ZXN0VG9rZW4oXG4gICAgY29kZU9yUGFyYW1zOiBzdHJpbmcgfCB7IGdyYW50X3R5cGU6IHN0cmluZzsgW25hbWU6IHN0cmluZ106IHN0cmluZyB9LFxuICAgIHBhcmFtczogeyBbcHJvcDogc3RyaW5nXTogc3RyaW5nIH0gPSB7fSxcbiAgKTogUHJvbWlzZTxUb2tlblJlc3BvbnNlPiB7XG4gICAgaWYgKFxuICAgICAgdHlwZW9mIGNvZGVPclBhcmFtcyA9PT0gJ3N0cmluZycgJiZcbiAgICAgICghdGhpcy5jbGllbnRJZCB8fCAhdGhpcy5yZWRpcmVjdFVyaSlcbiAgICApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgJ05vIE9BdXRoMiBjbGllbnQgaWQgb3IgcmVkaXJlY3QgdXJpIGNvbmZpZ3VyYXRpb24gaXMgc3BlY2lmaWVkJyxcbiAgICAgICk7XG4gICAgfVxuICAgIGNvbnN0IF9wYXJhbXM6IHsgW3Byb3A6IHN0cmluZ106IHN0cmluZyB9ID0ge1xuICAgICAgLi4ucGFyYW1zLFxuICAgICAgLi4uKHR5cGVvZiBjb2RlT3JQYXJhbXMgPT09ICdzdHJpbmcnXG4gICAgICAgID8geyBncmFudF90eXBlOiAnYXV0aG9yaXphdGlvbl9jb2RlJywgY29kZTogY29kZU9yUGFyYW1zIH1cbiAgICAgICAgOiBjb2RlT3JQYXJhbXMpLFxuICAgIH07XG4gICAgaWYgKHRoaXMuY2xpZW50SWQpIHtcbiAgICAgIF9wYXJhbXMuY2xpZW50X2lkID0gdGhpcy5jbGllbnRJZDtcbiAgICB9XG4gICAgaWYgKHRoaXMuY2xpZW50U2VjcmV0KSB7XG4gICAgICBfcGFyYW1zLmNsaWVudF9zZWNyZXQgPSB0aGlzLmNsaWVudFNlY3JldDtcbiAgICB9XG4gICAgaWYgKHRoaXMucmVkaXJlY3RVcmkpIHtcbiAgICAgIF9wYXJhbXMucmVkaXJlY3RfdXJpID0gdGhpcy5yZWRpcmVjdFVyaTtcbiAgICB9XG4gICAgY29uc3QgcmV0ID0gYXdhaXQgdGhpcy5fcG9zdFBhcmFtcyhfcGFyYW1zKTtcbiAgICByZXR1cm4gcmV0IGFzIFRva2VuUmVzcG9uc2U7XG4gIH1cblxuICAvKipcbiAgICogT0F1dGgyIFVzZXJuYW1lLVBhc3N3b3JkIEZsb3cgKFJlc291cmNlIE93bmVyIFBhc3N3b3JkIENyZWRlbnRpYWxzKVxuICAgKi9cbiAgYXN5bmMgYXV0aGVudGljYXRlKFxuICAgIHVzZXJuYW1lOiBzdHJpbmcsXG4gICAgcGFzc3dvcmQ6IHN0cmluZyxcbiAgKTogUHJvbWlzZTxUb2tlblJlc3BvbnNlPiB7XG4gICAgaWYgKCF0aGlzLmNsaWVudElkIHx8ICF0aGlzLmNsaWVudFNlY3JldCB8fCAhdGhpcy5yZWRpcmVjdFVyaSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyB2YWxpZCBPQXV0aDIgY2xpZW50IGNvbmZpZ3VyYXRpb24gc2V0Jyk7XG4gICAgfVxuICAgIGNvbnN0IHJldCA9IGF3YWl0IHRoaXMuX3Bvc3RQYXJhbXMoe1xuICAgICAgZ3JhbnRfdHlwZTogJ3Bhc3N3b3JkJyxcbiAgICAgIHVzZXJuYW1lLFxuICAgICAgcGFzc3dvcmQsXG4gICAgICBjbGllbnRfaWQ6IHRoaXMuY2xpZW50SWQsXG4gICAgICBjbGllbnRfc2VjcmV0OiB0aGlzLmNsaWVudFNlY3JldCxcbiAgICAgIHJlZGlyZWN0X3VyaTogdGhpcy5yZWRpcmVjdFVyaSxcbiAgICB9KTtcbiAgICByZXR1cm4gcmV0IGFzIFRva2VuUmVzcG9uc2U7XG4gIH1cblxuICAvKipcbiAgICogT0F1dGgyIFJldm9rZSBTZXNzaW9uIFRva2VuXG4gICAqL1xuICBhc3luYyByZXZva2VUb2tlbih0b2tlbjogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLl90cmFuc3BvcnQuaHR0cFJlcXVlc3Qoe1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICB1cmw6IHRoaXMucmV2b2tlU2VydmljZVVybCxcbiAgICAgIGJvZHk6IHF1ZXJ5c3RyaW5nLnN0cmluZ2lmeSh7IHRva2VuIH0pLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnY29udGVudC10eXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcsXG4gICAgICB9LFxuICAgIH0pO1xuICAgIGlmIChyZXNwb25zZS5zdGF0dXNDb2RlID49IDQwMCkge1xuICAgICAgbGV0IHJlczogYW55ID0gcXVlcnlzdHJpbmcucGFyc2UocmVzcG9uc2UuYm9keSk7XG4gICAgICBpZiAoIXJlcyB8fCAhcmVzLmVycm9yKSB7XG4gICAgICAgIHJlcyA9IHtcbiAgICAgICAgICBlcnJvcjogYEVSUk9SX0hUVFBfJHtyZXNwb25zZS5zdGF0dXNDb2RlfWAsXG4gICAgICAgICAgZXJyb3JfZGVzY3JpcHRpb246IHJlc3BvbnNlLmJvZHksXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICB0aHJvdyBuZXcgKGNsYXNzIGV4dGVuZHMgRXJyb3Ige1xuICAgICAgICBjb25zdHJ1Y3Rvcih7XG4gICAgICAgICAgZXJyb3IsXG4gICAgICAgICAgZXJyb3JfZGVzY3JpcHRpb24sXG4gICAgICAgIH06IHtcbiAgICAgICAgICBlcnJvcjogc3RyaW5nO1xuICAgICAgICAgIGVycm9yX2Rlc2NyaXB0aW9uOiBzdHJpbmc7XG4gICAgICAgIH0pIHtcbiAgICAgICAgICBzdXBlcihlcnJvcl9kZXNjcmlwdGlvbik7XG4gICAgICAgICAgdGhpcy5uYW1lID0gZXJyb3I7XG4gICAgICAgIH1cbiAgICAgIH0pKHJlcyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBhc3luYyBfcG9zdFBhcmFtcyhwYXJhbXM6IHsgW25hbWU6IHN0cmluZ106IHN0cmluZyB9KTogUHJvbWlzZTxhbnk+IHtcbiAgICBpZiAodGhpcy5jb2RlVmVyaWZpZXIpIHBhcmFtcy5jb2RlX3ZlcmlmaWVyID0gdGhpcy5jb2RlVmVyaWZpZXI7XG5cbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuX3RyYW5zcG9ydC5odHRwUmVxdWVzdCh7XG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIHVybDogdGhpcy50b2tlblNlcnZpY2VVcmwsXG4gICAgICBib2R5OiBxdWVyeXN0cmluZy5zdHJpbmdpZnkocGFyYW1zKSxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ2NvbnRlbnQtdHlwZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnLFxuICAgICAgfSxcbiAgICB9KTtcbiAgICBsZXQgcmVzO1xuICAgIHRyeSB7XG4gICAgICByZXMgPSBKU09OLnBhcnNlKHJlc3BvbnNlLmJvZHkpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIC8qIGVzbGludC1kaXNhYmxlIG5vLWVtcHR5ICovXG4gICAgfVxuICAgIGlmIChyZXNwb25zZS5zdGF0dXNDb2RlID49IDQwMCkge1xuICAgICAgcmVzID0gcmVzIHx8IHtcbiAgICAgICAgZXJyb3I6IGBFUlJPUl9IVFRQXyR7cmVzcG9uc2Uuc3RhdHVzQ29kZX1gLFxuICAgICAgICBlcnJvcl9kZXNjcmlwdGlvbjogcmVzcG9uc2UuYm9keSxcbiAgICAgIH07XG4gICAgICB0aHJvdyBuZXcgKGNsYXNzIGV4dGVuZHMgRXJyb3Ige1xuICAgICAgICBjb25zdHJ1Y3Rvcih7XG4gICAgICAgICAgZXJyb3IsXG4gICAgICAgICAgZXJyb3JfZGVzY3JpcHRpb24sXG4gICAgICAgIH06IHtcbiAgICAgICAgICBlcnJvcjogc3RyaW5nO1xuICAgICAgICAgIGVycm9yX2Rlc2NyaXB0aW9uOiBzdHJpbmc7XG4gICAgICAgIH0pIHtcbiAgICAgICAgICBzdXBlcihlcnJvcl9kZXNjcmlwdGlvbik7XG4gICAgICAgICAgdGhpcy5uYW1lID0gZXJyb3I7XG4gICAgICAgIH1cbiAgICAgIH0pKHJlcyk7XG4gICAgfVxuICAgIHJldHVybiByZXM7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgT0F1dGgyO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQSxTQUFTQSxVQUFVLEVBQUVDLFdBQVcsUUFBUSxRQUFRO0FBQ2hELE9BQU9DLFdBQVcsTUFBTSxhQUFhO0FBQ3JDLE9BQU9DLFNBQVMsSUFBSUMsZ0JBQWdCLEVBQUVDLGtCQUFrQixRQUFRLGFBQWE7QUFHN0UsTUFBTUMs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