import "core-js/modules/es.array.iterator";
import "core-js/modules/es.promise";
import _Array$isArray from "@babel/runtime-corejs3/core-js-stable/array/is-array";
import _Object$keys from "@babel/runtime-corejs3/core-js-stable/object/keys";
import _Date$now from "@babel/runtime-corejs3/core-js-stable/date/now";
import _defineProperty from "@babel/runtime-corejs3/helpers/defineProperty";
/**
 *
 */
import { EventEmitter } from 'events';
import xml2js from 'xml2js';
import { getLogger } from './util/logger';
import { StreamPromise } from './util/promise';
import { parseCSV } from './csv';
import { createLazyStream } from './util/stream';

/** @private */
function parseJSON(str) {
  return JSON.parse(str);
}

/** @private */
async function parseXML(str) {
  return xml2js.parseStringPromise(str, {
    explicitArray: false
  });
}

/** @private */
function parseText(str) {
  return str;
}

/**
 * HTTP based API class with authorization hook
 */
export class HttpApi extends EventEmitter {
  constructor(conn, options) {
    super();
    _defineProperty(this, "_conn", void 0);
    _defineProperty(this, "_logger", void 0);
    _defineProperty(this, "_transport", void 0);
    _defineProperty(this, "_responseType", void 0);
    _defineProperty(this, "_noContentResponse", void 0);
    _defineProperty(this, "_options", void 0);
    this._conn = conn;
    this._logger = conn._logLevel ? HttpApi._logger.createInstance(conn._logLevel) : HttpApi._logger;
    this._responseType = options.responseType;
    this._transport = options.transport || conn._transport;
    this._noContentResponse = options.noContentResponse;
    this._options = options;
  }

  /**
   * Callout to API endpoint using http
   */
  request(request) {
    return StreamPromise.create(() => {
      const {
        stream,
        setStream
      } = createLazyStream();
      const promise = (async () => {
        const refreshDelegate = this.getRefreshDelegate();
        /* TODO decide remove or not this section */
        /*
        // remember previous instance url in case it changes after a refresh
        const lastInstanceUrl = conn.instanceUrl;
         // check to see if the token refresh has changed the instance url
        if(lastInstanceUrl !== conn.instanceUrl){
          // if the instance url has changed
          // then replace the current request urls instance url fragment
          // with the updated instance url
          request.url = request.url.replace(lastInstanceUrl,conn.instanceUrl);
        }
        */
        if (refreshDelegate && refreshDelegate.isRefreshing()) {
          await refreshDelegate.waitRefresh();
          const bodyPromise = this.request(request);
          setStream(bodyPromise.stream());
          const body = await bodyPromise;
          return body;
        }

        // hook before sending
        this.beforeSend(request);
        this.emit('request', request);
        this._logger.debug(`<request> method=${request.method}, url=${request.url}`);
        const requestTime = _Date$now();
        const requestPromise = this._transport.httpRequest(request, this._options);
        setStream(requestPromise.stream());
        let response;
        try {
          response = await requestPromise;
        } catch (err) {
          this._logger.error(err);
          throw err;
        } finally {
          const responseTime = _Date$now();
          this._logger.debug(`elapsed time: ${responseTime - requestTime} msec`);
        }
        if (!response) {
          return;
        }
        this._logger.debug(`<response> status=${String(response.statusCode)}, url=${request.url}`);
        this.emit('response', response);
        // Refresh token if session has been expired and requires authentication
        // when session refresh delegate is available
        if (this.isSessionExpired(response) && refreshDelegate) {
          await refreshDelegate.refresh(requestTime);
          return this.request(request);
        }
        if (this.isErrorResponse(response)) {
          const err = await this.getError(response);
          throw err;
        }
        const body = await this.getResponseBody(response);
        return body;
      })();
      return {
        stream,
        promise
      };
    });
  }

  /**
   * @protected
   */
  getRefreshDelegate() {
    return this._conn._refreshDelegate;
  }

  /**
   * @protected
   */
  beforeSend(request) {
    /* eslint-disable no-param-reassign */
    const headers = request.headers || {};
    if (this._conn.accessToken) {
      headers.Authorization = `Bearer ${this._conn.accessToken}`;
    }
    if (this._conn._callOptions) {
      const callOptions = [];
      for (const name of _Object$keys(this._conn._callOptions)) {
        callOptions.push(`${name}=${this._conn._callOptions[name]}`);
      }
      headers['Sforce-Call-Options'] = callOptions.join(', ');
    }
    request.headers = headers;
  }

  /**
   * Detect response content mime-type
   * @protected
   */
  getResponseContentType(response) {
    return this._responseType || response.headers && response.headers['content-type'];
  }

  /**
   * @private
   */
  async parseResponseBody(response) {
    const contentType = this.getResponseContentType(response) || '';
    const parseBody = /^(text|application)\/xml(;|$)/.test(contentType) ? parseXML : /^application\/json(;|$)/.test(contentType) ? parseJSON : /^text\/csv(;|$)/.test(contentType) ? parseCSV : parseText;
    try {
      return parseBody(response.body);
    } catch (e) {
      return response.body;
    }
  }

  /**
   * Get response body
   * @protected
   */
  async getResponseBody(response) {
    if (response.statusCode === 204) {
      // No Content
      return this._noContentResponse;
    }
    const body = await this.parseResponseBody(response);
    let err;
    if (this.hasErrorInResponseBody(body)) {
      err = await this.getError(response, body);
      throw err;
    }
    if (response.statusCode === 300) {
      // Multiple Choices
      throw new HttpApiError('Multiple records found', 'MULTIPLE_CHOICES', body);
    }
    return body;
  }

  /**
   * Detect session expiry
   * @protected
   */
  isSessionExpired(response) {
    return response.statusCode === 401;
  }

  /**
   * Detect error response
   * @protected
   */
  isErrorResponse(response) {
    return response.statusCode >= 400;
  }

  /**
   * Detect error in response body
   * @protected
   */
  hasErrorInResponseBody(_body) {
    return false;
  }

  /**
   * Parsing error message in response
   * @protected
   */
  parseError(body) {
    const errors = body;
    return _Array$isArray(errors) ? errors[0] : errors;
  }

  /**
   * Get error message in response
   * @protected
   */
  async getError(response, body) {
    let error;
    try {
      error = this.parseError(body || (await this.parseResponseBody(response)));
    } catch (e) {
      // eslint-disable no-empty
    }
    error = typeof error === 'object' && error !== null && typeof error.message === 'string' ? error : {
      errorCode: `ERROR_HTTP_${response.statusCode}`,
      message: response.body
    };
    if (response.headers['content-type'] === 'text/html') {
      this._logger.debug(`html response.body: ${response.body}`);
      return new HttpApiError(`HTTP response contains html content.
Check that the org exists and can be reached.
See error.content for the full html response.`, error.errorCode, error.message);
    }
    return new HttpApiError(error.message, error.errorCode);
  }
}

/**
 *
 */
_defineProperty(HttpApi, "_logger", getLogger('http-api'));
class HttpApiError extends Error {
  constructor(message, errorCode, content) {
    super(message);
    _defineProperty(this, "errorCode", void 0);
    _defineProperty(this, "content", void 0);
    this.name = errorCode || this.name;
    this.errorCode = this.name;
    this.content = content;
  }
}
export default HttpApi;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJFdmVudEVtaXR0ZXIiLCJ4bWwyanMiLCJnZXRMb2dnZXIiLCJTdHJlYW1Qcm9taXNlIiwicGFyc2VDU1YiLCJjcmVhdGVMYXp5U3RyZWFtIiwicGFyc2VKU09OIiwic3RyIiwiSlNPTiIsInBhcnNlIiwicGFyc2VYTUwiLCJwYXJzZVN0cmluZ1Byb21pc2UiLCJleHBsaWNpdEFycmF5IiwicGFyc2VUZXh0IiwiSHR0cEFwaSIsImNvbnN0cnVjdG9yIiwiY29ubiIsIm9wdGlvbnMiLCJfZGVmaW5lUHJvcGVydHkiLCJfY29ubiIsIl9sb2dnZXIiLCJfbG9nTGV2ZWwiLCJjcmVhdGVJbnN0YW5jZSIsIl9yZXNwb25zZVR5cGUiLCJyZXNwb25zZVR5cGUiLCJfdHJhbnNwb3J0IiwidHJhbnNwb3J0IiwiX25vQ29udGVudFJlc3BvbnNlIiwibm9Db250ZW50UmVzcG9uc2UiLCJfb3B0aW9ucyIsInJlcXVlc3QiLCJjcmVhdGUiLCJzdHJlYW0iLCJzZXRTdHJlYW0iLCJwcm9taXNlIiwicmVmcmVzaERlbGVnYXRlIiwiZ2V0UmVmcmVzaERlbGVnYXRlIiwiaXNSZWZyZXNoaW5nIiwid2FpdFJlZnJlc2giLCJib2R5UHJvbWlzZSIsImJvZHkiLCJiZWZvcmVTZW5kIiwiZW1pdCIsImRlYnVnIiwibWV0aG9kIiwidXJsIiwicmVxdWVzdFRpbWUiLCJfRGF0ZSRub3ciLCJyZXF1ZXN0UHJvbWlzZSIsImh0dHBSZXF1ZXN0IiwicmVzcG9uc2UiLCJlcnIiLCJlcnJvciIsInJlc3BvbnNlVGltZSIsIlN0cmluZyIsInN0YXR1c0NvZGUiLCJpc1Nlc3Npb25FeHBpcmVkIiwicmVmcmVzaCIsImlzRXJyb3JSZXNwb25zZSIsImdldEVycm9yIiwiZ2V0UmVzcG9uc2VCb2R5IiwiX3JlZnJlc2hEZWxlZ2F0ZSIsImhlYWRlcnMiLCJhY2Nlc3NUb2tlbiIsIkF1dGhvcml6YXRpb24iLCJfY2FsbE9wdGlvbnMiLCJjYWxsT3B0aW9ucyIsIm5hbWUiLCJfT2JqZWN0JGtleXMiLCJwdXNoIiwiam9pbiIsImdldFJlc3BvbnNlQ29udGVudFR5cGUiLCJwYXJzZVJlc3BvbnNlQm9keSIsImNvbnRlbnRUeXBlIiwicGFyc2VCb2R5IiwidGVzdCIsImUiLCJoYXNFcnJvckluUmVzcG9uc2VCb2R5IiwiSHR0cEFwaUVycm9yIiwiX2JvZHkiLCJwYXJzZUVycm9yIiwiZXJyb3JzIiwiX0FycmF5JGlzQXJyYXkiLCJtZXNzYWdlIiwiZXJyb3JDb2RlIiwiRXJyb3IiLCJjb250ZW50Il0sInNvdXJjZXMiOlsiLi4vc3JjL2h0dHAtYXBpLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICpcbiAqL1xuaW1wb3J0IHsgRXZlbnRFbWl0dGVyIH0gZnJvbSAnZXZlbnRzJztcbmltcG9ydCB4bWwyanMgZnJvbSAneG1sMmpzJztcbmltcG9ydCB7IExvZ2dlciwgZ2V0TG9nZ2VyIH0gZnJvbSAnLi91dGlsL2xvZ2dlcic7XG5pbXBvcnQgeyBTdHJlYW1Qcm9taXNlIH0gZnJvbSAnLi91dGlsL3Byb21pc2UnO1xuaW1wb3J0IENvbm5lY3Rpb24gZnJvbSAnLi9jb25uZWN0aW9uJztcbmltcG9ydCBUcmFuc3BvcnQgZnJvbSAnLi90cmFuc3BvcnQnO1xuaW1wb3J0IHsgcGFyc2VDU1YgfSBmcm9tICcuL2Nzdic7XG5pbXBvcnQge1xuICBIdHRwUmVxdWVzdCxcbiAgSHR0cFJlcXVlc3RPcHRpb25zLFxuICBIdHRwUmVzcG9uc2UsXG4gIE9wdGlvbmFsLFxuICBTY2hlbWEsXG59IGZyb20gJy4vdHlwZXMnO1xuaW1wb3J0IHsgY3JlYXRlTGF6eVN0cmVhbSB9IGZyb20gJy4vdXRpbC9zdHJlYW0nO1xuXG4vKiogQHByaXZhdGUgKi9cbmZ1bmN0aW9uIHBhcnNlSlNPTihzdHI6IHN0cmluZykge1xuICByZXR1cm4gSlNPTi5wYXJzZShzdHIpO1xufVxuXG4vKiogQHByaXZhdGUgKi9cbmFzeW5jIGZ1bmN0aW9uIHBhcnNlWE1MKHN0cjogc3RyaW5nKSB7XG4gIHJldHVybiB4bWwyanMucGFyc2VTdHJpbmdQcm9taXNlKHN0ciwgeyBleHBsaWNpdEFycmF5OiBmYWxzZSB9KTtcbn1cblxuLyoqIEBwcml2YXRlICovXG5mdW5jdGlvbiBwYXJzZVRleHQoc3RyOiBzdHJpbmcpIHtcbiAgcmV0dXJuIHN0cjtcbn1cblxuLyoqXG4gKiBIVFRQIGJhc2VkIEFQSSBjbGFzcyB3aXRoIGF1dGhvcml6YXRpb24gaG9va1xuICovXG5leHBvcnQgY2xhc3MgSHR0cEFwaTxTIGV4dGVuZHMgU2NoZW1hPiBleHRlbmRzIEV2ZW50RW1pdHRlciB7XG4gIHN0YXRpYyBfbG9nZ2VyID0gZ2V0TG9nZ2VyKCdodHRwLWFwaScpO1xuXG4gIF9jb25uOiBDb25uZWN0aW9uPFM+O1xuICBfbG9nZ2VyOiBMb2dnZXI7XG4gIF90cmFuc3BvcnQ6IFRyYW5zcG9ydDtcbiAgX3Jlc3BvbnNlVHlwZTogc3RyaW5nIHwgdm9pZDtcbiAgX25vQ29udGVudFJlc3BvbnNlOiBzdHJpbmcgfCB2b2lkO1xuICBfb3B0aW9uczogSHR0cFJlcXVlc3RPcHRpb25zO1xuXG4gIGNvbnN0cnVjdG9yKGNvbm46IENvbm5lY3Rpb248Uz4sIG9wdGlvbnM6IGFueSkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5fY29ubiA9IGNvbm47XG4gICAgdGhpcy5fbG9nZ2VyID0gY29ubi5fbG9nTGV2ZWxcbiAgICAgID8gSHR0cEFwaS5fbG9nZ2VyLmNyZWF0ZUluc3RhbmNlKGNvbm4uX2xvZ0xldmVsKVxuICAgICAgOiBIdHRwQXBpLl9sb2dnZXI7XG4gICAgdGhpcy5fcmVzcG9uc2VUeXBlID0gb3B0aW9ucy5yZXNwb25zZVR5cGU7XG4gICAgdGhpcy5fdHJhbnNwb3J0ID0gb3B0aW9ucy50cmFuc3BvcnQgfHwgY29ubi5fdHJhbnNwb3J0O1xuICAgIHRoaXMuX25vQ29udGVudFJlc3BvbnNlID0gb3B0aW9ucy5ub0NvbnRlbnRSZXNwb25zZTtcbiAgICB0aGlzLl9vcHRpb25zID0gb3B0aW9ucztcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxsb3V0IHRvIEFQSSBlbmRwb2ludCB1c2luZyBodHRwXG4gICAqL1xuICByZXF1ZXN0PFIgPSB1bmtub3duPihyZXF1ZXN0OiBIdHRwUmVxdWVzdCk6IFN0cmVhbVByb21pc2U8Uj4ge1xuICAgIHJldHVybiBTdHJlYW1Qcm9taXNlLmNyZWF0ZTxSPigoKSA9PiB7XG4gICAgICBjb25zdCB7IHN0cmVhbSwgc2V0U3RyZWFtIH0gPSBjcmVhdGVMYXp5U3RyZWFtKCk7XG4gICAgICBjb25zdCBwcm9taXNlID0gKGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVmcmVzaERlbGVnYXRlID0gdGhpcy5nZXRSZWZyZXNoRGVsZWdhdGUoKTtcbiAgICAgICAgLyogVE9ETyBkZWNpZGUgcmVtb3ZlIG9yIG5vdCB0aGlzIHNlY3Rpb24gKi9cbiAgICAgICAgLypcbiAgICAgICAgLy8gcmVtZW1iZXIgcHJldmlvdXMgaW5zdGFuY2UgdXJsIGluIGNhc2UgaXQgY2hhbmdlcyBhZnRlciBhIHJlZnJlc2hcbiAgICAgICAgY29uc3QgbGFzdEluc3RhbmNlVXJsID0gY29ubi5pbnN0YW5jZVVybDtcblxuICAgICAgICAvLyBjaGVjayB0byBzZWUgaWYgdGhlIHRva2VuIHJlZnJlc2ggaGFzIGNoYW5nZWQgdGhlIGluc3RhbmNlIHVybFxuICAgICAgICBpZihsYXN0SW5zdGFuY2VVcmwgIT09IGNvbm4uaW5zdGFuY2VVcmwpe1xuICAgICAgICAgIC8vIGlmIHRoZSBpbnN0YW5jZSB1cmwgaGFzIGNoYW5nZWRcbiAgICAgICAgICAvLyB0aGVuIHJlcGxhY2UgdGhlIGN1cnJlbnQgcmVxdWVzdCB1cmxzIGluc3RhbmNlIHVybCBmcmFnbWVudFxuICAgICAgICAgIC8vIHdpdGggdGhlIHVwZGF0ZWQgaW5zdGFuY2UgdXJsXG4gICAgICAgICAgcmVxdWVzdC51cmwgPSByZXF1ZXN0LnVybC5yZXBsYWNlKGxhc3RJbnN0YW5jZVVybCxjb25uLmluc3RhbmNlVXJsKTtcbiAgICAgICAgfVxuICAgICAgICAqL1xuICAgICAgICBpZiAocmVmcmVzaERlbGVnYXRlICYmIHJlZnJlc2hEZWxlZ2F0ZS5pc1JlZnJlc2hpbmcoKSkge1xuICAgICAgICAgIGF3YWl0IHJlZnJlc2hEZWxlZ2F0ZS53YWl0UmVmcmVzaCgpO1xuICAgICAgICAgIGNvbnN0IGJvZHlQcm9taXNlID0gdGhpcy5yZXF1ZXN0KHJlcXVlc3QpO1xuICAgICAgICAgIHNldFN0cmVhbShib2R5UHJvbWlzZS5zdHJlYW0oKSk7XG4gICAgICAgICAgY29uc3QgYm9keSA9IGF3YWl0IGJvZHlQcm9taXNlO1xuICAgICAgICAgIHJldHVybiBib2R5O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gaG9vayBiZWZvcmUgc2VuZGluZ1xuICAgICAgICB0aGlzLmJlZm9yZVNlbmQocmVxdWVzdCk7XG5cbiAgICAgICAgdGhpcy5lbWl0KCdyZXF1ZXN0JywgcmVxdWVzdCk7XG4gICAgICAgIHRoaXMuX2xvZ2dlci5kZWJ1ZyhcbiAgICAgICAgICBgPHJlcXVlc3Q+IG1ldGhvZD0ke3JlcXVlc3QubWV0aG9kfSwgdXJsPSR7cmVxdWVzdC51cmx9YCxcbiAgICAgICAgKTtcbiAgICAgICAgY29uc3QgcmVxdWVzdFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgICBjb25zdCByZXF1ZXN0UHJvbWlzZSA9IHRoaXMuX3RyYW5zcG9ydC5odHRwUmVxdWVzdChcbiAgICAgICAgICByZXF1ZXN0LFxuICAgICAgICAgIHRoaXMuX29wdGlvbnMsXG4gICAgICAgICk7XG5cbiAgICAgICAgc2V0U3RyZWFtKHJlcXVlc3RQcm9taXNlLnN0cmVhbSgpKTtcblxuICAgICAgICBsZXQgcmVzcG9uc2U6IEh0dHBSZXNwb25zZSB8IHZvaWQ7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0UHJvbWlzZTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgdGhpcy5fbG9nZ2VyLmVycm9yKGVycik7XG4gICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICB9IGZpbmFsbHkge1xuICAgICAgICAgIGNvbnN0IHJlc3BvbnNlVGltZSA9IERhdGUubm93KCk7XG4gICAgICAgICAgdGhpcy5fbG9nZ2VyLmRlYnVnKFxuICAgICAgICAgICAgYGVsYXBzZWQgdGltZTogJHtyZXNwb25zZVRpbWUgLSByZXF1ZXN0VGltZX0gbXNlY2AsXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXJlc3BvbnNlKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2xvZ2dlci5kZWJ1ZyhcbiAgICAgICAgICBgPHJlc3BvbnNlPiBzdGF0dXM9JHtTdHJpbmcocmVzcG9uc2Uuc3RhdHVzQ29kZSl9LCB1cmw9JHtcbiAgICAgICAgICAgIHJlcXVlc3QudXJsXG4gICAgICAgICAgfWAsXG4gICAgICAgICk7XG4gICAgICAgIHRoaXMuZW1pdCgncmVzcG9uc2UnLCByZXNwb25zZSk7XG4gICAgICAgIC8vIFJlZnJlc2ggdG9rZW4gaWYgc2Vzc2lvbiBoYXMgYmVlbiBleHBpcmVkIGFuZCByZXF1aXJlcyBhdXRoZW50aWNhdGlvblxuICAgICAgICAvLyB3aGVuIHNlc3Npb24gcmVmcmVzaCBkZWxlZ2F0ZSBpcyBhdmFpbGFibGVcbiAgICAgICAgaWYgKHRoaXMuaXNTZXNzaW9uRXhwaXJlZChyZXNwb25zZSkgJiYgcmVmcmVzaERlbGVnYXRlKSB7XG4gICAgICAgICAgYXdhaXQgcmVmcmVzaERlbGVnYXRlLnJlZnJlc2gocmVxdWVzdFRpbWUpO1xuICAgICAgICAgIHJldHVybiB0aGlzLnJlcXVlc3QocmVxdWVzdCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuaXNFcnJvclJlc3BvbnNlKHJlc3BvbnNlKSkge1xuICAgICAgICAgIGNvbnN0IGVyciA9IGF3YWl0IHRoaXMuZ2V0RXJyb3IocmVzcG9uc2UpO1xuICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBib2R5ID0gYXdhaXQgdGhpcy5nZXRSZXNwb25zZUJvZHkocmVzcG9uc2UpO1xuICAgICAgICByZXR1cm4gYm9keTtcbiAgICAgIH0pKCk7XG4gICAgICByZXR1cm4geyBzdHJlYW0sIHByb21pc2UgfTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcHJvdGVjdGVkXG4gICAqL1xuICBnZXRSZWZyZXNoRGVsZWdhdGUoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2Nvbm4uX3JlZnJlc2hEZWxlZ2F0ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcHJvdGVjdGVkXG4gICAqL1xuICBiZWZvcmVTZW5kKHJlcXVlc3Q6IEh0dHBSZXF1ZXN0KSB7XG4gICAgLyogZXNsaW50LWRpc2FibGUgbm8tcGFyYW0tcmVhc3NpZ24gKi9cbiAgICBjb25zdCBoZWFkZXJzID0gcmVxdWVzdC5oZWFkZXJzIHx8IHt9O1xuICAgIGlmICh0aGlzLl9jb25uLmFjY2Vzc1Rva2VuKSB7XG4gICAgICBoZWFkZXJzLkF1dGhvcml6YXRpb24gPSBgQmVhcmVyICR7dGhpcy5fY29ubi5hY2Nlc3NUb2tlbn1gO1xuICAgIH1cbiAgICBpZiAodGhpcy5fY29ubi5fY2FsbE9wdGlvbnMpIHtcbiAgICAgIGNvbnN0IGNhbGxPcHRpb25zID0gW107XG4gICAgICBmb3IgKGNvbnN0IG5hbWUgb2YgT2JqZWN0LmtleXModGhpcy5fY29ubi5fY2FsbE9wdGlvbnMpKSB7XG4gICAgICAgIGNhbGxPcHRpb25zLnB1c2goYCR7bmFtZX09JHt0aGlzLl9jb25uLl9jYWxsT3B0aW9uc1tuYW1lXX1gKTtcbiAgICAgIH1cbiAgICAgIGhlYWRlcnNbJ1Nmb3JjZS1DYWxsLU9wdGlvbnMnXSA9IGNhbGxPcHRpb25zLmpvaW4oJywgJyk7XG4gICAgfVxuICAgIHJlcXVlc3QuaGVhZGVycyA9IGhlYWRlcnM7XG4gIH1cblxuICAvKipcbiAgICogRGV0ZWN0IHJlc3BvbnNlIGNvbnRlbnQgbWltZS10eXBlXG4gICAqIEBwcm90ZWN0ZWRcbiAgICovXG4gIGdldFJlc3BvbnNlQ29udGVudFR5cGUocmVzcG9uc2U6IEh0dHBSZXNwb25zZSk6IE9wdGlvbmFsPHN0cmluZz4ge1xuICAgIHJldHVybiAoXG4gICAgICB0aGlzLl9yZXNwb25zZVR5cGUgfHxcbiAgICAgIChyZXNwb25zZS5oZWFkZXJzICYmIHJlc3BvbnNlLmhlYWRlcnNbJ2NvbnRlbnQtdHlwZSddKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogQHByaXZhdGVcbiAgICovXG4gIGFzeW5jIHBhcnNlUmVzcG9uc2VCb2R5KHJlc3BvbnNlOiBIdHRwUmVzcG9uc2UpIHtcbiAgICBjb25zdCBjb250ZW50VHlwZSA9IHRoaXMuZ2V0UmVzcG9uc2VDb250ZW50VHlwZShyZXNwb25zZSkgfHwgJyc7XG4gICAgY29uc3QgcGFyc2VCb2R5ID0gL14odGV4dHxhcHBsaWNhdGlvbilcXC94bWwoO3wkKS8udGVzdChjb250ZW50VHlwZSlcbiAgICAgID8gcGFyc2VYTUxcbiAgICAgIDogL15hcHBsaWNhdGlvblxcL2pzb24oO3wkKS8udGVzdChjb250ZW50VHlwZSlcbiAgICAgID8gcGFyc2VKU09OXG4gICAgICA6IC9edGV4dFxcL2Nzdig7fCQpLy50ZXN0KGNvbnRlbnRUeXBlKVxuICAgICAgPyBwYXJzZUNTVlxuICAgICAgOiBwYXJzZVRleHQ7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBwYXJzZUJvZHkocmVzcG9uc2UuYm9keSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmV0dXJuIHJlc3BvbnNlLmJvZHk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCByZXNwb25zZSBib2R5XG4gICAqIEBwcm90ZWN0ZWRcbiAgICovXG4gIGFzeW5jIGdldFJlc3BvbnNlQm9keShyZXNwb25zZTogSHR0cFJlc3BvbnNlKSB7XG4gICAgaWYgKHJlc3BvbnNlLnN0YXR1c0NvZGUgPT09IDIwNCkge1xuICAgICAgLy8gTm8gQ29udGVudFxuICAgICAgcmV0dXJuIHRoaXMuX25vQ29udGVudFJlc3BvbnNlO1xuICAgIH1cbiAgICBjb25zdCBib2R5ID0gYXdhaXQgdGhpcy5wYXJzZVJlc3BvbnNlQm9keShyZXNwb25zZSk7XG4gICAgbGV0IGVycjtcbiAgICBpZiAodGhpcy5oYXNFcnJvckluUmVzcG9uc2VCb2R5KGJvZHkpKSB7XG4gICAgICBlcnIgPSBhd2FpdCB0aGlzLmdldEVycm9yKHJlc3BvbnNlLCBib2R5KTtcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gICAgaWYgKHJlc3BvbnNlLnN0YXR1c0NvZGUgPT09IDMwMCkge1xuICAgICAgLy8gTXVsdGlwbGUgQ2hvaWNlc1xuICAgICAgdGhyb3cgbmV3IEh0dHBBcGlFcnJvcihcbiAgICAgICAgJ011bHRpcGxlIHJlY29yZHMgZm91bmQnLFxuICAgICAgICAnTVVMVElQTEVfQ0hPSUNFUycsXG4gICAgICAgIGJvZHksXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gYm9keTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZXRlY3Qgc2Vzc2lvbiBleHBpcnlcbiAgICogQHByb3RlY3RlZFxuICAgKi9cbiAgaXNTZXNzaW9uRXhwaXJlZChyZXNwb25zZTogSHR0cFJlc3BvbnNlKSB7XG4gICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1c0NvZGUgPT09IDQwMTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZXRlY3QgZXJyb3IgcmVzcG9uc2VcbiAgICogQHByb3RlY3RlZFxuICAgKi9cbiAgaXNFcnJvclJlc3BvbnNlKHJlc3BvbnNlOiBIdHRwUmVzcG9uc2UpIHtcbiAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzQ29kZSA+PSA0MDA7XG4gIH1cblxuICAvKipcbiAgICogRGV0ZWN0IGVycm9yIGluIHJlc3BvbnNlIGJvZHlcbiAgICogQHByb3RlY3RlZFxuICAgKi9cbiAgaGFzRXJyb3JJblJlc3BvbnNlQm9keShfYm9keTogT3B0aW9uYWw8c3RyaW5nPikge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQYXJzaW5nIGVycm9yIG1lc3NhZ2UgaW4gcmVzcG9uc2VcbiAgICogQHByb3RlY3RlZFxuICAgKi9cbiAgcGFyc2VFcnJvcihib2R5OiBhbnkpIHtcbiAgICBjb25zdCBlcnJvcnMgPSBib2R5O1xuICAgIHJldHVybiBBcnJheS5pc0FycmF5KGVycm9ycykgPyBlcnJvcnNbMF0gOiBlcnJvcnM7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGVycm9yIG1lc3NhZ2UgaW4gcmVzcG9uc2VcbiAgICogQHByb3RlY3RlZFxuICAgKi9cbiAgYXN5bmMgZ2V0RXJyb3IocmVzcG9uc2U6IEh0dHBSZXNwb25zZSwgYm9keT86IGFueSk6IFByb21pc2U8RXJyb3I+IHtcbiAgICBsZXQgZXJyb3I7XG4gICAgdHJ5IHtcbiAgICAgIGVycm9yID0gdGhpcy5wYXJzZUVycm9yKGJvZHkgfHwgKGF3YWl0IHRoaXMucGFyc2VSZXNwb25zZUJvZHkocmVzcG9uc2UpKSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgLy8gZXNsaW50LWRpc2FibGUgbm8tZW1wdHlcbiAgICB9XG4gICAgZXJyb3IgPVxuICAgICAgdHlwZW9mIGVycm9yID09PSAnb2JqZWN0JyAmJlxuICAgICAgZXJyb3IgIT09IG51bGwgJiZcbiAgICAgIHR5cGVvZiBlcnJvci5tZXNzYWdlID09PSAnc3RyaW5nJ1xuICAgICAgICA/IGVycm9yXG4gICAgICAgIDoge1xuICAgICAgICAgICAgZXJyb3JDb2RlOiBgRVJST1JfSFRUUF8ke3Jlc3BvbnNlLnN0YXR1c0NvZGV9YCxcbiAgICAgICAgICAgIG1lc3NhZ2U6IHJlc3BvbnNlLmJvZHksXG4gICAgICAgICAgfTtcblxuICAgIGlmIChyZXNwb25zZS5oZWFkZXJzWydjb250ZW50LXR5cGUnXSA9PT0gJ3RleHQvaHRtbCcpIHtcbiAgICAgIHRoaXMuX2xvZ2dlci5kZWJ1ZyhgaHRtbCByZXNwb25zZS5ib2R5OiAke3Jlc3BvbnNlLmJvZHl9YCk7XG4gICAgICByZXR1cm4gbmV3IEh0dHBBcGlFcnJvcihcbiAgICAgICAgYEhUVFAgcmVzcG9uc2UgY29udGFpbnMgaHRtbCBjb250ZW50LlxuQ2hlY2sgdGhhdCB0aGUgb3JnIGV4aXN0cyBhbmQgY2FuIGJlIHJlYWNoZWQuXG5TZWUgZXJyb3IuY29udGVudCBmb3IgdGhlIGZ1bGwgaHRtbCByZXNwb25zZS5gLFxuICAgICAgICBlcnJvci5lcnJvckNvZGUsXG4gICAgICAgIGVycm9yLm1lc3NhZ2UsXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IEh0dHBBcGlFcnJvcihlcnJvci5tZXNzYWdlLCBlcnJvci5lcnJvckNvZGUpO1xuICB9XG59XG5cbi8qKlxuICpcbiAqL1xuY2xhc3MgSHR0cEFwaUVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICBlcnJvckNvZGU6IHN0cmluZztcbiAgY29udGVudDogYW55O1xuICBjb25zdHJ1Y3RvcihtZXNzYWdlOiBzdHJpbmcsIGVycm9yQ29kZT86IHN0cmluZyB8IHVuZGVmaW5lZCwgY29udGVudD86IGFueSkge1xuICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIHRoaXMubmFtZSA9IGVycm9yQ29kZSB8fCB0aGlzLm5hbWU7XG4gICAgdGhpcy5lcnJvckNvZGUgPSB0aGlzLm5hbWU7XG4gICAgdGhpcy5jb250ZW50ID0gY29udGVudDtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBIdHRwQXBpO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQSxTQUFTQSxZQUFZLFFBQVEsUUFBUTtBQUNyQyxPQUFPQyxNQUFNLE1BQU0sUUFBUTtBQUMzQixTQUFpQkMsU0FBUyxRQUFRLGVBQWU7QUFDakQsU0FBU0MsYUFBYSxRQUFRLGdCQUFnQjtBQUc5QyxTQUFTQyxRQUFRLFFBQVEsT0FBTztBQVFoQyxTQUFTQyxnQkFBZ0IsUUFBUSxlQUFlOztBQUVoRDtBQUNBLFNBQVNDLFNBQVNBLENBQUNDLEdBQVcsRUFBRTtFQUM5QixPQUFPQyxJQUFJLENBQUNDLEtBQUssQ0FBQ0YsR0FBRyxDQUFDO0FBQ3hCOztBQUVBO0FBQ0EsZUFBZUcsUUFBUUEs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