import "core-js/modules/es.array.iterator";
import "core-js/modules/es.promise";
import _Promise from "@babel/runtime-corejs3/core-js-stable/promise";
import _indexOfInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/index-of";
import _Object$keys from "@babel/runtime-corejs3/core-js-stable/object/keys";
import _JSON$stringify from "@babel/runtime-corejs3/core-js-stable/json/stringify";
import _mapInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/map";
import _defineProperty from "@babel/runtime-corejs3/helpers/defineProperty";
/**
 * @file Manages asynchronous method response cache
 * @author Shinichi Tomita <shinichi.tomita@gmail.com>
 */
import { EventEmitter } from 'events';

/**
 * type def
 */

/**
 * Class for managing cache entry
 *
 * @private
 * @class
 * @constructor
 * @template T
 */
class CacheEntry extends EventEmitter {
  constructor(...args) {
    super(...args);
    _defineProperty(this, "_fetching", false);
    _defineProperty(this, "_value", undefined);
  }
  /**
   * Get value in the cache entry
   *
   * @param {() => Promise<T>} [callback] - Callback function callbacked the cache entry updated
   * @returns {T|undefined}
   */
  get(callback) {
    if (callback) {
      const cb = callback;
      this.once('value', v => cb(v));
      if (typeof this._value !== 'undefined') {
        this.emit('value', this._value);
      }
    }
    return this._value;
  }

  /**
   * Set value in the cache entry
   */
  set(value) {
    this._value = value;
    this.emit('value', this._value);
  }

  /**
   * Clear cached value
   */
  clear() {
    this._fetching = false;
    this._value = undefined;
  }
}

/**
 * create and return cache key from namespace and serialized arguments.
 * @private
 */
function createCacheKey(namespace, args) {
  var _context;
  return `${namespace || ''}(${_mapInstanceProperty(_context = [...args]).call(_context, a => _JSON$stringify(a)).join(',')})`;
}
function generateKeyString(options, scope, args) {
  return typeof options.key === 'string' ? options.key : typeof options.key === 'function' ? options.key.apply(scope, args) : createCacheKey(options.namespace, args);
}

/**
 * Caching manager for async methods
 *
 * @class
 * @constructor
 */
export class Cache {
  constructor() {
    _defineProperty(this, "_entries", {});
  }
  /**
   * retrive cache entry, or create if not exists.
   *
   * @param {String} [key] - Key of cache entry
   * @returns {CacheEntry}
   */
  get(key) {
    if (this._entries[key]) {
      return this._entries[key];
    }
    const entry = new CacheEntry();
    this._entries[key] = entry;
    return entry;
  }

  /**
   * clear cache entries prefix matching given key
   */
  clear(key) {
    for (const k of _Object$keys(this._entries)) {
      if (!key || _indexOfInstanceProperty(k).call(k, key) === 0) {
        this._entries[k].clear();
      }
    }
  }

  /**
   * Enable caching for async call fn to lookup the response cache first,
   * then invoke original if no cached value.
   */
  createCachedFunction(fn, scope, options = {
    strategy: 'NOCACHE'
  }) {
    const strategy = options.strategy;
    const $fn = (...args) => {
      const key = generateKeyString(options, scope, args);
      const entry = this.get(key);
      const executeFetch = async () => {
        entry._fetching = true;
        try {
          const result = await fn.apply(scope || this, args);
          entry.set({
            error: undefined,
            result
          });
          return result;
        } catch (error) {
          entry.set({
            error: error,
            result: undefined
          });
          throw error;
        }
      };
      let value;
      switch (strategy) {
        case 'IMMEDIATE':
          value = entry.get();
          if (!value) {
            throw new Error('Function call result is not cached yet.');
          }
          if (value.error) {
            throw value.error;
          }
          return value.result;
        case 'HIT':
          return (async () => {
            if (!entry._fetching) {
              // only when no other client is calling function
              await executeFetch();
            }
            return new _Promise((resolve, reject) => {
              entry.get(({
                error,
                result
              }) => {
                if (error) reject(error);else resolve(result);
              });
            });
          })();
        case 'NOCACHE':
        default:
          return executeFetch();
      }
    };
    $fn.clear = (...args) => {
      const key = generateKeyString(options, scope, args);
      this.clear(key);
    };
    return $fn;
  }
}
export default Cache;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJFdmVudEVtaXR0ZXIiLCJDYWNoZUVudHJ5IiwiY29uc3RydWN0b3IiLCJhcmdzIiwiX2RlZmluZVByb3BlcnR5IiwidW5kZWZpbmVkIiwiZ2V0IiwiY2FsbGJhY2siLCJjYiIsIm9uY2UiLCJ2IiwiX3ZhbHVlIiwiZW1pdCIsInNldCIsInZhbHVlIiwiY2xlYXIiLCJfZmV0Y2hpbmciLCJjcmVhdGVDYWNoZUtleSIsIm5hbWVzcGFjZSIsIl9jb250ZXh0IiwiX21hcEluc3RhbmNlUHJvcGVydHkiLCJjYWxsIiwiYSIsIl9KU09OJHN0cmluZ2lmeSIsImpvaW4iLCJnZW5lcmF0ZUtleVN0cmluZyIsIm9wdGlvbnMiLCJzY29wZSIsImtleSIsImFwcGx5IiwiQ2FjaGUiLCJfZW50cmllcyIsImVudHJ5IiwiayIsIl9PYmplY3Qka2V5cyIsIl9pbmRleE9mSW5zdGFuY2VQcm9wZXJ0eSIsImNyZWF0ZUNhY2hlZEZ1bmN0aW9uIiwiZm4iLCJzdHJhdGVneSIsIiRmbiIsImV4ZWN1dGVGZXRjaCIsInJlc3VsdCIsImVycm9yIiwiRXJyb3IiLCJfUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiXSwic291cmNlcyI6WyIuLi9zcmMvY2FjaGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSBNYW5hZ2VzIGFzeW5jaHJvbm91cyBtZXRob2QgcmVzcG9uc2UgY2FjaGVcbiAqIEBhdXRob3IgU2hpbmljaGkgVG9taXRhIDxzaGluaWNoaS50b21pdGFAZ21haWwuY29tPlxuICovXG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIgfSBmcm9tICdldmVudHMnO1xuXG4vKipcbiAqIHR5cGUgZGVmXG4gKi9cbmV4cG9ydCB0eXBlIENhY2hpbmdPcHRpb25zID0ge1xuICBrZXk/OiBzdHJpbmcgfCAoKC4uLmFyZ3M6IGFueVtdKSA9PiBzdHJpbmcpO1xuICBuYW1lc3BhY2U/OiBzdHJpbmc7XG4gIHN0cmF0ZWd5OiAnTk9DQUNIRScgfCAnSElUJyB8ICdJTU1FRElBVEUnO1xufTtcblxudHlwZSBDYWNoZVZhbHVlPFQ+ID0ge1xuICBlcnJvcj86IEVycm9yO1xuICByZXN1bHQ6IFQ7XG59O1xuXG5leHBvcnQgdHlwZSBDYWNoZWRGdW5jdGlvbjxGbj4gPSBGbiAmIHsgY2xlYXI6ICguLi5hcmdzOiBhbnlbXSkgPT4gdm9pZCB9O1xuXG4vKipcbiAqIENsYXNzIGZvciBtYW5hZ2luZyBjYWNoZSBlbnRyeVxuICpcbiAqIEBwcml2YXRlXG4gKiBAY2xhc3NcbiAqIEBjb25zdHJ1Y3RvclxuICogQHRlbXBsYXRlIFRcbiAqL1xuY2xhc3MgQ2FjaGVFbnRyeTxUPiBleHRlbmRzIEV2ZW50RW1pdHRlciB7XG4gIF9mZXRjaGluZzogYm9vbGVhbiA9IGZhbHNlO1xuICBfdmFsdWU6IENhY2hlVmFsdWU8VD4gfCB2b2lkID0gdW5kZWZpbmVkO1xuXG4gIC8qKlxuICAgKiBHZXQgdmFsdWUgaW4gdGhlIGNhY2hlIGVudHJ5XG4gICAqXG4gICAqIEBwYXJhbSB7KCkgPT4gUHJvbWlzZTxUPn0gW2NhbGxiYWNrXSAtIENhbGxiYWNrIGZ1bmN0aW9uIGNhbGxiYWNrZWQgdGhlIGNhY2hlIGVudHJ5IHVwZGF0ZWRcbiAgICogQHJldHVybnMge1R8dW5kZWZpbmVkfVxuICAgKi9cbiAgZ2V0KGNhbGxiYWNrPzogKHY6IFQpID0+IGFueSk6IENhY2hlVmFsdWU8VD4gfCB2b2lkIHtcbiAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgIGNvbnN0IGNiID0gY2FsbGJhY2s7XG4gICAgICB0aGlzLm9uY2UoJ3ZhbHVlJywgKHY6IFQpID0+IGNiKHYpKTtcbiAgICAgIGlmICh0eXBlb2YgdGhpcy5fdmFsdWUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHRoaXMuZW1pdCgndmFsdWUnLCB0aGlzLl92YWx1ZSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl92YWx1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgdmFsdWUgaW4gdGhlIGNhY2hlIGVudHJ5XG4gICAqL1xuICBzZXQodmFsdWU6IENhY2hlVmFsdWU8VD4pIHtcbiAgICB0aGlzLl92YWx1ZSA9IHZhbHVlO1xuICAgIHRoaXMuZW1pdCgndmFsdWUnLCB0aGlzLl92YWx1ZSk7XG4gIH1cblxuICAvKipcbiAgICogQ2xlYXIgY2FjaGVkIHZhbHVlXG4gICAqL1xuICBjbGVhcigpIHtcbiAgICB0aGlzLl9mZXRjaGluZyA9IGZhbHNlO1xuICAgIHRoaXMuX3ZhbHVlID0gdW5kZWZpbmVkO1xuICB9XG59XG5cbi8qKlxuICogY3JlYXRlIGFuZCByZXR1cm4gY2FjaGUga2V5IGZyb20gbmFtZXNwYWNlIGFuZCBzZXJpYWxpemVkIGFyZ3VtZW50cy5cbiAqIEBwcml2YXRlXG4gKi9cbmZ1bmN0aW9uIGNyZWF0ZUNhY2hlS2V5KG5hbWVzcGFjZTogc3RyaW5nIHwgdm9pZCwgYXJnczogYW55W10pOiBzdHJpbmcge1xuICByZXR1cm4gYCR7bmFtZXNwYWNlIHx8ICcnfSgke1suLi5hcmdzXVxuICAgIC5tYXAoKGEpID0+IEpTT04uc3RyaW5naWZ5KGEpKVxuICAgIC5qb2luKCcsJyl9KWA7XG59XG5cbmZ1bmN0aW9uIGdlbmVyYXRlS2V5U3RyaW5nKFxuICBvcHRpb25zOiBDYWNoaW5nT3B0aW9ucyxcbiAgc2NvcGU6IGFueSxcbiAgYXJnczogYW55W10sXG4pOiBzdHJpbmcge1xuICByZXR1cm4gdHlwZW9mIG9wdGlvbnMua2V5ID09PSAnc3RyaW5nJ1xuICAgID8gb3B0aW9ucy5rZXlcbiAgICA6IHR5cGVvZiBvcHRpb25zLmtleSA9PT0gJ2Z1bmN0aW9uJ1xuICAgID8gb3B0aW9ucy5rZXkuYXBwbHkoc2NvcGUsIGFyZ3MpXG4gICAgOiBjcmVhdGVDYWNoZUtleShvcHRpb25zLm5hbWVzcGFjZSwgYXJncyk7XG59XG5cbi8qKlxuICogQ2FjaGluZyBtYW5hZ2VyIGZvciBhc3luYyBtZXRob2RzXG4gKlxuICogQGNsYXNzXG4gKiBAY29uc3RydWN0b3JcbiAqL1xuZXhwb3J0IGNsYXNzIENhY2hlIHtcbiAgcHJpdmF0ZSBfZW50cmllczogeyBba2V5OiBzdHJpbmddOiBDYWNoZUVudHJ5PGFueT4gfSA9IHt9O1xuXG4gIC8qKlxuICAgKiByZXRyaXZlIGNhY2hlIGVudHJ5LCBvciBjcmVhdGUgaWYgbm90IGV4aXN0cy5cbiAgICpcbiAgICogQHBhcmFtIHtTdHJpbmd9IFtrZXldIC0gS2V5IG9mIGNhY2hlIGVudHJ5XG4gICAqIEByZXR1cm5zIHtDYWNoZUVudHJ5fVxuICAgKi9cbiAgZ2V0KGtleTogc3RyaW5nKSB7XG4gICAgaWYgKHRoaXMuX2VudHJpZXNba2V5XSkge1xuICAgICAgcmV0dXJuIHRoaXMuX2VudHJpZXNba2V5XTtcbiAgICB9XG4gICAgY29uc3QgZW50cnkgPSBuZXcgQ2FjaGVFbnRyeSgpO1xuICAgIHRoaXMuX2VudHJpZXNba2V5XSA9IGVudHJ5O1xuICAgIHJldHVybiBlbnRyeTtcbiAgfVxuXG4gIC8qKlxuICAgKiBjbGVhciBjYWNoZSBlbnRyaWVzIHByZWZpeCBtYXRjaGluZyBnaXZlbiBrZXlcbiAgICovXG4gIGNsZWFyKGtleT86IHN0cmluZykge1xuICAgIGZvciAoY29uc3QgayBvZiBPYmplY3Qua2V5cyh0aGlzLl9lbnRyaWVzKSkge1xuICAgICAgaWYgKCFrZXkgfHwgay5pbmRleE9mKGtleSkgPT09IDApIHtcbiAgICAgICAgdGhpcy5fZW50cmllc1trXS5jbGVhcigpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFbmFibGUgY2FjaGluZyBmb3IgYXN5bmMgY2FsbCBmbiB0byBsb29rdXAgdGhlIHJlc3BvbnNlIGNhY2hlIGZpcnN0LFxuICAgKiB0aGVuIGludm9rZSBvcmlnaW5hbCBpZiBubyBjYWNoZWQgdmFsdWUuXG4gICAqL1xuICBjcmVhdGVDYWNoZWRGdW5jdGlvbjxGbiBleHRlbmRzIEZ1bmN0aW9uPihcbiAgICBmbjogRm4sXG4gICAgc2NvcGU6IGFueSxcbiAgICBvcHRpb25zOiBDYWNoaW5nT3B0aW9ucyA9IHsgc3RyYXRlZ3k6ICdOT0NBQ0hFJyB9LFxuICApOiBDYWNoZWRGdW5jdGlvbjxGbj4ge1xuICAgIGNvbnN0IHN0cmF0ZWd5ID0gb3B0aW9ucy5zdHJhdGVneTtcbiAgICBjb25zdCAkZm46IGFueSA9ICguLi5hcmdzOiBhbnlbXSkgPT4ge1xuICAgICAgY29uc3Qga2V5ID0gZ2VuZXJhdGVLZXlTdHJpbmcob3B0aW9ucywgc2NvcGUsIGFyZ3MpO1xuICAgICAgY29uc3QgZW50cnkgPSB0aGlzLmdldChrZXkpO1xuICAgICAgY29uc3QgZXhlY3V0ZUZldGNoID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICBlbnRyeS5fZmV0Y2hpbmcgPSB0cnVlO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGZuLmFwcGx5KHNjb3BlIHx8IHRoaXMsIGFyZ3MpO1xuICAgICAgICAgIGVudHJ5LnNldCh7IGVycm9yOiB1bmRlZmluZWQsIHJlc3VsdCB9KTtcbiAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGVudHJ5LnNldCh7IGVycm9yOiBlcnJvciBhcyBFcnJvciwgcmVzdWx0OiB1bmRlZmluZWQgfSk7XG4gICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBsZXQgdmFsdWU7XG4gICAgICBzd2l0Y2ggKHN0cmF0ZWd5KSB7XG4gICAgICAgIGNhc2UgJ0lNTUVESUFURSc6XG4gICAgICAgICAgdmFsdWUgPSBlbnRyeS5nZXQoKTtcbiAgICAgICAgICBpZiAoIXZhbHVlKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Z1bmN0aW9uIGNhbGwgcmVzdWx0IGlzIG5vdCBjYWNoZWQgeWV0LicpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAodmFsdWUuZXJyb3IpIHtcbiAgICAgICAgICAgIHRocm93IHZhbHVlLmVycm9yO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gdmFsdWUucmVzdWx0O1xuICAgICAgICBjYXNlICdISVQnOlxuICAgICAgICAgIHJldHVybiAoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgaWYgKCFlbnRyeS5fZmV0Y2hpbmcpIHtcbiAgICAgICAgICAgICAgLy8gb25seSB3aGVuIG5vIG90aGVyIGNsaWVudCBpcyBjYWxsaW5nIGZ1bmN0aW9uXG4gICAgICAgICAgICAgIGF3YWl0IGV4ZWN1dGVGZXRjaCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgICAgZW50cnkuZ2V0KCh7IGVycm9yLCByZXN1bHQgfSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChlcnJvcikgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICBlbHNlIHJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KSgpO1xuICAgICAgICBjYXNlICdOT0NBQ0hFJzpcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICByZXR1cm4gZXhlY3V0ZUZldGNoKCk7XG4gICAgICB9XG4gICAgfTtcbiAgICAkZm4uY2xlYXIgPSAoLi4uYXJnczogYW55W10pID0+IHtcbiAgICAgIGNvbnN0IGtleSA9IGdlbmVyYXRlS2V5U3RyaW5nKG9wdGlvbnMsIHNjb3BlLCBhcmdzKTtcbiAgICAgIHRoaXMuY2xlYXIoa2V5KTtcbiAgICB9O1xuICAgIHJldHVybiAkZm4gYXMgQ2FjaGVkRnVuY3Rpb248Rm4+O1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IENhY2hlO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBU0EsWUFBWSxRQUFRLFFBQVE7O0FBRXJDO0FBQ0E7QUFDQTs7QUFjQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTUMsVUFBVSxTQUFZRCxZ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