import _Reflect$construct from "@babel/runtime-corejs3/core-js-stable/reflect/construct";
import "core-js/modules/es.array.join";
import _JSON$stringify from "@babel/runtime-corejs3/core-js-stable/json/stringify";
import _classCallCheck from "@babel/runtime-corejs3/helpers/classCallCheck";
import _createClass from "@babel/runtime-corejs3/helpers/createClass";
import _assertThisInitialized from "@babel/runtime-corejs3/helpers/assertThisInitialized";
import _inherits from "@babel/runtime-corejs3/helpers/inherits";
import _possibleConstructorReturn from "@babel/runtime-corejs3/helpers/possibleConstructorReturn";
import _getPrototypeOf from "@babel/runtime-corejs3/helpers/getPrototypeOf";
import _defineProperty from "@babel/runtime-corejs3/helpers/defineProperty";
function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = _Reflect$construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }
function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !_Reflect$construct) return false; if (_Reflect$construct.sham) return false; if (typeof Proxy === "function") return true; try { Date.prototype.toString.call(_Reflect$construct(Date, [], function () {})); return true; } catch (e) { return false; } }
import fs from 'fs';
import path from 'path';
import { BaseRegistry } from './base';

/**
 *
 */
function getDefaultConfigFilePath() {
  var homeDir = process.env[process.platform === 'win32' ? 'USERPROFILE' : 'HOME'];
  if (!homeDir) {
    throw new Error('cannot find user home directory to store configuration files');
  }
  return path.join(homeDir, '.jsforce', 'config.json');
}

/**
 *
 */
export var FileRegistry = /*#__PURE__*/function (_BaseRegistry) {
  _inherits(FileRegistry, _BaseRegistry);
  var _super = _createSuper(FileRegistry);
  function FileRegistry(_ref) {
    var _this;
    var configFilePath = _ref.configFilePath;
    _classCallCheck(this, FileRegistry);
    _this = _super.call(this);
    _defineProperty(_assertThisInitialized(_this), "_configFilePath", void 0);
    _this._configFilePath = configFilePath || getDefaultConfigFilePath();
    try {
      var data = fs.readFileSync(_this._configFilePath, 'utf-8');
      _this._registryConfig = JSON.parse(data);
    } catch (e) {
      //
    }
    return _this;
  }
  _createClass(FileRegistry, [{
    key: "_saveConfig",
    value: function _saveConfig() {
      var data = _JSON$stringify(this._registryConfig, null, 4);
      try {
        fs.writeFileSync(this._configFilePath, data);
        fs.chmodSync(this._configFilePath, '600');
      } catch (e) {
        var configDir = path.dirname(this._configFilePath);
        fs.mkdirSync(configDir);
        fs.chmodSync(configDir, '700');
        fs.writeFileSync(this._configFilePath, data);
        fs.chmodSync(this._configFilePath, '600');
      }
    }
  }]);
  return FileRegistry;
}(BaseRegistry);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJmcyIsInBhdGgiLCJCYXNlUmVnaXN0cnkiLCJnZXREZWZhdWx0Q29uZmlnRmlsZVBhdGgiLCJob21lRGlyIiwicHJvY2VzcyIsImVudiIsInBsYXRmb3JtIiwiRXJyb3IiLCJqb2luIiwiRmlsZVJlZ2lzdHJ5IiwiX0Jhc2VSZWdpc3RyeSIsIl9pbmhlcml0cyIsIl9zdXBlciIsIl9jcmVhdGVTdXBlciIsIl9yZWYiLCJfdGhpcyIsImNvbmZpZ0ZpbGVQYXRoIiwiX2NsYXNzQ2FsbENoZWNrIiwiY2FsbCIsIl9kZWZpbmVQcm9wZXJ0eSIsIl9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQiLCJfY29uZmlnRmlsZVBhdGgiLCJkYXRhIiwicmVhZEZpbGVTeW5jIiwiX3JlZ2lzdHJ5Q29uZmlnIiwiSlNPTiIsInBhcnNlIiwiZSIsIl9jcmVhdGVDbGFzcyIsImtleSIsInZhbHVlIiwiX3NhdmVDb25maWciLCJfSlNPTiRzdHJpbmdpZnkiLCJ3cml0ZUZpbGVTeW5jIiwiY2htb2RTeW5jIiwiY29uZmlnRGlyIiwiZGlybmFtZSIsIm1rZGlyU3luYyJdLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9yZWdpc3RyeS9maWxlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBmcyBmcm9tICdmcyc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IEJhc2VSZWdpc3RyeSB9IGZyb20gJy4vYmFzZSc7XG5cbi8qKlxuICpcbiAqL1xuZnVuY3Rpb24gZ2V0RGVmYXVsdENvbmZpZ0ZpbGVQYXRoKCkge1xuICBjb25zdCBob21lRGlyID1cbiAgICBwcm9jZXNzLmVudltwcm9jZXNzLnBsYXRmb3JtID09PSAnd2luMzInID8gJ1VTRVJQUk9GSUxFJyA6ICdIT01FJ107XG4gIGlmICghaG9tZURpcikge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICdjYW5ub3QgZmluZCB1c2VyIGhvbWUgZGlyZWN0b3J5IHRvIHN0b3JlIGNvbmZpZ3VyYXRpb24gZmlsZXMnLFxuICAgICk7XG4gIH1cbiAgcmV0dXJuIHBhdGguam9pbihob21lRGlyLCAnLmpzZm9yY2UnLCAnY29uZmlnLmpzb24nKTtcbn1cblxuLyoqXG4gKlxuICovXG5leHBvcnQgY2xhc3MgRmlsZVJlZ2lzdHJ5IGV4dGVuZHMgQmFzZVJlZ2lzdHJ5IHtcbiAgX2NvbmZpZ0ZpbGVQYXRoOiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IoeyBjb25maWdGaWxlUGF0aCB9OiB7IGNvbmZpZ0ZpbGVQYXRoPzogc3RyaW5nIH0pIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuX2NvbmZpZ0ZpbGVQYXRoID0gY29uZmlnRmlsZVBhdGggfHwgZ2V0RGVmYXVsdENvbmZpZ0ZpbGVQYXRoKCk7XG4gICAgdHJ5IHtcbiAgICAgIHZhciBkYXRhID0gZnMucmVhZEZpbGVTeW5jKHRoaXMuX2NvbmZpZ0ZpbGVQYXRoLCAndXRmLTgnKTtcbiAgICAgIHRoaXMuX3JlZ2lzdHJ5Q29uZmlnID0gSlNPTi5wYXJzZShkYXRhKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAvL1xuICAgIH1cbiAgfVxuXG4gIF9zYXZlQ29uZmlnKCkge1xuICAgIGNvbnN0IGRhdGEgPSBKU09OLnN0cmluZ2lmeSh0aGlzLl9yZWdpc3RyeUNvbmZpZywgbnVsbCwgNCk7XG4gICAgdHJ5IHtcbiAgICAgIGZzLndyaXRlRmlsZVN5bmModGhpcy5fY29uZmlnRmlsZVBhdGgsIGRhdGEpO1xuICAgICAgZnMuY2htb2RTeW5jKHRoaXMuX2NvbmZpZ0ZpbGVQYXRoLCAnNjAwJyk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgY29uc3QgY29uZmlnRGlyID0gcGF0aC5kaXJuYW1lKHRoaXMuX2NvbmZpZ0ZpbGVQYXRoKTtcbiAgICAgIGZzLm1rZGlyU3luYyhjb25maWdEaXIpO1xuICAgICAgZnMuY2htb2RTeW5jKGNvbmZpZ0RpciwgJzcwMCcpO1xuICAgICAgZnMud3JpdGVGaWxlU3luYyh0aGlzLl9jb25maWdGaWxlUGF0aCwgZGF0YSk7XG4gICAgICBmcy5jaG1vZFN5bmModGhpcy5fY29uZmlnRmlsZVBhdGgsICc2MDAnKTtcbiAgICB9XG4gIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQUEsT0FBT0EsRUFBRSxNQUFNLElBQUk7QUFDbkIsT0FBT0MsSUFBSSxNQUFNLE1BQU07QUFDdkIsU0FBU0MsWUFBWSxRQUFRLFFBQVE7O0FBRXJDO0FBQ0E7QUFDQTtBQUNBLFNBQVNDLHdCQUF3QkEsQ0FBQSxFQUFHO0VBQ2xDLElBQU1DLE9BQU8sR0FDWEMsT0FBTyxDQUFDQyxHQUFHLENBQUNELE9BQU8sQ0FBQ0UsUUFBUSxLQUFLLE9BQU8sR0FBRyxhQUFhLEdBQUcsTUFBTSxDQUFDO0VBQ3BFLElBQUksQ0FBQ0gsT0FBTyxFQUFFO0lBQ1osTUFBTSxJQUFJSSxLQUFLLENBQ2IsOERBQ0YsQ0FBQztFQUNIO0VBQ0EsT0FBT1AsSUFBSSxDQUFDUSxJQUFJLENBQUNMLE9BQU8sRUFBRSxVQUFVLEVBQUUsYUFBYSxDQUFDO0FBQ3REOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFdBQWFNLFlBQVksMEJBQUFDLGFBQUE7RUFBQUMsU0FBQSxDQUFBRixZQUFBLEVBQUFDLGFBQUE7RUFBQSxJQUFBRSxNQUFBLEdBQUFDLFlBQUEsQ0FBQUosWUFBQTtFQUd2QixTQUFBQSxhQUFBSyxJQUFBLEVBQTZEO0lBQUEsSUFBQUMsS0FBQTtJQUFBLElBQS9DQyxjQUFjLEdBQUFGLElBQUEsQ0FBZEUsY0FBYztJQUFBQyxlQUFBLE9BQUFSLFlBQUE7SUFDMUJNLEtBQUEsR0FBQUgsTUFBQSxDQUFBTSxJQUFBO0lBQVFDLGVBQUEsQ0FBQUMsc0JBQUEsQ0FBQUwsS0FBQTtJQUNSQSxLQUFBLENBQUtNLGVBQWUsR0FBR0wsY0FBYyxJQUFJZCx3QkFBd0IsQ0FBQyxDQUFDO0lBQ25FLElBQUk7TUFDRixJQUFJb0IsSUFBSSxHQUFHdkIsRUFBRSxDQUFDd0IsWUFBWSxDQUFDUixLQUFBLENBQUtNLGVBQWUsRUFBRSxPQUFPLENBQUM7TUFDekROLEtBQUEsQ0FBS1MsZUFBZSxHQUFHQyxJQUFJLENBQUNDLEtBQUssQ0FBQ0osSUFBSSxDQUFDO0lBQ3pDLENBQUMsQ0FBQyxPQUFPSyxDQUFDLEVBQUU7TUFDVjtJQUFBO0lBQ0QsT0FBQVosS0FBQTtFQUNIO0VBQUNhLFlBQUEsQ0FBQW5CLFlBQUE7SUFBQW9CLEdBQUE7SUFBQUMsS0FBQSxXQUFBQyxZQUFBLEVBRWE7TUFDWixJQUFNVCxJQUFJLEdBQUdVLGVBQUEsQ0FBZSxJQUFJLENBQUNSLGVBQWUsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO01BQzFELElBQUk7UUFDRnpCLEVBQUUsQ0FBQ2tDLGFBQWEsQ0FBQyxJQUFJLENBQUNaLGVBQWUsRUFBRUMsSUFBSSxDQUFDO1FBQzVDdkIsRUFBRSxDQUFDbUMsU0FBUyxDQUFDLElBQUksQ0FBQ2IsZUFBZSxFQUFFLEtBQUssQ0FBQztNQUMzQyxDQUFDLENBQUMsT0FBT00sQ0FBQyxFQUFFO1FBQ1YsSUFBTVEsU0FBUyxHQUFHbkMsSUFBSSxDQUFDb0MsT0FBTyxDQUFDLElBQUksQ0FBQ2YsZUFBZSxDQUFDO1FBQ3BEdEIsRUFBRSxDQUFDc0MsU0FBUyxDQUFDRixTQUFTLENBQUM7UUFDdkJwQyxFQUFFLENBQUNtQyxTQUFTLENBQUNDLFNBQVMsRUFBRSxLQUFLLENBQUM7UUFDOUJwQyxFQUFFLENBQUNrQyxhQUFhLENBQUMsSUFBSSxDQUFDWixlQUFlLEVBQUVDLElBQUksQ0FBQztRQUM1Q3ZCLEVBQUUsQ0FBQ21DLFNBQVMsQ0FBQyxJQUFJLENBQUNiLGVBQWUsRUFBRSxLQUFLLENBQUM7TUFDM0M7SUFDRjtFQUFDO0VBQUEsT0FBQVosWUFBQTtBQUFBLEVBMUIrQlIsWUFBWSJ9