import _Object$defineProperty from "@babel/runtime-corejs3/core-js-stable/object/define-property";
import _Object$defineProperties from "@babel/runtime-corejs3/core-js-stable/object/define-properties";
import _Object$getOwnPropertyDescriptors from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptors";
import _forEachInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/for-each";
import _Object$getOwnPropertyDescriptor from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptor";
import _Object$getOwnPropertySymbols from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-symbols";
import "core-js/modules/es.array.iterator";
import "core-js/modules/es.string.replace";
import _filterInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/filter";
import _mapInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/map";
import _objectWithoutProperties from "@babel/runtime-corejs3/helpers/objectWithoutProperties";
import _defineProperty from "@babel/runtime-corejs3/helpers/defineProperty";
import _Object$keys from "@babel/runtime-corejs3/core-js-stable/object/keys";
import _reduceInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/reduce";
function ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = _filterInstanceProperty(symbols).call(symbols, function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }
function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { var _context3; _forEachInstanceProperty(_context3 = ownKeys(Object(source), true)).call(_context3, function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { var _context4; _forEachInstanceProperty(_context4 = ownKeys(Object(source))).call(_context4, function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }
/**
 * @file Represents stream that handles Salesforce record as stream data
 * @author Shinichi Tomita <shinichi.tomita@gmail.com>
 */
import { Transform, PassThrough } from 'stream';
import { serializeCSVStream, parseCSVStream } from './csv';
import { concatStreamsAsDuplex } from './util/stream';

/**
 * type defs
 */

/**
 * @private
 */
function evalMapping(value, mapping) {
  if (typeof value === 'string') {
    const m = /^\$\{(\w+)\}$/.exec(value);
    if (m) {
      return mapping[m[1]];
    }
    return value.replace(/\$\{(\w+)\}/g, ($0, prop) => {
      const v = mapping[prop];
      return typeof v === 'undefined' || v === null ? '' : String(v);
    });
  }
  return value;
}

/**
 * @private
 */
function convertRecordForSerialization(record, options = {}) {
  var _context;
  return _reduceInstanceProperty(_context = _Object$keys(record)).call(_context, (rec, key) => {
    const value = rec[key];
    let urec;
    if (key === 'attributes') {
      // 'attributes' prop will be ignored
      urec = _objectSpread({}, rec);
      delete urec[key];
      return urec;
    } else if (options.nullValue && value === null) {
      return _objectSpread(_objectSpread({}, rec), {}, {
        [key]: options.nullValue
      });
    } else if (value !== null && typeof value === 'object') {
      var _context2;
      const precord = convertRecordForSerialization(value, options);
      return _reduceInstanceProperty(_context2 = _Object$keys(precord)).call(_context2, (prec, pkey) => {
        prec[`${key}.${pkey}`] = precord[pkey]; // eslint-disable-line no-param-reassign
        return prec;
      }, _objectSpread({}, rec));
    }
    return rec;
  }, record);
}

/**
 * @private
 */
function createPipelineStream(s1, s2) {
  s1.pipe(s2);
  return concatStreamsAsDuplex(s1, s2, {
    writableObjectMode: true
  });
}
/**
 * @private
 */
const CSVStreamConverter = {
  serialize(options = {}) {
    const {
        nullValue
      } = options,
      csvOpts = _objectWithoutProperties(options, ["nullValue"]);
    return createPipelineStream(
    // eslint-disable-next-line no-use-before-define
    _mapInstanceProperty(RecordStream).call(RecordStream, record => convertRecordForSerialization(record, options)), serializeCSVStream(csvOpts));
  },
  parse(options = {}) {
    return parseCSVStream(options);
  }
};

/**
 * @private
 */
const DataStreamConverters = {
  csv: CSVStreamConverter
};

/**
 * Class for Record Stream
 *
 * @class
 * @constructor
 * @extends stream.Transform
 */
export class RecordStream extends PassThrough {
  /**
   *
   */
  constructor() {
    super({
      objectMode: true
    });
    _defineProperty(this, "addListener", this.on);
  }

  /**
   * Get record stream of queried records applying the given mapping function
   */
  map(fn) {
    return this.pipe(_mapInstanceProperty(RecordStream).call(RecordStream, fn));
  }

  /**
   * Get record stream of queried records, applying the given filter function
   */
  filter(fn) {
    return this.pipe(_filterInstanceProperty(RecordStream).call(RecordStream, fn));
  }

  /* @override */
  on(ev, fn) {
    return super.on(ev === 'record' ? 'data' : ev, fn);
  }

  /* @override */

  /* --------------------------------------------------- */
  /**
   * Create a record stream which maps records and pass them to downstream
   */
  static map(fn) {
    const mapStream = new Transform({
      objectMode: true,
      transform(record, enc, callback) {
        const rec = fn(record) || record; // if not returned record, use same record
        mapStream.push(rec);
        callback();
      }
    });
    return mapStream;
  }

  /**
   * Create mapping stream using given record template
   */
  static recordMapStream(record, noeval) {
    return _mapInstanceProperty(RecordStream).call(RecordStream, rec => {
      const mapped = {
        Id: rec.Id
      };
      for (const prop of _Object$keys(record)) {
        mapped[prop] = noeval ? record[prop] : evalMapping(record[prop], rec);
      }
      return mapped;
    });
  }

  /**
   * Create a record stream which filters records and pass them to downstream
   *
   * @param {RecordFilterFunction} fn - Record filtering function
   * @returns {RecordStream.Serializable}
   */
  static filter(fn) {
    const filterStream = new Transform({
      objectMode: true,
      transform(record, enc, callback) {
        if (fn(record)) {
          filterStream.push(record);
        }
        callback();
      }
    });
    return filterStream;
  }
}

/**
 * @class RecordStream.Serializable
 * @extends {RecordStream}
 */
export class Serializable extends RecordStream {
  constructor(...args) {
    super(...args);
    _defineProperty(this, "_dataStreams", {});
  }
  /**
   * Get readable data stream which emits serialized record data
   */
  stream(type = 'csv', options = {}) {
    if (this._dataStreams[type]) {
      return this._dataStreams[type];
    }
    const converter = DataStreamConverters[type];
    if (!converter) {
      throw new Error(`Converting [${type}] data stream is not supported.`);
    }
    const dataStream = new PassThrough();
    this.pipe(converter.serialize(options)).pipe(dataStream);
    this._dataStreams[type] = dataStream;
    return dataStream;
  }
}

/**
 * @class RecordStream.Parsable
 * @extends {RecordStream}
 */
export class Parsable extends RecordStream {
  constructor(...args) {
    super(...args);
    _defineProperty(this, "_dataStreams", {});
    _defineProperty(this, "_execParse", false);
    _defineProperty(this, "_incomings", []);
    _defineProperty(this, "addListener", this.on);
  }
  /**
   * Get writable data stream which accepts serialized record data
   */
  stream(type = 'csv', options = {}) {
    if (this._dataStreams[type]) {
      return this._dataStreams[type];
    }
    const converter = DataStreamConverters[type];
    if (!converter) {
      throw new Error(`Converting [${type}] data stream is not supported.`);
    }
    const dataStream = new PassThrough();
    const parserStream = converter.parse(options);
    parserStream.on('error', err => this.emit('error', err));
    parserStream.pipe(this).pipe(new PassThrough({
      objectMode: true,
      highWaterMark: 500 * 1000
    }));
    if (this._execParse) {
      dataStream.pipe(parserStream);
    } else {
      this._incomings.push([dataStream, parserStream]);
    }
    this._dataStreams[type] = dataStream;
    return dataStream;
  }

  /* @override */
  on(ev, fn) {
    if (ev === 'readable' || ev === 'record') {
      if (!this._execParse) {
        this._execParse = true;
        for (const [dataStream, parserStream] of this._incomings) {
          dataStream.pipe(parserStream);
        }
      }
    }
    return super.on(ev, fn);
  }

  /* @override */
}

export default RecordStream;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJUcmFuc2Zvcm0iLCJQYXNzVGhyb3VnaCIsInNlcmlhbGl6ZUNTVlN0cmVhbSIsInBhcnNlQ1NWU3RyZWFtIiwiY29uY2F0U3RyZWFtc0FzRHVwbGV4IiwiZXZhbE1hcHBpbmciLCJ2YWx1ZSIsIm1hcHBpbmciLCJtIiwiZXhlYyIsInJlcGxhY2UiLCIkMCIsInByb3AiLCJ2IiwiU3RyaW5nIiwiY29udmVydFJlY29yZEZvclNlcmlhbGl6YXRpb24iLCJyZWNvcmQiLCJvcHRpb25zIiwiX2NvbnRleHQiLCJfcmVkdWNlSW5zdGFuY2VQcm9wZXJ0eSIsIl9PYmplY3Qka2V5cyIsImNhbGwiLCJyZWMiLCJrZXkiLCJ1cmVjIiwiX29iamVjdFNwcmVhZCIsIm51bGxWYWx1ZSIsIl9jb250ZXh0MiIsInByZWNvcmQiLCJwcmVjIiwicGtleSIsImNyZWF0ZVBpcGVsaW5lU3RyZWFtIiwiczEiLCJzMiIsInBpcGUiLCJ3cml0YWJsZU9iamVjdE1vZGUiLCJDU1ZTdHJlYW1Db252ZXJ0ZXIiLCJzZXJpYWxpemUiLCJjc3ZPcHRzIiwiX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzIiwiX21hcEluc3RhbmNlUHJvcGVydHkiLCJSZWNvcmRTdHJlYW0iLCJwYXJzZSIsIkRhdGFTdHJlYW1Db252ZXJ0ZXJzIiwiY3N2IiwiY29uc3RydWN0b3IiLCJvYmplY3RNb2RlIiwiX2RlZmluZVByb3BlcnR5Iiwib24iLCJtYXAiLCJmbiIsImZpbHRlciIsIl9maWx0ZXJJbnN0YW5jZVByb3BlcnR5IiwiZXYiLCJtYXBTdHJlYW0iLCJ0cmFuc2Zvcm0iLCJlbmMiLCJjYWxsYmFjayIsInB1c2giLCJyZWNvcmRNYXBTdHJlYW0iLCJub2V2YWwiLCJtYXBwZWQiLCJJZCIsImZpbHRlclN0cmVhbSIsIlNlcmlhbGl6YWJsZSIsImFyZ3MiLCJzdHJlYW0iLCJ0eXBlIiwiX2RhdGFTdHJlYW1zIiwiY29udmVydGVyIiwiRXJyb3IiLCJkYXRhU3RyZWFtIiwiUGFyc2FibGUiLCJwYXJzZXJTdHJlYW0iLCJlcnIiLCJlbWl0IiwiaGlnaFdhdGVyTWFyayIsIl9leGVjUGFyc2UiLCJfaW5jb21pbmdzIl0sInNvdXJjZXMiOlsiLi4vc3JjL3JlY29yZC1zdHJlYW0udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSBSZXByZXNlbnRzIHN0cmVhbSB0aGF0IGhhbmRsZXMgU2FsZXNmb3JjZSByZWNvcmQgYXMgc3RyZWFtIGRhdGFcbiAqIEBhdXRob3IgU2hpbmljaGkgVG9taXRhIDxzaGluaWNoaS50b21pdGFAZ21haWwuY29tPlxuICovXG5pbXBvcnQgeyBSZWFkYWJsZSwgV3JpdGFibGUsIER1cGxleCwgVHJhbnNmb3JtLCBQYXNzVGhyb3VnaCB9IGZyb20gJ3N0cmVhbSc7XG5pbXBvcnQgeyBSZWNvcmQsIE9wdGlvbmFsIH0gZnJvbSAnLi90eXBlcyc7XG5pbXBvcnQgeyBzZXJpYWxpemVDU1ZTdHJlYW0sIHBhcnNlQ1NWU3RyZWFtIH0gZnJvbSAnLi9jc3YnO1xuaW1wb3J0IHsgY29uY2F0U3RyZWFtc0FzRHVwbGV4IH0gZnJvbSAnLi91dGlsL3N0cmVhbSc7XG5cbi8qKlxuICogdHlwZSBkZWZzXG4gKi9cbmV4cG9ydCB0eXBlIFJlY29yZFN0cmVhbVNlcmlhbGl6ZU9wdGlvbiA9IHtcbiAgbnVsbFZhbHVlPzogYW55O1xufTtcblxuZXhwb3J0IHR5cGUgUmVjb3JkU3RyZWFtUGFyc2VPcHRpb24gPSB7fTtcblxuLyoqXG4gKiBAcHJpdmF0ZVxuICovXG5mdW5jdGlvbiBldmFsTWFwcGluZyh2YWx1ZTogYW55LCBtYXBwaW5nOiB7IFtwcm9wOiBzdHJpbmddOiBzdHJpbmcgfSkge1xuICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgIGNvbnN0IG0gPSAvXlxcJFxceyhcXHcrKVxcfSQvLmV4ZWModmFsdWUpO1xuICAgIGlmIChtKSB7XG4gICAgICByZXR1cm4gbWFwcGluZ1ttWzFdXTtcbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlLnJlcGxhY2UoL1xcJFxceyhcXHcrKVxcfS9nLCAoJDAsIHByb3ApID0+IHtcbiAgICAgIGNvbnN0IHYgPSBtYXBwaW5nW3Byb3BdO1xuICAgICAgcmV0dXJuIHR5cGVvZiB2ID09PSAndW5kZWZpbmVkJyB8fCB2ID09PSBudWxsID8gJycgOiBTdHJpbmcodik7XG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIHZhbHVlO1xufVxuXG4vKipcbiAqIEBwcml2YXRlXG4gKi9cbmZ1bmN0aW9uIGNvbnZlcnRSZWNvcmRGb3JTZXJpYWxpemF0aW9uKFxuICByZWNvcmQ6IFJlY29yZCxcbiAgb3B0aW9uczogeyBudWxsVmFsdWU/OiBib29sZWFuIH0gPSB7fSxcbik6IFJlY29yZCB7XG4gIHJldHVybiBPYmplY3Qua2V5cyhyZWNvcmQpLnJlZHVjZSgocmVjOiBSZWNvcmQsIGtleTogc3RyaW5nKSA9PiB7XG4gICAgY29uc3QgdmFsdWUgPSAocmVjIGFzIGFueSlba2V5XTtcbiAgICBsZXQgdXJlYzogUmVjb3JkO1xuICAgIGlmIChrZXkgPT09ICdhdHRyaWJ1dGVzJykge1xuICAgICAgLy8gJ2F0dHJpYnV0ZXMnIHByb3Agd2lsbCBiZSBpZ25vcmVkXG4gICAgICB1cmVjID0geyAuLi5yZWMgfTtcbiAgICAgIGRlbGV0ZSB1cmVjW2tleV07XG4gICAgICByZXR1cm4gdXJlYztcbiAgICB9IGVsc2UgaWYgKG9wdGlvbnMubnVsbFZhbHVlICYmIHZhbHVlID09PSBudWxsKSB7XG4gICAgICByZXR1cm4geyAuLi5yZWMsIFtrZXldOiBvcHRpb25zLm51bGxWYWx1ZSB9IGFzIFJlY29yZDtcbiAgICB9IGVsc2UgaWYgKHZhbHVlICE9PSBudWxsICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcpIHtcbiAgICAgIGNvbnN0IHByZWNvcmQgPSBjb252ZXJ0UmVjb3JkRm9yU2VyaWFsaXphdGlvbih2YWx1ZSwgb3B0aW9ucyk7XG4gICAgICByZXR1cm4gT2JqZWN0LmtleXMocHJlY29yZCkucmVkdWNlKFxuICAgICAgICAocHJlYzogUmVjb3JkLCBwa2V5KSA9PiB7XG4gICAgICAgICAgcHJlY1tgJHtrZXl9LiR7cGtleX1gXSA9IHByZWNvcmRbcGtleV07IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tcGFyYW0tcmVhc3NpZ25cbiAgICAgICAgICByZXR1cm4gcHJlYztcbiAgICAgICAgfSxcbiAgICAgICAgeyAuLi5yZWMgfSxcbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiByZWM7XG4gIH0sIHJlY29yZCk7XG59XG5cbi8qKlxuICogQHByaXZhdGVcbiAqL1xuZnVuY3Rpb24gY3JlYXRlUGlwZWxpbmVTdHJlYW0oczE6IER1cGxleCwgczI6IER1cGxleCkge1xuICBzMS5waXBlKHMyKTtcbiAgcmV0dXJuIGNvbmNhdFN0cmVhbXNBc0R1cGxleChzMSwgczIsIHsgd3JpdGFibGVPYmplY3RNb2RlOiB0cnVlIH0pO1xufVxuXG50eXBlIFN0cmVhbUNvbnZlcnRlciA9IHtcbiAgc2VyaWFsaXplOiAob3B0aW9ucz86IFJlY29yZFN0cmVhbVNlcmlhbGl6ZU9wdGlvbikgPT4gRHVwbGV4O1xuICBwYXJzZTogKG9wdGlvbnM/OiBSZWNvcmRTdHJlYW1QYXJzZU9wdGlvbikgPT4gRHVwbGV4O1xufTtcblxuLyoqXG4gKiBAcHJpdmF0ZVxuICovXG5jb25zdCBDU1ZTdHJlYW1Db252ZXJ0ZXI6IFN0cmVhbUNvbnZlcnRlciA9IHtcbiAgc2VyaWFsaXplKG9wdGlvbnM6IFJlY29yZFN0cmVhbVNlcmlhbGl6ZU9wdGlvbiA9IHt9KSB7XG4gICAgY29uc3QgeyBudWxsVmFsdWUsIC4uLmNzdk9wdHMgfSA9IG9wdGlvbnM7XG4gICAgcmV0dXJuIGNyZWF0ZVBpcGVsaW5lU3RyZWFtKFxuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVzZS1iZWZvcmUtZGVmaW5lXG4gICAgICBSZWNvcmRTdHJlYW0ubWFwKChyZWNvcmQpID0+XG4gICAgICAgIGNvbnZlcnRSZWNvcmRGb3JTZXJpYWxpemF0aW9uKHJlY29yZCwgb3B0aW9ucyksXG4gICAgICApLFxuICAgICAgc2VyaWFsaXplQ1NWU3RyZWFtKGNzdk9wdHMpLFxuICAgICk7XG4gIH0sXG4gIHBhcnNlKG9wdGlvbnM6IFJlY29yZFN0cmVhbVBhcnNlT3B0aW9uID0ge30pIHtcbiAgICByZXR1cm4gcGFyc2VDU1ZTdHJlYW0ob3B0aW9ucyk7XG4gIH0sXG59O1xuXG4vKipcbiAqIEBwcml2YXRlXG4gKi9cbmNvbnN0IERhdGFTdHJlYW1Db252ZXJ0ZXJzOiB7IFtrZXk6IHN0cmluZ106IFN0cmVhbUNvbnZlcnRlciB9ID0ge1xuICBjc3Y6IENTVlN0cmVhbUNvbnZlcnRlcixcbn07XG5cbi8qKlxuICogQ2xhc3MgZm9yIFJlY29yZCBTdHJlYW1cbiAqXG4gKiBAY2xhc3NcbiAqIEBjb25zdHJ1Y3RvclxuICogQGV4dGVuZHMgc3RyZWFtLlRyYW5zZm9ybVxuICovXG5leHBvcnQgY2xhc3MgUmVjb3JkU3RyZWFtPFIgZXh0ZW5kcyBSZWNvcmQgPSBSZWNvcmQ+IGV4dGVuZHMgUGFzc1Rocm91Z2gge1xuICAvKipcbiAgICpcbiAgICovXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKHsgb2JqZWN0TW9kZTogdHJ1ZSB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgcmVjb3JkIHN0cmVhbSBvZiBxdWVyaWVkIHJlY29yZHMgYXBwbHlpbmcgdGhlIGdpdmVuIG1hcHBpbmcgZnVuY3Rpb25cbiAgICovXG4gIG1hcDxSUiBleHRlbmRzIFJlY29yZD4oZm46IChyZWM6IFIpID0+IE9wdGlvbmFsPFJSPikge1xuICAgIHJldHVybiB0aGlzLnBpcGUoUmVjb3JkU3RyZWFtLm1hcDxSLCBSUj4oZm4pKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgcmVjb3JkIHN0cmVhbSBvZiBxdWVyaWVkIHJlY29yZHMsIGFwcGx5aW5nIHRoZSBnaXZlbiBmaWx0ZXIgZnVuY3Rpb25cbiAgICovXG4gIGZpbHRlcihmbjogKHJlYzogUikgPT4gYm9vbGVhbik6IER1cGxleCB7XG4gICAgcmV0dXJuIHRoaXMucGlwZShSZWNvcmRTdHJlYW0uZmlsdGVyPFI+KGZuKSk7XG4gIH1cblxuICAvKiBAb3ZlcnJpZGUgKi9cbiAgb24oZXY6IHN0cmluZywgZm46ICguLi5hcmdzOiBhbnlbXSkgPT4gdm9pZCkge1xuICAgIHJldHVybiBzdXBlci5vbihldiA9PT0gJ3JlY29yZCcgPyAnZGF0YScgOiBldiwgZm4pO1xuICB9XG5cbiAgLyogQG92ZXJyaWRlICovXG4gIGFkZExpc3RlbmVyID0gdGhpcy5vbjtcblxuICAvKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuICAvKipcbiAgICogQ3JlYXRlIGEgcmVjb3JkIHN0cmVhbSB3aGljaCBtYXBzIHJlY29yZHMgYW5kIHBhc3MgdGhlbSB0byBkb3duc3RyZWFtXG4gICAqL1xuICBzdGF0aWMgbWFwPFIxIGV4dGVuZHMgUmVjb3JkID0gUmVjb3JkLCBSMiBleHRlbmRzIFJlY29yZCA9IFJlY29yZD4oXG4gICAgZm46IChyZWM6IFIxKSA9PiBPcHRpb25hbDxSMj4sXG4gICkge1xuICAgIGNvbnN0IG1hcFN0cmVhbSA9IG5ldyBUcmFuc2Zvcm0oe1xuICAgICAgb2JqZWN0TW9kZTogdHJ1ZSxcbiAgICAgIHRyYW5zZm9ybShyZWNvcmQsIGVuYywgY2FsbGJhY2spIHtcbiAgICAgICAgY29uc3QgcmVjID0gZm4ocmVjb3JkKSB8fCByZWNvcmQ7IC8vIGlmIG5vdCByZXR1cm5lZCByZWNvcmQsIHVzZSBzYW1lIHJlY29yZFxuICAgICAgICBtYXBTdHJlYW0ucHVzaChyZWMpO1xuICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgfSxcbiAgICB9KTtcbiAgICByZXR1cm4gbWFwU3RyZWFtO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBtYXBwaW5nIHN0cmVhbSB1c2luZyBnaXZlbiByZWNvcmQgdGVtcGxhdGVcbiAgICovXG4gIHN0YXRpYyByZWNvcmRNYXBTdHJlYW08XG4gICAgUjEgZXh0ZW5kcyBSZWNvcmQgPSBSZWNvcmQsXG4gICAgUjIgZXh0ZW5kcyBSZWNvcmQgPSBSZWNvcmRcbiAgPihyZWNvcmQ6IFIyLCBub2V2YWw/OiBib29sZWFuKSB7XG4gICAgcmV0dXJuIFJlY29yZFN0cmVhbS5tYXA8UjEsIFIyPigocmVjKSA9PiB7XG4gICAgICBjb25zdCBtYXBwZWQ6IFJlY29yZCA9IHsgSWQ6IHJlYy5JZCB9O1xuICAgICAgZm9yIChjb25zdCBwcm9wIG9mIE9iamVjdC5rZXlzKHJlY29yZCkpIHtcbiAgICAgICAgbWFwcGVkW3Byb3BdID0gbm9ldmFsID8gcmVjb3JkW3Byb3BdIDogZXZhbE1hcHBpbmcocmVjb3JkW3Byb3BdLCByZWMpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG1hcHBlZCBhcyBSMjtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSByZWNvcmQgc3RyZWFtIHdoaWNoIGZpbHRlcnMgcmVjb3JkcyBhbmQgcGFzcyB0aGVtIHRvIGRvd25zdHJlYW1cbiAgICpcbiAgICogQHBhcmFtIHtSZWNvcmRGaWx0ZXJGdW5jdGlvbn0gZm4gLSBSZWNvcmQgZmlsdGVyaW5nIGZ1bmN0aW9uXG4gICAqIEByZXR1cm5zIHtSZWNvcmRTdHJlYW0uU2VyaWFsaXphYmxlfVxuICAgKi9cbiAgc3RhdGljIGZpbHRlcjxSMSBleHRlbmRzIFJlY29yZCA9IFJlY29yZD4oZm46IChyZWM6IFIxKSA9PiBib29sZWFuKTogRHVwbGV4IHtcbiAgICBjb25zdCBmaWx0ZXJTdHJlYW0gPSBuZXcgVHJhbnNmb3JtKHtcbiAgICAgIG9iamVjdE1vZGU6IHRydWUsXG4gICAgICB0cmFuc2Zvcm0ocmVjb3JkLCBlbmMsIGNhbGxiYWNrKSB7XG4gICAgICAgIGlmIChmbihyZWNvcmQpKSB7XG4gICAgICAgICAgZmlsdGVyU3RyZWFtLnB1c2gocmVjb3JkKTtcbiAgICAgICAgfVxuICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgfSxcbiAgICB9KTtcbiAgICByZXR1cm4gZmlsdGVyU3RyZWFtO1xuICB9XG59XG5cbi8qKlxuICogQGNsYXNzIFJlY29yZFN0cmVhbS5TZXJpYWxpemFibGVcbiAqIEBleHRlbmRzIHtSZWNvcmRTdHJlYW19XG4gKi9cbmV4cG9ydCBjbGFzcyBTZXJpYWxpemFibGU8UiBleHRlbmRzIFJlY29yZCA9IFJlY29yZD4gZXh0ZW5kcyBSZWNvcmRTdHJlYW08Uj4ge1xuICBfZGF0YVN0cmVhbXM6IHsgW3R5cGU6IHN0cmluZ106IER1cGxleCB9ID0ge307XG5cbiAgLyoqXG4gICAqIEdldCByZWFkYWJsZSBkYXRhIHN0cmVhbSB3aGljaCBlbWl0cyBzZXJpYWxpemVkIHJlY29yZCBkYXRhXG4gICAqL1xuICBzdHJlYW0odHlwZTogc3RyaW5nID0gJ2NzdicsIG9wdGlvbnM6IE9iamVjdCA9IHt9KTogRHVwbGV4IHtcbiAgICBpZiAodGhpcy5fZGF0YVN0cmVhbXNbdHlwZV0pIHtcbiAgICAgIHJldHVybiB0aGlzLl9kYXRhU3RyZWFtc1t0eXBlXTtcbiAgICB9XG4gICAgY29uc3QgY29udmVydGVyOiBPcHRpb25hbDxTdHJlYW1Db252ZXJ0ZXI+ID0gRGF0YVN0cmVhbUNvbnZlcnRlcnNbdHlwZV07XG4gICAgaWYgKCFjb252ZXJ0ZXIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQ29udmVydGluZyBbJHt0eXBlfV0gZGF0YSBzdHJlYW0gaXMgbm90IHN1cHBvcnRlZC5gKTtcbiAgICB9XG4gICAgY29uc3QgZGF0YVN0cmVhbSA9IG5ldyBQYXNzVGhyb3VnaCgpO1xuICAgIHRoaXMucGlwZShjb252ZXJ0ZXIuc2VyaWFsaXplKG9wdGlvbnMpKS5waXBlKGRhdGFTdHJlYW0pO1xuICAgIHRoaXMuX2RhdGFTdHJlYW1zW3R5cGVdID0gZGF0YVN0cmVhbTtcbiAgICByZXR1cm4gZGF0YVN0cmVhbTtcbiAgfVxufVxuXG4vKipcbiAqIEBjbGFzcyBSZWNvcmRTdHJlYW0uUGFyc2FibGVcbiAqIEBleHRlbmRzIHtSZWNvcmRTdHJlYW19XG4gKi9cbmV4cG9ydCBjbGFzcyBQYXJzYWJsZTxSIGV4dGVuZHMgUmVjb3JkID0gUmVjb3JkPiBleHRlbmRzIFJlY29yZFN0cmVhbTxSPiB7XG4gIF9kYXRhU3RyZWFtczogeyBbdHlwZTogc3RyaW5nXTogRHVwbGV4IH0gPSB7fTtcbiAgX2V4ZWNQYXJzZTogYm9vbGVhbiA9IGZhbHNlO1xuICBfaW5jb21pbmdzOiBBcnJheTxbUmVhZGFibGUsIFdyaXRhYmxlXT4gPSBbXTtcblxuICAvKipcbiAgICogR2V0IHdyaXRhYmxlIGRhdGEgc3RyZWFtIHdoaWNoIGFjY2VwdHMgc2VyaWFsaXplZCByZWNvcmQgZGF0YVxuICAgKi9cbiAgc3RyZWFtKHR5cGU6IHN0cmluZyA9ICdjc3YnLCBvcHRpb25zOiBPYmplY3QgPSB7fSk6IER1cGxleCB7XG4gICAgaWYgKHRoaXMuX2RhdGFTdHJlYW1zW3R5cGVdKSB7XG4gICAgICByZXR1cm4gdGhpcy5fZGF0YVN0cmVhbXNbdHlwZV07XG4gICAgfVxuICAgIGNvbnN0IGNvbnZlcnRlcjogT3B0aW9uYWw8U3RyZWFtQ29udmVydGVyPiA9IERhdGFTdHJlYW1Db252ZXJ0ZXJzW3R5cGVdO1xuICAgIGlmICghY29udmVydGVyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYENvbnZlcnRpbmcgWyR7dHlwZX1dIGRhdGEgc3RyZWFtIGlzIG5vdCBzdXBwb3J0ZWQuYCk7XG4gICAgfVxuICAgIGNvbnN0IGRhdGFTdHJlYW0gPSBuZXcgUGFzc1Rocm91Z2goKTtcbiAgICBjb25zdCBwYXJzZXJTdHJlYW0gPSBjb252ZXJ0ZXIucGFyc2Uob3B0aW9ucyk7XG4gICAgcGFyc2VyU3RyZWFtLm9uKCdlcnJvcicsIChlcnIpID0+IHRoaXMuZW1pdCgnZXJyb3InLCBlcnIpKTtcbiAgICBwYXJzZXJTdHJlYW1cbiAgICAgIC5waXBlKHRoaXMpXG4gICAgICAucGlwZShuZXcgUGFzc1Rocm91Z2goeyBvYmplY3RNb2RlOiB0cnVlLCBoaWdoV2F0ZXJNYXJrOiA1MDAgKiAxMDAwIH0pKTtcbiAgICBpZiAodGhpcy5fZXhlY1BhcnNlKSB7XG4gICAgICBkYXRhU3RyZWFtLnBpcGUocGFyc2VyU3RyZWFtKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5faW5jb21pbmdzLnB1c2goW2RhdGFTdHJlYW0sIHBhcnNlclN0cmVhbV0pO1xuICAgIH1cbiAgICB0aGlzLl9kYXRhU3RyZWFtc1t0eXBlXSA9IGRhdGFTdHJlYW07XG4gICAgcmV0dXJuIGRhdGFTdHJlYW07XG4gIH1cblxuICAvKiBAb3ZlcnJpZGUgKi9cbiAgb24oZXY6IHN0cmluZywgZm46ICguLi5hcmdzOiBhbnlbXSkgPT4gdm9pZCkge1xuICAgIGlmIChldiA9PT0gJ3JlYWRhYmxlJyB8fCBldiA9PT0gJ3JlY29yZCcpIHtcbiAgICAgIGlmICghdGhpcy5fZXhlY1BhcnNlKSB7XG4gICAgICAgIHRoaXMuX2V4ZWNQYXJzZSA9IHRydWU7XG4gICAgICAgIGZvciAoY29uc3QgW2RhdGFTdHJlYW0sIHBhcnNlclN0cmVhbV0gb2YgdGhpcy5faW5jb21pbmdzKSB7XG4gICAgICAgICAgZGF0YVN0cmVhbS5waXBlKHBhcnNlclN0cmVhbSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHN1cGVyLm9uKGV2LCBmbik7XG4gIH1cblxuICAvKiBAb3ZlcnJpZGUgKi9cbiAgYWRkTGlzdGVuZXIgPSB0aGlzLm9uO1xufVxuXG5leHBvcnQgZGVmYXVsdCBSZWNvcmRTdHJlYW07XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQXFDQSxTQUFTLEVBQUVDLFdBQVcsUUFBUSxRQUFRO0FBRTNFLFNBQVNDLGtCQUFrQixFQUFFQyxjQUFjLFFBQVEsT0FBTztBQUMxRCxTQUFTQyxxQkFBcUIsUUFBUSxlQUFlOztBQUVyRDtBQUNBO0FBQ0E7O0FBT0E7QUFDQTtBQUNBO0FBQ0EsU0FBU0MsV0FBV0EsQ0FBQ0MsS0FBVSxFQUFFQyxPQUFtQyxFQUFFO0VBQ3BFLElBQUksT0FBT0QsS0FBSyxL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