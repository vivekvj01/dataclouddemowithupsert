import _Object$defineProperty from "@babel/runtime-corejs3/core-js-stable/object/define-property";
import _Object$defineProperties from "@babel/runtime-corejs3/core-js-stable/object/define-properties";
import _Object$getOwnPropertyDescriptors from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptors";
import _forEachInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/for-each";
import _Object$getOwnPropertyDescriptor from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptor";
import _Object$getOwnPropertySymbols from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-symbols";
import "core-js/modules/es.array.iterator";
import "core-js/modules/es.promise";
import _defineProperty from "@babel/runtime-corejs3/helpers/defineProperty";
import _Object$keys from "@babel/runtime-corejs3/core-js-stable/object/keys";
import _filterInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/filter";
import _objectWithoutProperties from "@babel/runtime-corejs3/helpers/objectWithoutProperties";
import _Array$isArray from "@babel/runtime-corejs3/core-js-stable/array/is-array";
import _mapInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/map";
function ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = _filterInstanceProperty(symbols).call(symbols, function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }
function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { var _context3; _forEachInstanceProperty(_context3 = ownKeys(Object(source), true)).call(_context3, function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { var _context4; _forEachInstanceProperty(_context4 = ownKeys(Object(source))).call(_context4, function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }
/**
 * @file Salesforce SOAP API
 * @author Shinichi Tomita <shinichi.tomita@gmail.com>
 */
import { registerModule } from '../jsforce';
import SOAP from '../soap';
import { ApiSchemas } from './soap/schema';

/**
 *
 */
function toSoapRecord(records) {
  var _context;
  return _mapInstanceProperty(_context = _Array$isArray(records) ? records : [records]).call(_context, record => {
    var _context2;
    const {
        type,
        attributes
      } = record,
      rec = _objectWithoutProperties(record, ["type", "attributes"]);
    const t = type || (attributes === null || attributes === void 0 ? void 0 : attributes.type);
    if (!t) {
      throw new Error('Given record is not including sObject type information');
    }
    const fieldsToNull = _filterInstanceProperty(_context2 = _Object$keys(rec)).call(_context2, field => record[field] === null);
    for (const field of fieldsToNull) {
      delete rec[field];
    }
    return fieldsToNull.length > 0 ? _objectSpread({
      type: t,
      fieldsToNull
    }, rec) : _objectSpread({
      type: t
    }, rec);
  });
}

/**
 * API class for Partner SOAP call
 */
export class SoapApi {
  constructor(conn) {
    _defineProperty(this, "_conn", void 0);
    this._conn = conn;
  }

  /**
   * Call SOAP Api (Partner) endpoint
   * @private
   */
  async _invoke(method, message, schema) {
    const soapEndpoint = new SOAP(this._conn, {
      xmlns: 'urn:partner.soap.sforce.com',
      endpointUrl: `${this._conn.instanceUrl}/services/Soap/u/${this._conn.version}`
    });
    const res = await soapEndpoint.invoke(method, message, schema ? {
      result: schema
    } : undefined, ApiSchemas);
    return res.result;
  }

  /**
   * Converts a Lead into an Account, Contact, or (optionally) an Opportunity.
   */

  async convertLead(leadConverts) {
    const schema = _Array$isArray(leadConverts) ? [ApiSchemas.LeadConvertResult] : ApiSchemas.LeadConvertResult;
    return this._invoke('convertLead', {
      leadConverts
    }, schema);
  }

  /**
   * Merge up to three records into one
   */

  async merge(mergeRequests) {
    const schema = _Array$isArray(mergeRequests) ? [ApiSchemas.MergeResult] : ApiSchemas.MergeResult;
    return this._invoke('merge', {
      mergeRequests
    }, schema);
  }

  /**
   * Delete records from the recycle bin immediately
   */
  async emptyRecycleBin(ids) {
    return this._invoke('emptyRecycleBin', {
      ids
    }, [ApiSchemas.EmptyRecycleBinResult]);
  }

  /**
   * Returns information about the standard and custom apps available to the logged-in user
   */
  async describeTabs() {
    return this._invoke('describeTabs', {}, [ApiSchemas.DescribeTabSetResult]);
  }

  /**
   * Retrieves the current system timestamp (Coordinated Universal Time (UTC) time zone) from the API
   */
  async getServerTimestamp() {
    return this._invoke('getServerTimestamp', {}, ApiSchemas.GetServerTimestampResult);
  }

  /**
   * Retrieves personal information for the user associated with the current session
   */
  async getUserInfo() {
    return this._invoke('getUserInfo', {}, ApiSchemas.GetUserInfoResult);
  }

  /**
   * Sets the specified user’s password to the specified value
   */
  setPassword(userId, password) {
    return this._invoke('setPassword', {
      userId,
      password
    }, 'string');
  }

  /**
   * Resets the specified user’s password
   */
  resetPassword(userId) {
    return this._invoke('resetPassword', {
      userId
    }, ApiSchemas.ResetPasswordResult);
  }

  /**
   * Adds one or more new records to your organization’s data
   */

  create(sObjects) {
    const schema = _Array$isArray(sObjects) ? [ApiSchemas.SaveResult] : ApiSchemas.SaveResult;
    const args = {
      '@xmlns': 'urn:partner.soap.sforce.com',
      '@xmlns:ns1': 'sobject.partner.soap.sforce.com',
      'ns1:sObjects': toSoapRecord(sObjects)
    };
    return this._invoke('create', args, schema);
  }

  /**
   * Updates one or more existing records in your organization’s data.
   */

  update(sObjects) {
    const schema = _Array$isArray(sObjects) ? [ApiSchemas.SaveResult] : ApiSchemas.SaveResult;
    const args = {
      '@xmlns': 'urn:partner.soap.sforce.com',
      '@xmlns:ns1': 'sobject.partner.soap.sforce.com',
      'ns1:sObjects': toSoapRecord(sObjects)
    };
    return this._invoke('update', args, schema);
  }

  /**
   * Creates new records and updates existing records in your organization’s data.
   */

  upsert(externalIdFieldName, sObjects) {
    const schema = _Array$isArray(sObjects) ? [ApiSchemas.UpsertResult] : ApiSchemas.UpsertResult;
    const args = {
      '@xmlns': 'urn:partner.soap.sforce.com',
      '@xmlns:ns1': 'sobject.partner.soap.sforce.com',
      'ns1:externalIDFieldName': externalIdFieldName,
      'ns1:sObjects': toSoapRecord(sObjects)
    };
    return this._invoke('upsert', args, schema);
  }

  /**
   * Deletes one or more records from your organization’s data
   */

  delete(ids) {
    const schema = _Array$isArray(ids) ? [ApiSchemas.DeleteResult] : ApiSchemas.DeleteResult;
    const args = {
      '@xmlns': 'urn:partner.soap.sforce.com',
      '@xmlns:ns1': 'sobject.partner.soap.sforce.com',
      'ns1:ids': ids
    };
    return this._invoke('delete', args, schema);
  }
}

/*--------------------------------------------*/
/*
 * Register hook in connection instantiation for dynamically adding this API module features
 */
registerModule('soap', conn => new SoapApi(conn));
export default SoapApi;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJyZWdpc3Rlck1vZHVsZSIsIlNPQVAiLCJBcGlTY2hlbWFzIiwidG9Tb2FwUmVjb3JkIiwicmVjb3JkcyIsIl9jb250ZXh0IiwiX21hcEluc3RhbmNlUHJvcGVydHkiLCJfQXJyYXkkaXNBcnJheSIsImNhbGwiLCJyZWNvcmQiLCJfY29udGV4dDIiLCJ0eXBlIiwiYXR0cmlidXRlcyIsInJlYyIsIl9vYmplY3RXaXRob3V0UHJvcGVydGllcyIsInQiLCJFcnJvciIsImZpZWxkc1RvTnVsbCIsIl9maWx0ZXJJbnN0YW5jZVByb3BlcnR5IiwiX09iamVjdCRrZXlzIiwiZmllbGQiLCJsZW5ndGgiLCJfb2JqZWN0U3ByZWFkIiwiU29hcEFwaSIsImNvbnN0cnVjdG9yIiwiY29ubiIsIl9kZWZpbmVQcm9wZXJ0eSIsIl9jb25uIiwiX2ludm9rZSIsIm1ldGhvZCIsIm1lc3NhZ2UiLCJzY2hlbWEiLCJzb2FwRW5kcG9pbnQiLCJ4bWxucyIsImVuZHBvaW50VXJsIiwiaW5zdGFuY2VVcmwiLCJ2ZXJzaW9uIiwicmVzIiwiaW52b2tlIiwicmVzdWx0IiwidW5kZWZpbmVkIiwiY29udmVydExlYWQiLCJsZWFkQ29udmVydHMiLCJMZWFkQ29udmVydFJlc3VsdCIsIm1lcmdlIiwibWVyZ2VSZXF1ZXN0cyIsIk1lcmdlUmVzdWx0IiwiZW1wdHlSZWN5Y2xlQmluIiwiaWRzIiwiRW1wdHlSZWN5Y2xlQmluUmVzdWx0IiwiZGVzY3JpYmVUYWJzIiwiRGVzY3JpYmVUYWJTZXRSZXN1bHQiLCJnZXRTZXJ2ZXJUaW1lc3RhbXAiLCJHZXRTZXJ2ZXJUaW1lc3RhbXBSZXN1bHQiLCJnZXRVc2VySW5mbyIsIkdldFVzZXJJbmZvUmVzdWx0Iiwic2V0UGFzc3dvcmQiLCJ1c2VySWQiLCJwYXNzd29yZCIsInJlc2V0UGFzc3dvcmQiLCJSZXNldFBhc3N3b3JkUmVzdWx0IiwiY3JlYXRlIiwic09iamVjdHMiLCJTYXZlUmVzdWx0IiwiYXJncyIsInVwZGF0ZSIsInVwc2VydCIsImV4dGVybmFsSWRGaWVsZE5hbWUiLCJVcHNlcnRSZXN1bHQiLCJkZWxldGUiLCJEZWxldGVSZXN1bHQiXSwic291cmNlcyI6WyIuLi8uLi9zcmMvYXBpL3NvYXAudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSBTYWxlc2ZvcmNlIFNPQVAgQVBJXG4gKiBAYXV0aG9yIFNoaW5pY2hpIFRvbWl0YSA8c2hpbmljaGkudG9taXRhQGdtYWlsLmNvbT5cbiAqL1xuaW1wb3J0IHsgcmVnaXN0ZXJNb2R1bGUgfSBmcm9tICcuLi9qc2ZvcmNlJztcbmltcG9ydCBDb25uZWN0aW9uIGZyb20gJy4uL2Nvbm5lY3Rpb24nO1xuaW1wb3J0IFNPQVAgZnJvbSAnLi4vc29hcCc7XG5pbXBvcnQgeyBTY2hlbWEsIFJlY29yZCwgU29hcFNjaGVtYURlZiwgU29hcFNjaGVtYSB9IGZyb20gJy4uL3R5cGVzJztcbmltcG9ydCB7XG4gIEFwaVNjaGVtYXMsXG4gIExlYWRDb252ZXJ0LFxuICBMZWFkQ29udmVydFJlc3VsdCxcbiAgTWVyZ2VSZXF1ZXN0LFxuICBNZXJnZVJlc3VsdCxcbiAgRW1wdHlSZWN5Y2xlQmluUmVzdWx0LFxuICBEZXNjcmliZVRhYlNldFJlc3VsdCxcbiAgR2V0U2VydmVyVGltZXN0YW1wUmVzdWx0LFxuICBHZXRVc2VySW5mb1Jlc3VsdCxcbiAgUmVzZXRQYXNzd29yZFJlc3VsdCxcbiAgU2F2ZVJlc3VsdCxcbiAgVXBzZXJ0UmVzdWx0LFxuICBEZWxldGVSZXN1bHQsXG59IGZyb20gJy4vc29hcC9zY2hlbWEnO1xuXG4vKipcbiAqXG4gKi9cbmZ1bmN0aW9uIHRvU29hcFJlY29yZChyZWNvcmRzOiBSZWNvcmQgfCBSZWNvcmRbXSk6IFJlY29yZCB8IFJlY29yZFtdIHtcbiAgcmV0dXJuIChBcnJheS5pc0FycmF5KHJlY29yZHMpID8gcmVjb3JkcyA6IFtyZWNvcmRzXSkubWFwKChyZWNvcmQpID0+IHtcbiAgICBjb25zdCB7IHR5cGUsIGF0dHJpYnV0ZXMsIC4uLnJlYyB9ID0gcmVjb3JkO1xuICAgIGNvbnN0IHQgPSB0eXBlIHx8IGF0dHJpYnV0ZXM/LnR5cGU7XG4gICAgaWYgKCF0KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0dpdmVuIHJlY29yZCBpcyBub3QgaW5jbHVkaW5nIHNPYmplY3QgdHlwZSBpbmZvcm1hdGlvbicpO1xuICAgIH1cbiAgICBjb25zdCBmaWVsZHNUb051bGwgPSBPYmplY3Qua2V5cyhyZWMpLmZpbHRlcihcbiAgICAgIChmaWVsZCkgPT4gcmVjb3JkW2ZpZWxkXSA9PT0gbnVsbCxcbiAgICApO1xuICAgIGZvciAoY29uc3QgZmllbGQgb2YgZmllbGRzVG9OdWxsKSB7XG4gICAgICBkZWxldGUgcmVjW2ZpZWxkXTtcbiAgICB9XG4gICAgcmV0dXJuIGZpZWxkc1RvTnVsbC5sZW5ndGggPiAwXG4gICAgICA/IHsgdHlwZTogdCwgZmllbGRzVG9OdWxsLCAuLi5yZWMgfVxuICAgICAgOiB7IHR5cGU6IHQsIC4uLnJlYyB9O1xuICB9KTtcbn1cblxuLyoqXG4gKiBBUEkgY2xhc3MgZm9yIFBhcnRuZXIgU09BUCBjYWxsXG4gKi9cbmV4cG9ydCBjbGFzcyBTb2FwQXBpPFMgZXh0ZW5kcyBTY2hlbWE+IHtcbiAgX2Nvbm46IENvbm5lY3Rpb248Uz47XG5cbiAgY29uc3RydWN0b3IoY29ubjogQ29ubmVjdGlvbjxTPikge1xuICAgIHRoaXMuX2Nvbm4gPSBjb25uO1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGwgU09BUCBBcGkgKFBhcnRuZXIpIGVuZHBvaW50XG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBhc3luYyBfaW52b2tlKFxuICAgIG1ldGhvZDogc3RyaW5nLFxuICAgIG1lc3NhZ2U6IG9iamVjdCxcbiAgICBzY2hlbWE6IFNvYXBTY2hlbWEgfCBTb2FwU2NoZW1hRGVmLFxuICApIHtcbiAgICBjb25zdCBzb2FwRW5kcG9pbnQgPSBuZXcgU09BUCh0aGlzLl9jb25uLCB7XG4gICAgICB4bWxuczogJ3VybjpwYXJ0bmVyLnNvYXAuc2ZvcmNlLmNvbScsXG4gICAgICBlbmRwb2ludFVybDogYCR7dGhpcy5fY29ubi5pbnN0YW5jZVVybH0vc2VydmljZXMvU29hcC91LyR7dGhpcy5fY29ubi52ZXJzaW9ufWAsXG4gICAgfSk7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgc29hcEVuZHBvaW50Lmludm9rZShcbiAgICAgIG1ldGhvZCxcbiAgICAgIG1lc3NhZ2UsXG4gICAgICBzY2hlbWEgPyAoeyByZXN1bHQ6IHNjaGVtYSB9IGFzIFNvYXBTY2hlbWEpIDogdW5kZWZpbmVkLFxuICAgICAgQXBpU2NoZW1hcyxcbiAgICApO1xuICAgIHJldHVybiByZXMucmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIENvbnZlcnRzIGEgTGVhZCBpbnRvIGFuIEFjY291bnQsIENvbnRhY3QsIG9yIChvcHRpb25hbGx5KSBhbiBPcHBvcnR1bml0eS5cbiAgICovXG4gIGNvbnZlcnRMZWFkKFxuICAgIGxlYWRDb252ZXJ0czogUGFydGlhbDxMZWFkQ29udmVydD5bXSxcbiAgKTogUHJvbWlzZTxMZWFkQ29udmVydFJlc3VsdFtdPjtcbiAgY29udmVydExlYWQobGVhZENvbnZlcnQ6IFBhcnRpYWw8TGVhZENvbnZlcnQ+KTogUHJvbWlzZTxMZWFkQ29udmVydFJlc3VsdD47XG4gIGNvbnZlcnRMZWFkKFxuICAgIGxlYWRDb252ZXJ0OiBQYXJ0aWFsPExlYWRDb252ZXJ0PiB8IFBhcnRpYWw8TGVhZENvbnZlcnQ+W10sXG4gICk6IFByb21pc2U8TGVhZENvbnZlcnRSZXN1bHQgfCBMZWFkQ29udmVydFJlc3VsdFtdPjtcbiAgYXN5bmMgY29udmVydExlYWQoXG4gICAgbGVhZENvbnZlcnRzOiBQYXJ0aWFsPExlYWRDb252ZXJ0PiB8IFBhcnRpYWw8TGVhZENvbnZlcnQ+W10sXG4gICkge1xuICAgIGNvbnN0IHNjaGVtYSA9IEFycmF5LmlzQXJyYXkobGVhZENvbnZlcnRzKVxuICAgICAgPyBbQXBpU2NoZW1hcy5MZWFkQ29udmVydFJlc3VsdF1cbiAgICAgIDogQXBpU2NoZW1hcy5MZWFkQ29udmVydFJlc3VsdDtcbiAgICByZXR1cm4gdGhpcy5faW52b2tlKCdjb252ZXJ0TGVhZCcsIHsgbGVhZENvbnZlcnRzIH0sIHNjaGVtYSk7XG4gIH1cblxuICAvKipcbiAgICogTWVyZ2UgdXAgdG8gdGhyZWUgcmVjb3JkcyBpbnRvIG9uZVxuICAgKi9cbiAgbWVyZ2UobWVyZ2VSZXF1ZXN0czogUGFydGlhbDxNZXJnZVJlcXVlc3Q+W10pOiBQcm9taXNlPE1lcmdlUmVzdWx0W10+O1xuICBtZXJnZShtZXJnZVJlcXVlc3Q6IFBhcnRpYWw8TWVyZ2VSZXF1ZXN0Pik6IFByb21pc2U8TWVyZ2VSZXN1bHQ+O1xuICBtZXJnZShcbiAgICBtZXJnZVJlcXVlc3Q6IFBhcnRpYWw8TWVyZ2VSZXF1ZXN0PiB8IFBhcnRpYWw8TWVyZ2VSZXF1ZXN0PltdLFxuICApOiBQcm9taXNlPE1lcmdlUmVzdWx0IHwgTWVyZ2VSZXN1bHRbXT47XG4gIGFzeW5jIG1lcmdlKG1lcmdlUmVxdWVzdHM6IFBhcnRpYWw8TWVyZ2VSZXF1ZXN0PiB8IFBhcnRpYWw8TWVyZ2VSZXF1ZXN0PltdKSB7XG4gICAgY29uc3Qgc2NoZW1hID0gQXJyYXkuaXNBcnJheShtZXJnZVJlcXVlc3RzKVxuICAgICAgPyBbQXBpU2NoZW1hcy5NZXJnZVJlc3VsdF1cbiAgICAgIDogQXBpU2NoZW1hcy5NZXJnZVJlc3VsdDtcbiAgICByZXR1cm4gdGhpcy5faW52b2tlKCdtZXJnZScsIHsgbWVyZ2VSZXF1ZXN0cyB9LCBzY2hlbWEpO1xuICB9XG5cbiAgLyoqXG4gICAqIERlbGV0ZSByZWNvcmRzIGZyb20gdGhlIHJlY3ljbGUgYmluIGltbWVkaWF0ZWx5XG4gICAqL1xuICBhc3luYyBlbXB0eVJlY3ljbGVCaW4oaWRzOiBzdHJpbmdbXSk6IFByb21pc2U8RW1wdHlSZWN5Y2xlQmluUmVzdWx0PiB7XG4gICAgcmV0dXJuIHRoaXMuX2ludm9rZSgnZW1wdHlSZWN5Y2xlQmluJywgeyBpZHMgfSwgW1xuICAgICAgQXBpU2NoZW1hcy5FbXB0eVJlY3ljbGVCaW5SZXN1bHQsXG4gICAgXSk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBpbmZvcm1hdGlvbiBhYm91dCB0aGUgc3RhbmRhcmQgYW5kIGN1c3RvbSBhcHBzIGF2YWlsYWJsZSB0byB0aGUgbG9nZ2VkLWluIHVzZXJcbiAgICovXG4gIGFzeW5jIGRlc2NyaWJlVGFicygpOiBQcm9taXNlPERlc2NyaWJlVGFiU2V0UmVzdWx0W10+IHtcbiAgICByZXR1cm4gdGhpcy5faW52b2tlKCdkZXNjcmliZVRhYnMnLCB7fSwgW0FwaVNjaGVtYXMuRGVzY3JpYmVUYWJTZXRSZXN1bHRdKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgdGhlIGN1cnJlbnQgc3lzdGVtIHRpbWVzdGFtcCAoQ29vcmRpbmF0ZWQgVW5pdmVyc2FsIFRpbWUgKFVUQykgdGltZSB6b25lKSBmcm9tIHRoZSBBUElcbiAgICovXG4gIGFzeW5jIGdldFNlcnZlclRpbWVzdGFtcCgpOiBQcm9taXNlPEdldFNlcnZlclRpbWVzdGFtcFJlc3VsdD4ge1xuICAgIHJldHVybiB0aGlzLl9pbnZva2UoXG4gICAgICAnZ2V0U2VydmVyVGltZXN0YW1wJyxcbiAgICAgIHt9LFxuICAgICAgQXBpU2NoZW1hcy5HZXRTZXJ2ZXJUaW1lc3RhbXBSZXN1bHQsXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgcGVyc29uYWwgaW5mb3JtYXRpb24gZm9yIHRoZSB1c2VyIGFzc29jaWF0ZWQgd2l0aCB0aGUgY3VycmVudCBzZXNzaW9uXG4gICAqL1xuICBhc3luYyBnZXRVc2VySW5mbygpOiBQcm9taXNlPEdldFVzZXJJbmZvUmVzdWx0PiB7XG4gICAgcmV0dXJuIHRoaXMuX2ludm9rZSgnZ2V0VXNlckluZm8nLCB7fSwgQXBpU2NoZW1hcy5HZXRVc2VySW5mb1Jlc3VsdCk7XG4gIH1cblxuICAvKipcbiAgICogU2V0cyB0aGUgc3BlY2lmaWVkIHVzZXLigJlzIHBhc3N3b3JkIHRvIHRoZSBzcGVjaWZpZWQgdmFsdWVcbiAgICovXG4gIHNldFBhc3N3b3JkKHVzZXJJZDogc3RyaW5nLCBwYXNzd29yZDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICByZXR1cm4gdGhpcy5faW52b2tlKCdzZXRQYXNzd29yZCcsIHsgdXNlcklkLCBwYXNzd29yZCB9LCAnc3RyaW5nJyk7XG4gIH1cblxuICAvKipcbiAgICogUmVzZXRzIHRoZSBzcGVjaWZpZWQgdXNlcuKAmXMgcGFzc3dvcmRcbiAgICovXG4gIHJlc2V0UGFzc3dvcmQodXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPFJlc2V0UGFzc3dvcmRSZXN1bHQ+IHtcbiAgICByZXR1cm4gdGhpcy5faW52b2tlKFxuICAgICAgJ3Jlc2V0UGFzc3dvcmQnLFxuICAgICAgeyB1c2VySWQgfSxcbiAgICAgIEFwaVNjaGVtYXMuUmVzZXRQYXNzd29yZFJlc3VsdCxcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZHMgb25lIG9yIG1vcmUgbmV3IHJlY29yZHMgdG8geW91ciBvcmdhbml6YXRpb27igJlzIGRhdGFcbiAgICovXG4gIGNyZWF0ZShzT2JqZWN0OiBSZWNvcmRbXSk6IFByb21pc2U8U2F2ZVJlc3VsdFtdPjtcbiAgY3JlYXRlKHNPYmplY3Q6IFJlY29yZCk6IFByb21pc2U8U2F2ZVJlc3VsdD47XG4gIGNyZWF0ZShzT2JqZWN0czogUmVjb3JkIHwgUmVjb3JkW10pOiBQcm9taXNlPFNhdmVSZXN1bHQgfCBTYXZlUmVzdWx0W10+O1xuICBjcmVhdGUoc09iamVjdHM6IFJlY29yZCB8IFJlY29yZFtdKSB7XG4gICAgY29uc3Qgc2NoZW1hID0gQXJyYXkuaXNBcnJheShzT2JqZWN0cylcbiAgICAgID8gW0FwaVNjaGVtYXMuU2F2ZVJlc3VsdF1cbiAgICAgIDogQXBpU2NoZW1hcy5TYXZlUmVzdWx0O1xuICAgIGNvbnN0IGFyZ3MgPSB7XG4gICAgICAnQHhtbG5zJzogJ3VybjpwYXJ0bmVyLnNvYXAuc2ZvcmNlLmNvbScsXG4gICAgICAnQHhtbG5zOm5zMSc6ICdzb2JqZWN0LnBhcnRuZXIuc29hcC5zZm9yY2UuY29tJyxcbiAgICAgICduczE6c09iamVjdHMnOiB0b1NvYXBSZWNvcmQoc09iamVjdHMpLFxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMuX2ludm9rZSgnY3JlYXRlJywgYXJncywgc2NoZW1hKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGVzIG9uZSBvciBtb3JlIGV4aXN0aW5nIHJlY29yZHMgaW4geW91ciBvcmdhbml6YXRpb27igJlzIGRhdGEuXG4gICAqL1xuICB1cGRhdGUoc09iamVjdDogUmVjb3JkW10pOiBQcm9taXNlPFNhdmVSZXN1bHRbXT47XG4gIHVwZGF0ZShzT2JqZWN0OiBSZWNvcmQpOiBQcm9taXNlPFNhdmVSZXN1bHQ+O1xuICB1cGRhdGUoc09iamVjdHM6IFJlY29yZCB8IFJlY29yZFtdKTogUHJvbWlzZTxTYXZlUmVzdWx0IHwgU2F2ZVJlc3VsdFtdPjtcbiAgdXBkYXRlKHNPYmplY3RzOiBSZWNvcmQgfCBSZWNvcmRbXSkge1xuICAgIGNvbnN0IHNjaGVtYSA9IEFycmF5LmlzQXJyYXkoc09iamVjdHMpXG4gICAgICA/IFtBcGlTY2hlbWFzLlNhdmVSZXN1bHRdXG4gICAgICA6IEFwaVNjaGVtYXMuU2F2ZVJlc3VsdDtcbiAgICBjb25zdCBhcmdzID0ge1xuICAgICAgJ0B4bWxucyc6ICd1cm46cGFydG5lci5zb2FwLnNmb3JjZS5jb20nLFxuICAgICAgJ0B4bWxuczpuczEnOiAnc29iamVjdC5wYXJ0bmVyLnNvYXAuc2ZvcmNlLmNvbScsXG4gICAgICAnbnMxOnNPYmplY3RzJzogdG9Tb2FwUmVjb3JkKHNPYmplY3RzKSxcbiAgICB9O1xuICAgIHJldHVybiB0aGlzLl9pbnZva2UoJ3VwZGF0ZScsIGFyZ3MsIHNjaGVtYSk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBuZXcgcmVjb3JkcyBhbmQgdXBkYXRlcyBleGlzdGluZyByZWNvcmRzIGluIHlvdXIgb3JnYW5pemF0aW9u4oCZcyBkYXRhLlxuICAgKi9cbiAgdXBzZXJ0KFxuICAgIGV4dGVybmFsSWRGaWVsZE5hbWU6IHN0cmluZyxcbiAgICBzT2JqZWN0czogUmVjb3JkW10sXG4gICk6IFByb21pc2U8VXBzZXJ0UmVzdWx0W10+O1xuICB1cHNlcnQoZXh0ZXJuYWxJZEZpZWxkTmFtZTogc3RyaW5nLCBzT2JqZWN0OiBSZWNvcmQpOiBQcm9taXNlPFVwc2VydFJlc3VsdD47XG4gIHVwc2VydChcbiAgICBleHRlcm5hbElkRmllbGROYW1lOiBzdHJpbmcsXG4gICAgc09iamVjdHM6IFJlY29yZCB8IFJlY29yZFtdLFxuICApOiBQcm9taXNlPFVwc2VydFJlc3VsdCB8IFVwc2VydFJlc3VsdFtdPjtcbiAgdXBzZXJ0KGV4dGVybmFsSWRGaWVsZE5hbWU6IHN0cmluZywgc09iamVjdHM6IFJlY29yZCB8IFJlY29yZFtdKSB7XG4gICAgY29uc3Qgc2NoZW1hID0gQXJyYXkuaXNBcnJheShzT2JqZWN0cylcbiAgICAgID8gW0FwaVNjaGVtYXMuVXBzZXJ0UmVzdWx0XVxuICAgICAgOiBBcGlTY2hlbWFzLlVwc2VydFJlc3VsdDtcbiAgICBjb25zdCBhcmdzID0ge1xuICAgICAgJ0B4bWxucyc6ICd1cm46cGFydG5lci5zb2FwLnNmb3JjZS5jb20nLFxuICAgICAgJ0B4bWxuczpuczEnOiAnc29iamVjdC5wYXJ0bmVyLnNvYXAuc2ZvcmNlLmNvbScsXG4gICAgICAnbnMxOmV4dGVybmFsSURGaWVsZE5hbWUnOiBleHRlcm5hbElkRmllbGROYW1lLFxuICAgICAgJ25zMTpzT2JqZWN0cyc6IHRvU29hcFJlY29yZChzT2JqZWN0cyksXG4gICAgfTtcbiAgICByZXR1cm4gdGhpcy5faW52b2tlKCd1cHNlcnQnLCBhcmdzLCBzY2hlbWEpO1xuICB9XG5cbiAgLyoqXG4gICAqIERlbGV0ZXMgb25lIG9yIG1vcmUgcmVjb3JkcyBmcm9tIHlvdXIgb3JnYW5pemF0aW9u4oCZcyBkYXRhXG4gICAqL1xuICBkZWxldGUoaWRzOiBzdHJpbmcgfCBzdHJpbmdbXSk6IFByb21pc2U8RGVsZXRlUmVzdWx0W10+O1xuICBkZWxldGUoaWQ6IHN0cmluZyk6IFByb21pc2U8RGVsZXRlUmVzdWx0PjtcbiAgZGVsZXRlKGlkczogc3RyaW5nIHwgc3RyaW5nW10pOiBQcm9taXNlPERlbGV0ZVJlc3VsdCB8IERlbGV0ZVJlc3VsdFtdPjtcbiAgZGVsZXRlKGlkczogc3RyaW5nIHwgc3RyaW5nW10pIHtcbiAgICBjb25zdCBzY2hlbWEgPSBBcnJheS5pc0FycmF5KGlkcylcbiAgICAgID8gW0FwaVNjaGVtYXMuRGVsZXRlUmVzdWx0XVxuICAgICAgOiBBcGlTY2hlbWFzLkRlbGV0ZVJlc3VsdDtcbiAgICBjb25zdCBhcmdzID0ge1xuICAgICAgJ0B4bWxucyc6ICd1cm46cGFydG5lci5zb2FwLnNmb3JjZS5jb20nLFxuICAgICAgJ0B4bWxuczpuczEnOiAnc29iamVjdC5wYXJ0bmVyLnNvYXAuc2ZvcmNlLmNvbScsXG4gICAgICAnbnMxOmlkcyc6IGlkcyxcbiAgICB9O1xuICAgIHJldHVybiB0aGlzLl9pbnZva2UoJ2RlbGV0ZScsIGFyZ3MsIHNjaGVtYSk7XG4gIH1cbn1cblxuLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG4vKlxuICogUmVnaXN0ZXIgaG9vayBpbiBjb25uZWN0aW9uIGluc3RhbnRpYXRpb24gZm9yIGR5bmFtaWNhbGx5IGFkZGluZyB0aGlzIEFQSSBtb2R1bGUgZmVhdHVyZXNcbiAqL1xucmVnaXN0ZXJNb2R1bGUoJ3NvYXAnLCAoY29ubikgPT4gbmV3IFNvYXBBcGkoY29ubikpO1xuXG5leHBvcnQgZGVmYXVsdCBTb2FwQXBpO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTQSxjQUFjLFFBQVEsWUFBWTtBQUUzQyxPQUFPQyxJQUFJLE1BQU0sU0FBUztBQUUxQixTQUNFQyxVQUFVLFFBYUwsZUFBZTs7QUFFdEI7QUFDQTtBQUNBO0FBQ0EsU0FBU0MsWUFBWUEs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