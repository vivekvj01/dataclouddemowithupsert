import _Reflect$construct from "@babel/runtime-corejs3/core-js-stable/reflect/construct";
import _Object$defineProperty from "@babel/runtime-corejs3/core-js-stable/object/define-property";
import _Object$defineProperties from "@babel/runtime-corejs3/core-js-stable/object/define-properties";
import _Object$getOwnPropertyDescriptors from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptors";
import _forEachInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/for-each";
import _Object$getOwnPropertyDescriptor from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptor";
import _filterInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/filter";
import _Object$getOwnPropertySymbols from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-symbols";
import "core-js/modules/es.array.join";
import "core-js/modules/es.number.constructor";
import "core-js/modules/es.regexp.exec";
import "core-js/modules/es.string.replace";
import _regeneratorRuntime from "@babel/runtime-corejs3/regenerator";
import "regenerator-runtime/runtime";
import _asyncToGenerator from "@babel/runtime-corejs3/helpers/asyncToGenerator";
import _classCallCheck from "@babel/runtime-corejs3/helpers/classCallCheck";
import _createClass from "@babel/runtime-corejs3/helpers/createClass";
import _assertThisInitialized from "@babel/runtime-corejs3/helpers/assertThisInitialized";
import _get from "@babel/runtime-corejs3/helpers/get";
import _inherits from "@babel/runtime-corejs3/helpers/inherits";
import _possibleConstructorReturn from "@babel/runtime-corejs3/helpers/possibleConstructorReturn";
import _getPrototypeOf from "@babel/runtime-corejs3/helpers/getPrototypeOf";
import _Object$keys from "@babel/runtime-corejs3/core-js-stable/object/keys";
import _reduceInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/reduce";
import _mapInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/map";
import _Array$isArray from "@babel/runtime-corejs3/core-js-stable/array/is-array";
import _defineProperty from "@babel/runtime-corejs3/helpers/defineProperty";
function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = _Reflect$construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }
function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !_Reflect$construct) return false; if (_Reflect$construct.sham) return false; if (typeof Proxy === "function") return true; try { Date.prototype.toString.call(_Reflect$construct(Date, [], function () {})); return true; } catch (e) { return false; } }
function ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = _filterInstanceProperty(symbols).call(symbols, function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }
function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { var _context5; _forEachInstanceProperty(_context5 = ownKeys(Object(source), true)).call(_context5, function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { var _context6; _forEachInstanceProperty(_context6 = ownKeys(Object(source))).call(_context6, function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }
/**
 * @file Manages method call to SOAP endpoint
 * @author Shinichi Tomita <shinichi.tomita@gmail.com>
 */
import HttpApi from './http-api';
import { isMapObject, isObject } from './util/function';

/**
 *
 */
function getPropsSchema(schema, schemaDict) {
  if (schema.extends && schemaDict[schema.extends]) {
    var extendSchema = schemaDict[schema.extends];
    return _objectSpread(_objectSpread({}, getPropsSchema(extendSchema, schemaDict)), schema.props);
  }
  return schema.props;
}
function isNillValue(value) {
  return value == null || isMapObject(value) && isMapObject(value.$) && value.$['xsi:nil'] === 'true';
}

/**
 *
 */
export function castTypeUsingSchema(value, schema) {
  var schemaDict = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
  if (_Array$isArray(schema)) {
    var _context;
    var nillable = schema.length === 2 && schema[0] === '?';
    var schema_ = nillable ? schema[1] : schema[0];
    if (value == null) {
      return nillable ? null : [];
    }
    return _mapInstanceProperty(_context = _Array$isArray(value) ? value : [value]).call(_context, function (v) {
      return castTypeUsingSchema(v, schema_, schemaDict);
    });
  } else if (isMapObject(schema)) {
    var _context2;
    // if schema is Schema Definition, not schema element
    if ('type' in schema && 'props' in schema && isMapObject(schema.props)) {
      var props = getPropsSchema(schema, schemaDict);
      return castTypeUsingSchema(value, props, schemaDict);
    }
    var _nillable = ('?' in schema);
    var _schema_ = '?' in schema ? schema['?'] : schema;
    if (_nillable && isNillValue(value)) {
      return null;
    }
    var obj = isMapObject(value) ? value : {};
    return _reduceInstanceProperty(_context2 = _Object$keys(_schema_)).call(_context2, function (o, k) {
      var s = _schema_[k];
      var v = obj[k];
      var nillable = _Array$isArray(s) && s.length === 2 && s[0] === '?' || isMapObject(s) && '?' in s || typeof s === 'string' && s[0] === '?';
      if (typeof v === 'undefined' && nillable) {
        return o;
      }
      return _objectSpread(_objectSpread({}, o), {}, _defineProperty({}, k, castTypeUsingSchema(v, s, schemaDict)));
    }, obj);
  } else {
    var _nillable2 = typeof schema === 'string' && schema[0] === '?';
    var type = typeof schema === 'string' ? _nillable2 ? schema.substring(1) : schema : 'any';
    switch (type) {
      case 'string':
        return isNillValue(value) ? _nillable2 ? null : '' : String(value);
      case 'number':
        return isNillValue(value) ? _nillable2 ? null : 0 : Number(value);
      case 'boolean':
        return isNillValue(value) ? _nillable2 ? null : false : value === 'true';
      case 'null':
        return null;
      default:
        {
          if (schemaDict[type]) {
            var cvalue = castTypeUsingSchema(value, schemaDict[type], schemaDict);
            var isEmpty = isMapObject(cvalue) && _Object$keys(cvalue).length === 0;
            return isEmpty && _nillable2 ? null : cvalue;
          }
          return value;
        }
    }
  }
}

/**
 * @private
 */
function lookupValue(obj, propRegExps) {
  var regexp = propRegExps.shift();
  if (!regexp) {
    return obj;
  }
  if (isMapObject(obj)) {
    for (var _i = 0, _Object$keys2 = _Object$keys(obj); _i < _Object$keys2.length; _i++) {
      var prop = _Object$keys2[_i];
      if (regexp.test(prop)) {
        return lookupValue(obj[prop], propRegExps);
      }
    }
    return null;
  }
}

/**
 * @private
 */
function toXML(name, value) {
  if (isObject(name)) {
    value = name;
    name = null;
  }
  if (_Array$isArray(value)) {
    return _mapInstanceProperty(value).call(value, function (v) {
      return toXML(name, v);
    }).join('');
  } else {
    var attrs = [];
    var elems = [];
    if (isMapObject(value)) {
      for (var _i2 = 0, _Object$keys3 = _Object$keys(value); _i2 < _Object$keys3.length; _i2++) {
        var k = _Object$keys3[_i2];
        var v = value[k];
        if (k[0] === '@') {
          var kk = k.substring(1);
          attrs.push(kk + '="' + v + '"');
        } else {
          elems.push(toXML(k, v));
        }
      }
      value = elems.join('');
    } else {
      value = String(value).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&apos;');
    }
    var startTag = name ? '<' + name + (attrs.length > 0 ? ' ' + attrs.join(' ') : '') + '>' : '';
    var endTag = name ? '</' + name + '>' : '';
    return startTag + value + endTag;
  }
}

/**
 *
 */

/**
 * Class for SOAP endpoint of Salesforce
 *
 * @protected
 * @class
 * @constructor
 * @param {Connection} conn - Connection instance
 * @param {Object} options - SOAP endpoint setting options
 * @param {String} options.endpointUrl - SOAP endpoint URL
 * @param {String} [options.xmlns] - XML namespace for method call (default is "urn:partner.soap.sforce.com")
 */
export var SOAP = /*#__PURE__*/function (_HttpApi) {
  _inherits(SOAP, _HttpApi);
  var _super = _createSuper(SOAP);
  function SOAP(conn, options) {
    var _this;
    _classCallCheck(this, SOAP);
    _this = _super.call(this, conn, options);
    _defineProperty(_assertThisInitialized(_this), "_endpointUrl", void 0);
    _defineProperty(_assertThisInitialized(_this), "_xmlns", void 0);
    _this._endpointUrl = options.endpointUrl;
    _this._xmlns = options.xmlns || 'urn:partner.soap.sforce.com';
    return _this;
  }

  /**
   * Invoke SOAP call using method and arguments
   */
  _createClass(SOAP, [{
    key: "invoke",
    value: function () {
      var _invoke = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(method, args, schema, schemaDict) {
        var res;
        return _regeneratorRuntime.wrap(function _callee$(_context3) {
          while (1) {
            switch (_context3.prev = _context3.next) {
              case 0:
                _context3.next = 2;
                return this.request({
                  method: 'POST',
                  url: this._endpointUrl,
                  headers: {
                    'Content-Type': 'text/xml',
                    SOAPAction: '""'
                  },
                  _message: _defineProperty({}, method, args)
                });
              case 2:
                res = _context3.sent;
                return _context3.abrupt("return", schema ? castTypeUsingSchema(res, schema, schemaDict) : res);
              case 4:
              case "end":
                return _context3.stop();
            }
          }
        }, _callee, this);
      }));
      function invoke(_x, _x2, _x3, _x4) {
        return _invoke.apply(this, arguments);
      }
      return invoke;
    }() /** @override */
  }, {
    key: "beforeSend",
    value: function beforeSend(request) {
      request.body = this._createEnvelope(request._message);
    } /** @override **/
  }, {
    key: "isSessionExpired",
    value: function isSessionExpired(response) {
      return response.statusCode === 500 && /<faultcode>[a-zA-Z]+:INVALID_SESSION_ID<\/faultcode>/.test(response.body);
    } /** @override **/
  }, {
    key: "parseError",
    value: function parseError(body) {
      var error = lookupValue(body, [/:Envelope$/, /:Body$/, /:Fault$/]);
      return {
        errorCode: error.faultcode,
        message: error.faultstring
      };
    } /** @override **/
  }, {
    key: "getResponseBody",
    value: function () {
      var _getResponseBody = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(response) {
        var body;
        return _regeneratorRuntime.wrap(function _callee2$(_context4) {
          while (1) {
            switch (_context4.prev = _context4.next) {
              case 0:
                _context4.next = 2;
                return _get(_getPrototypeOf(SOAP.prototype), "getResponseBody", this).call(this, response);
              case 2:
                body = _context4.sent;
                return _context4.abrupt("return", lookupValue(body, [/:Envelope$/, /:Body$/, /.+/]));
              case 4:
              case "end":
                return _context4.stop();
            }
          }
        }, _callee2, this);
      }));
      function getResponseBody(_x5) {
        return _getResponseBody.apply(this, arguments);
      }
      return getResponseBody;
    }()
    /**
     * @private
     */
  }, {
    key: "_createEnvelope",
    value: function _createEnvelope(message) {
      var header = {};
      var conn = this._conn;
      if (conn.accessToken) {
        header.SessionHeader = {
          sessionId: conn.accessToken
        };
      }
      if (conn._callOptions) {
        header.CallOptions = conn._callOptions;
      }
      return ['<?xml version="1.0" encoding="UTF-8"?>', '<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"', ' xmlns:xsd="http://www.w3.org/2001/XMLSchema"', ' xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">', '<soapenv:Header xmlns="' + this._xmlns + '">', toXML(header), '</soapenv:Header>', '<soapenv:Body xmlns="' + this._xmlns + '">', toXML(message), '</soapenv:Body>', '</soapenv:Envelope>'].join('');
    }
  }]);
  return SOAP;
}(HttpApi);
export default SOAP;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJIdHRwQXBpIiwiaXNNYXBPYmplY3QiLCJpc09iamVjdCIsImdldFByb3BzU2NoZW1hIiwic2NoZW1hIiwic2NoZW1hRGljdCIsImV4dGVuZHMiLCJleHRlbmRTY2hlbWEiLCJfb2JqZWN0U3ByZWFkIiwicHJvcHMiLCJpc05pbGxWYWx1ZSIsInZhbHVlIiwiJCIsImNhc3RUeXBlVXNpbmdTY2hlbWEiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJfQXJyYXkkaXNBcnJheSIsIl9jb250ZXh0IiwibmlsbGFibGUiLCJzY2hlbWFfIiwiX21hcEluc3RhbmNlUHJvcGVydHkiLCJjYWxsIiwidiIsIl9jb250ZXh0MiIsIm9iaiIsIl9yZWR1Y2VJbnN0YW5jZVByb3BlcnR5IiwiX09iamVjdCRrZXlzIiwibyIsImsiLCJzIiwiX2RlZmluZVByb3BlcnR5IiwidHlwZSIsInN1YnN0cmluZyIsIlN0cmluZyIsIk51bWJlciIsImN2YWx1ZSIsImlzRW1wdHkiLCJsb29rdXBWYWx1ZSIsInByb3BSZWdFeHBzIiwicmVnZXhwIiwic2hpZnQiLCJfaSIsIl9PYmplY3Qka2V5czIiLCJwcm9wIiwidGVzdCIsInRvWE1MIiwibmFtZSIsImpvaW4iLCJhdHRycyIsImVsZW1zIiwiX2kyIiwiX09iamVjdCRrZXlzMyIsImtrIiwicHVzaCIsInJlcGxhY2UiLCJzdGFydFRhZyIsImVuZFRhZyIsIlNPQVAiLCJfSHR0cEFwaSIsIl9pbmhlcml0cyIsIl9zdXBlciIsIl9jcmVhdGVTdXBlciIsImNvbm4iLCJvcHRpb25zIiwiX3RoaXMiLCJfY2xhc3NDYWxsQ2hlY2siLCJfYXNzZXJ0VGhpc0luaXRpYWxpemVkIiwiX2VuZHBvaW50VXJsIiwiZW5kcG9pbnRVcmwiLCJfeG1sbnMiLCJ4bWxucyIsIl9jcmVhdGVDbGFzcyIsImtleSIsIl9pbnZva2UiLCJfYXN5bmNUb0dlbmVyYXRvciIsIl9yZWdlbmVyYXRvclJ1bnRpbWUiLCJtYXJrIiwiX2NhbGxlZSIsIm1ldGhvZCIsImFyZ3MiLCJyZXMiLCJ3cmFwIiwiX2NhbGxlZSQiLCJfY29udGV4dDMiLCJwcmV2IiwibmV4dCIsInJlcXVlc3QiLCJ1cmwiLCJoZWFkZXJzIiwiU09BUEFjdGlvbiIsIl9tZXNzYWdlIiwic2VudCIsImFicnVwdCIsInN0b3AiLCJpbnZva2UiLCJfeCIsIl94MiIsIl94MyIsIl94NCIsImFwcGx5IiwiYmVmb3JlU2VuZCIsImJvZHkiLCJfY3JlYXRlRW52ZWxvcGUiLCJpc1Nlc3Npb25FeHBpcmVkIiwicmVzcG9uc2UiLCJzdGF0dXNDb2RlIiwicGFyc2VFcnJvciIsImVycm9yIiwiZXJyb3JDb2RlIiwiZmF1bHRjb2RlIiwibWVzc2FnZSIsImZhdWx0c3RyaW5nIiwiX2dldFJlc3BvbnNlQm9keSIsIl9jYWxsZWUyIiwiX2NhbGxlZTIkIiwiX2NvbnRleHQ0IiwiX2dldCIsIl9nZXRQcm90b3R5cGVPZiIsInByb3RvdHlwZSIsImdldFJlc3BvbnNlQm9keSIsIl94NSIsImhlYWRlciIsIl9jb25uIiwiYWNjZXNzVG9rZW4iLCJTZXNzaW9uSGVhZGVyIiwic2Vzc2lvbklkIiwiX2NhbGxPcHRpb25zIiwiQ2FsbE9wdGlvbnMiXSwic291cmNlcyI6WyIuLi9zcmMvc29hcC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIE1hbmFnZXMgbWV0aG9kIGNhbGwgdG8gU09BUCBlbmRwb2ludFxuICogQGF1dGhvciBTaGluaWNoaSBUb21pdGEgPHNoaW5pY2hpLnRvbWl0YUBnbWFpbC5jb20+XG4gKi9cbmltcG9ydCBIdHRwQXBpIGZyb20gJy4vaHR0cC1hcGknO1xuaW1wb3J0IENvbm5lY3Rpb24gZnJvbSAnLi9jb25uZWN0aW9uJztcbmltcG9ydCB7XG4gIFNjaGVtYSxcbiAgSHR0cFJlc3BvbnNlLFxuICBIdHRwUmVxdWVzdCxcbiAgU29hcFNjaGVtYSxcbiAgU29hcFNjaGVtYURlZixcbn0gZnJvbSAnLi90eXBlcyc7XG5pbXBvcnQgeyBpc01hcE9iamVjdCwgaXNPYmplY3QgfSBmcm9tICcuL3V0aWwvZnVuY3Rpb24nO1xuXG4vKipcbiAqXG4gKi9cbmZ1bmN0aW9uIGdldFByb3BzU2NoZW1hKFxuICBzY2hlbWE6IFNvYXBTY2hlbWFEZWYsXG4gIHNjaGVtYURpY3Q6IHsgW25hbWU6IHN0cmluZ106IFNvYXBTY2hlbWFEZWYgfSxcbik6IFNvYXBTY2hlbWFEZWZbJ3Byb3BzJ10ge1xuICBpZiAoc2NoZW1hLmV4dGVuZHMgJiYgc2NoZW1hRGljdFtzY2hlbWEuZXh0ZW5kc10pIHtcbiAgICBjb25zdCBleHRlbmRTY2hlbWEgPSBzY2hlbWFEaWN0W3NjaGVtYS5leHRlbmRzXTtcbiAgICByZXR1cm4ge1xuICAgICAgLi4uZ2V0UHJvcHNTY2hlbWEoZXh0ZW5kU2NoZW1hLCBzY2hlbWFEaWN0KSxcbiAgICAgIC4uLnNjaGVtYS5wcm9wcyxcbiAgICB9O1xuICB9XG4gIHJldHVybiBzY2hlbWEucHJvcHM7XG59XG5cbmZ1bmN0aW9uIGlzTmlsbFZhbHVlKHZhbHVlOiB1bmtub3duKSB7XG4gIHJldHVybiAoXG4gICAgdmFsdWUgPT0gbnVsbCB8fFxuICAgIChpc01hcE9iamVjdCh2YWx1ZSkgJiZcbiAgICAgIGlzTWFwT2JqZWN0KHZhbHVlLiQpICYmXG4gICAgICB2YWx1ZS4kWyd4c2k6bmlsJ10gPT09ICd0cnVlJylcbiAgKTtcbn1cblxuLyoqXG4gKlxuICovXG5leHBvcnQgZnVuY3Rpb24gY2FzdFR5cGVVc2luZ1NjaGVtYShcbiAgdmFsdWU6IHVua25vd24sXG4gIHNjaGVtYT86IFNvYXBTY2hlbWEgfCBTb2FwU2NoZW1hRGVmLFxuICBzY2hlbWFEaWN0OiB7IFtuYW1lOiBzdHJpbmddOiBTb2FwU2NoZW1hRGVmIH0gPSB7fSxcbik6IGFueSB7XG4gIGlmIChBcnJheS5pc0FycmF5KHNjaGVtYSkpIHtcbiAgICBjb25zdCBuaWxsYWJsZSA9IHNjaGVtYS5sZW5ndGggPT09IDIgJiYgc2NoZW1hWzBdID09PSAnPyc7XG4gICAgY29uc3Qgc2NoZW1hXyA9IG5pbGxhYmxlID8gc2NoZW1hWzFdIDogc2NoZW1hWzBdO1xuICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7XG4gICAgICByZXR1cm4gbmlsbGFibGUgPyBudWxsIDogW107XG4gICAgfVxuICAgIHJldHVybiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkgPyB2YWx1ZSA6IFt2YWx1ZV0pLm1hcCgodikgPT5cbiAgICAgIGNhc3RUeXBlVXNpbmdTY2hlbWEodiwgc2NoZW1hXywgc2NoZW1hRGljdCksXG4gICAgKTtcbiAgfSBlbHNlIGlmIChpc01hcE9iamVjdChzY2hlbWEpKSB7XG4gICAgLy8gaWYgc2NoZW1hIGlzIFNjaGVtYSBEZWZpbml0aW9uLCBub3Qgc2NoZW1hIGVsZW1lbnRcbiAgICBpZiAoJ3R5cGUnIGluIHNjaGVtYSAmJiAncHJvcHMnIGluIHNjaGVtYSAmJiBpc01hcE9iamVjdChzY2hlbWEucHJvcHMpKSB7XG4gICAgICBjb25zdCBwcm9wcyA9IGdldFByb3BzU2NoZW1hKHNjaGVtYSBhcyBTb2FwU2NoZW1hRGVmLCBzY2hlbWFEaWN0KTtcbiAgICAgIHJldHVybiBjYXN0VHlwZVVzaW5nU2NoZW1hKHZhbHVlLCBwcm9wcywgc2NoZW1hRGljdCk7XG4gICAgfVxuICAgIGNvbnN0IG5pbGxhYmxlID0gJz8nIGluIHNjaGVtYTtcbiAgICBjb25zdCBzY2hlbWFfID1cbiAgICAgICc/JyBpbiBzY2hlbWEgPyAoc2NoZW1hWyc/J10gYXMgeyBba2V5OiBzdHJpbmddOiBhbnkgfSkgOiBzY2hlbWE7XG4gICAgaWYgKG5pbGxhYmxlICYmIGlzTmlsbFZhbHVlKHZhbHVlKSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IG9iaiA9IGlzTWFwT2JqZWN0KHZhbHVlKSA/IHZhbHVlIDoge307XG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKHNjaGVtYV8pLnJlZHVjZSgobywgaykgPT4ge1xuICAgICAgY29uc3QgcyA9IHNjaGVtYV9ba107XG4gICAgICBjb25zdCB2ID0gb2JqW2tdO1xuICAgICAgY29uc3QgbmlsbGFibGUgPVxuICAgICAgICAoQXJyYXkuaXNBcnJheShzKSAmJiBzLmxlbmd0aCA9PT0gMiAmJiBzWzBdID09PSAnPycpIHx8XG4gICAgICAgIChpc01hcE9iamVjdChzKSAmJiAnPycgaW4gcykgfHxcbiAgICAgICAgKHR5cGVvZiBzID09PSAnc3RyaW5nJyAmJiBzWzBdID09PSAnPycpO1xuICAgICAgaWYgKHR5cGVvZiB2ID09PSAndW5kZWZpbmVkJyAmJiBuaWxsYWJsZSkge1xuICAgICAgICByZXR1cm4gbztcbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLm8sXG4gICAgICAgIFtrXTogY2FzdFR5cGVVc2luZ1NjaGVtYSh2LCBzLCBzY2hlbWFEaWN0KSxcbiAgICAgIH07XG4gICAgfSwgb2JqKTtcbiAgfSBlbHNlIHtcbiAgICBjb25zdCBuaWxsYWJsZSA9IHR5cGVvZiBzY2hlbWEgPT09ICdzdHJpbmcnICYmIHNjaGVtYVswXSA9PT0gJz8nO1xuICAgIGNvbnN0IHR5cGUgPVxuICAgICAgdHlwZW9mIHNjaGVtYSA9PT0gJ3N0cmluZydcbiAgICAgICAgPyBuaWxsYWJsZVxuICAgICAgICAgID8gc2NoZW1hLnN1YnN0cmluZygxKVxuICAgICAgICAgIDogc2NoZW1hXG4gICAgICAgIDogJ2FueSc7XG4gICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICByZXR1cm4gaXNOaWxsVmFsdWUodmFsdWUpID8gKG5pbGxhYmxlID8gbnVsbCA6ICcnKSA6IFN0cmluZyh2YWx1ZSk7XG4gICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICByZXR1cm4gaXNOaWxsVmFsdWUodmFsdWUpID8gKG5pbGxhYmxlID8gbnVsbCA6IDApIDogTnVtYmVyKHZhbHVlKTtcbiAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICByZXR1cm4gaXNOaWxsVmFsdWUodmFsdWUpXG4gICAgICAgICAgPyBuaWxsYWJsZVxuICAgICAgICAgICAgPyBudWxsXG4gICAgICAgICAgICA6IGZhbHNlXG4gICAgICAgICAgOiB2YWx1ZSA9PT0gJ3RydWUnO1xuICAgICAgY2FzZSAnbnVsbCc6XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgZGVmYXVsdDoge1xuICAgICAgICBpZiAoc2NoZW1hRGljdFt0eXBlXSkge1xuICAgICAgICAgIGNvbnN0IGN2YWx1ZSA9IGNhc3RUeXBlVXNpbmdTY2hlbWEoXG4gICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAgIHNjaGVtYURpY3RbdHlwZV0sXG4gICAgICAgICAgICBzY2hlbWFEaWN0LFxuICAgICAgICAgICk7XG4gICAgICAgICAgY29uc3QgaXNFbXB0eSA9XG4gICAgICAgICAgICBpc01hcE9iamVjdChjdmFsdWUpICYmIE9iamVjdC5rZXlzKGN2YWx1ZSkubGVuZ3RoID09PSAwO1xuICAgICAgICAgIHJldHVybiBpc0VtcHR5ICYmIG5pbGxhYmxlID8gbnVsbCA6IGN2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdmFsdWUgYXMgYW55O1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqIEBwcml2YXRlXG4gKi9cbmZ1bmN0aW9uIGxvb2t1cFZhbHVlKG9iajogdW5rbm93biwgcHJvcFJlZ0V4cHM6IFJlZ0V4cFtdKTogdW5rbm93biB7XG4gIGNvbnN0IHJlZ2V4cCA9IHByb3BSZWdFeHBzLnNoaWZ0KCk7XG4gIGlmICghcmVnZXhwKSB7XG4gICAgcmV0dXJuIG9iajtcbiAgfVxuICBpZiAoaXNNYXBPYmplY3Qob2JqKSkge1xuICAgIGZvciAoY29uc3QgcHJvcCBvZiBPYmplY3Qua2V5cyhvYmopKSB7XG4gICAgICBpZiAocmVnZXhwLnRlc3QocHJvcCkpIHtcbiAgICAgICAgcmV0dXJuIGxvb2t1cFZhbHVlKG9ialtwcm9wXSwgcHJvcFJlZ0V4cHMpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG4vKipcbiAqIEBwcml2YXRlXG4gKi9cbmZ1bmN0aW9uIHRvWE1MKG5hbWU6IG9iamVjdCB8IHN0cmluZyB8IG51bGwsIHZhbHVlPzogYW55KTogc3RyaW5nIHtcbiAgaWYgKGlzT2JqZWN0KG5hbWUpKSB7XG4gICAgdmFsdWUgPSBuYW1lO1xuICAgIG5hbWUgPSBudWxsO1xuICB9XG4gIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgIHJldHVybiB2YWx1ZS5tYXAoKHYpID0+IHRvWE1MKG5hbWUsIHYpKS5qb2luKCcnKTtcbiAgfSBlbHNlIHtcbiAgICBjb25zdCBhdHRycyA9IFtdO1xuICAgIGNvbnN0IGVsZW1zID0gW107XG4gICAgaWYgKGlzTWFwT2JqZWN0KHZhbHVlKSkge1xuICAgICAgZm9yIChjb25zdCBrIG9mIE9iamVjdC5rZXlzKHZhbHVlKSkge1xuICAgICAgICBjb25zdCB2ID0gdmFsdWVba107XG4gICAgICAgIGlmIChrWzBdID09PSAnQCcpIHtcbiAgICAgICAgICBjb25zdCBrayA9IGsuc3Vic3RyaW5nKDEpO1xuICAgICAgICAgIGF0dHJzLnB1c2goa2sgKyAnPVwiJyArIHYgKyAnXCInKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBlbGVtcy5wdXNoKHRvWE1MKGssIHYpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdmFsdWUgPSBlbGVtcy5qb2luKCcnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFsdWUgPSBTdHJpbmcodmFsdWUpXG4gICAgICAgIC5yZXBsYWNlKC8mL2csICcmYW1wOycpXG4gICAgICAgIC5yZXBsYWNlKC88L2csICcmbHQ7JylcbiAgICAgICAgLnJlcGxhY2UoLz4vZywgJyZndDsnKVxuICAgICAgICAucmVwbGFjZSgvXCIvZywgJyZxdW90OycpXG4gICAgICAgIC5yZXBsYWNlKC8nL2csICcmYXBvczsnKTtcbiAgICB9XG4gICAgY29uc3Qgc3RhcnRUYWcgPSBuYW1lXG4gICAgICA/ICc8JyArIG5hbWUgKyAoYXR0cnMubGVuZ3RoID4gMCA/ICcgJyArIGF0dHJzLmpvaW4oJyAnKSA6ICcnKSArICc+J1xuICAgICAgOiAnJztcbiAgICBjb25zdCBlbmRUYWcgPSBuYW1lID8gJzwvJyArIG5hbWUgKyAnPicgOiAnJztcbiAgICByZXR1cm4gc3RhcnRUYWcgKyB2YWx1ZSArIGVuZFRhZztcbiAgfVxufVxuXG4vKipcbiAqXG4gKi9cbmV4cG9ydCB0eXBlIFNPQVBPcHRpb25zID0ge1xuICBlbmRwb2ludFVybDogc3RyaW5nO1xuICB4bWxucz86IHN0cmluZztcbn07XG5cbi8qKlxuICogQ2xhc3MgZm9yIFNPQVAgZW5kcG9pbnQgb2YgU2FsZXNmb3JjZVxuICpcbiAqIEBwcm90ZWN0ZWRcbiAqIEBjbGFzc1xuICogQGNvbnN0cnVjdG9yXG4gKiBAcGFyYW0ge0Nvbm5lY3Rpb259IGNvbm4gLSBDb25uZWN0aW9uIGluc3RhbmNlXG4gKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAtIFNPQVAgZW5kcG9pbnQgc2V0dGluZyBvcHRpb25zXG4gKiBAcGFyYW0ge1N0cmluZ30gb3B0aW9ucy5lbmRwb2ludFVybCAtIFNPQVAgZW5kcG9pbnQgVVJMXG4gKiBAcGFyYW0ge1N0cmluZ30gW29wdGlvbnMueG1sbnNdIC0gWE1MIG5hbWVzcGFjZSBmb3IgbWV0aG9kIGNhbGwgKGRlZmF1bHQgaXMgXCJ1cm46cGFydG5lci5zb2FwLnNmb3JjZS5jb21cIilcbiAqL1xuZXhwb3J0IGNsYXNzIFNPQVA8UyBleHRlbmRzIFNjaGVtYT4gZXh0ZW5kcyBIdHRwQXBpPFM+IHtcbiAgX2VuZHBvaW50VXJsOiBzdHJpbmc7XG4gIF94bWxuczogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKGNvbm46IENvbm5lY3Rpb248Uz4sIG9wdGlvbnM6IFNPQVBPcHRpb25zKSB7XG4gICAgc3VwZXIoY29ubiwgb3B0aW9ucyk7XG4gICAgdGhpcy5fZW5kcG9pbnRVcmwgPSBvcHRpb25zLmVuZHBvaW50VXJsO1xuICAgIHRoaXMuX3htbG5zID0gb3B0aW9ucy54bWxucyB8fCAndXJuOnBhcnRuZXIuc29hcC5zZm9yY2UuY29tJztcbiAgfVxuXG4gIC8qKlxuICAgKiBJbnZva2UgU09BUCBjYWxsIHVzaW5nIG1ldGhvZCBhbmQgYXJndW1lbnRzXG4gICAqL1xuICBhc3luYyBpbnZva2UoXG4gICAgbWV0aG9kOiBzdHJpbmcsXG4gICAgYXJnczogb2JqZWN0LFxuICAgIHNjaGVtYT86IFNvYXBTY2hlbWEgfCBTb2FwU2NoZW1hRGVmLFxuICAgIHNjaGVtYURpY3Q/OiB7IFtuYW1lOiBzdHJpbmddOiBTb2FwU2NoZW1hRGVmIH0sXG4gICkge1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMucmVxdWVzdCh7XG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIHVybDogdGhpcy5fZW5kcG9pbnRVcmwsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdDb250ZW50LVR5cGUnOiAndGV4dC94bWwnLFxuICAgICAgICBTT0FQQWN0aW9uOiAnXCJcIicsXG4gICAgICB9LFxuICAgICAgX21lc3NhZ2U6IHsgW21ldGhvZF06IGFyZ3MgfSxcbiAgICB9IGFzIEh0dHBSZXF1ZXN0KTtcbiAgICByZXR1cm4gc2NoZW1hID8gY2FzdFR5cGVVc2luZ1NjaGVtYShyZXMsIHNjaGVtYSwgc2NoZW1hRGljdCkgOiByZXM7XG4gIH1cblxuICAvKiogQG92ZXJyaWRlICovXG4gIGJlZm9yZVNlbmQocmVxdWVzdDogSHR0cFJlcXVlc3QgJiB7IF9tZXNzYWdlOiBvYmplY3QgfSkge1xuICAgIHJlcXVlc3QuYm9keSA9IHRoaXMuX2NyZWF0ZUVudmVsb3BlKHJlcXVlc3QuX21lc3NhZ2UpO1xuICB9XG5cbiAgLyoqIEBvdmVycmlkZSAqKi9cbiAgaXNTZXNzaW9uRXhwaXJlZChyZXNwb25zZTogSHR0cFJlc3BvbnNlKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIHJlc3BvbnNlLnN0YXR1c0NvZGUgPT09IDUwMCAmJlxuICAgICAgLzxmYXVsdGNvZGU+W2EtekEtWl0rOklOVkFMSURfU0VTU0lPTl9JRDxcXC9mYXVsdGNvZGU+Ly50ZXN0KHJlc3BvbnNlLmJvZHkpXG4gICAgKTtcbiAgfVxuXG4gIC8qKiBAb3ZlcnJpZGUgKiovXG4gIHBhcnNlRXJyb3IoYm9keTogc3RyaW5nKSB7XG4gICAgY29uc3QgZXJyb3IgPSBsb29rdXBWYWx1ZShib2R5LCBbLzpFbnZlbG9wZSQvLCAvOkJvZHkkLywgLzpGYXVsdCQvXSkgYXMge1xuICAgICAgW25hbWU6IHN0cmluZ106IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgICB9O1xuICAgIHJldHVybiB7XG4gICAgICBlcnJvckNvZGU6IGVycm9yLmZhdWx0Y29kZSxcbiAgICAgIG1lc3NhZ2U6IGVycm9yLmZhdWx0c3RyaW5nLFxuICAgIH07XG4gIH1cblxuICAvKiogQG92ZXJyaWRlICoqL1xuICBhc3luYyBnZXRSZXNwb25zZUJvZHkocmVzcG9uc2U6IEh0dHBSZXNwb25zZSkge1xuICAgIGNvbnN0IGJvZHkgPSBhd2FpdCBzdXBlci5nZXRSZXNwb25zZUJvZHkocmVzcG9uc2UpO1xuICAgIHJldHVybiBsb29rdXBWYWx1ZShib2R5LCBbLzpFbnZlbG9wZSQvLCAvOkJvZHkkLywgLy4rL10pO1xuICB9XG5cbiAgLyoqXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBfY3JlYXRlRW52ZWxvcGUobWVzc2FnZTogb2JqZWN0KSB7XG4gICAgY29uc3QgaGVhZGVyOiB7IFtuYW1lOiBzdHJpbmddOiBhbnkgfSA9IHt9O1xuICAgIGNvbnN0IGNvbm4gPSB0aGlzLl9jb25uO1xuICAgIGlmIChjb25uLmFjY2Vzc1Rva2VuKSB7XG4gICAgICBoZWFkZXIuU2Vzc2lvbkhlYWRlciA9IHsgc2Vzc2lvbklkOiBjb25uLmFjY2Vzc1Rva2VuIH07XG4gICAgfVxuICAgIGlmIChjb25uLl9jYWxsT3B0aW9ucykge1xuICAgICAgaGVhZGVyLkNhbGxPcHRpb25zID0gY29ubi5fY2FsbE9wdGlvbnM7XG4gICAgfVxuICAgIHJldHVybiBbXG4gICAgICAnPD94bWwgdmVyc2lvbj1cIjEuMFwiIGVuY29kaW5nPVwiVVRGLThcIj8+JyxcbiAgICAgICc8c29hcGVudjpFbnZlbG9wZSB4bWxuczpzb2FwZW52PVwiaHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvc29hcC9lbnZlbG9wZS9cIicsXG4gICAgICAnIHhtbG5zOnhzZD1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hXCInLFxuICAgICAgJyB4bWxuczp4c2k9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZVwiPicsXG4gICAgICAnPHNvYXBlbnY6SGVhZGVyIHhtbG5zPVwiJyArIHRoaXMuX3htbG5zICsgJ1wiPicsXG4gICAgICB0b1hNTChoZWFkZXIpLFxuICAgICAgJzwvc29hcGVudjpIZWFkZXI+JyxcbiAgICAgICc8c29hcGVudjpCb2R5IHhtbG5zPVwiJyArIHRoaXMuX3htbG5zICsgJ1wiPicsXG4gICAgICB0b1hNTChtZXNzYWdlKSxcbiAgICAgICc8L3NvYXBlbnY6Qm9keT4nLFxuICAgICAgJzwvc29hcGVudjpFbnZlbG9wZT4nLFxuICAgIF0uam9pbignJyk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgU09BUDtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBT0EsT0FBTyxNQUFNLFlBQVk7QUFTaEMsU0FBU0MsV0FBVyxFQUFFQyxRQUFRLFFBQVEsaUJBQWlCOztBQUV2RDtBQUNBO0FBQ0E7QUFDQSxTQUFTQyxjQUFjQSxDQUNyQkMsTUFBcUIsRUFDckJDLFVBQTZDLEVBQ3JCO0VBQ3hCLElBQUlELE1BQU0sQ0FBQ0UsT0FBTyxJQUFJRCxVQUFVLENBQUNELE1BQU0sQ0FBQ0UsT0FBTyxDQUFDLEVBQUU7SUFDaEQsSUFBTUMsWUFBWSxHQUFHRixVQUFVLENBQUNELE1BQU0sQ0FBQ0UsT0FBTyxDQUFDO0lBQy9DLE9BQUFFLGFBQUEsQ0FBQUEsYUFBQSxLQUNLTCxjQUFjLENBQUNJLFlBQVksRUFBRUYsVUFBVSxD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