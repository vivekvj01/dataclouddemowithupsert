import _Object$defineProperty from "@babel/runtime-corejs3/core-js-stable/object/define-property";
import _Object$defineProperties from "@babel/runtime-corejs3/core-js-stable/object/define-properties";
import _Object$getOwnPropertyDescriptors from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptors";
import _forEachInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/for-each";
import _Object$getOwnPropertyDescriptor from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptor";
import _filterInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/filter";
import _Object$getOwnPropertySymbols from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-symbols";
import _objectWithoutProperties from "@babel/runtime-corejs3/helpers/objectWithoutProperties";
import _regeneratorRuntime from "@babel/runtime-corejs3/regenerator";
import _Object$keys from "@babel/runtime-corejs3/core-js-stable/object/keys";
import "regenerator-runtime/runtime";
import _asyncToGenerator from "@babel/runtime-corejs3/helpers/asyncToGenerator";
import _classCallCheck from "@babel/runtime-corejs3/helpers/classCallCheck";
import _createClass from "@babel/runtime-corejs3/helpers/createClass";
import _defineProperty from "@babel/runtime-corejs3/helpers/defineProperty";
function ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = _filterInstanceProperty(symbols).call(symbols, function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }
function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { var _context10; _forEachInstanceProperty(_context10 = ownKeys(Object(source), true)).call(_context10, function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { var _context11; _forEachInstanceProperty(_context11 = ownKeys(Object(source))).call(_context11, function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }
import Connection from '../connection';
/**
 *
 */
export var BaseRegistry = /*#__PURE__*/function () {
  function BaseRegistry() {
    _classCallCheck(this, BaseRegistry);
    _defineProperty(this, "_registryConfig", {});
  }
  _createClass(BaseRegistry, [{
    key: "_saveConfig",
    value: function _saveConfig() {
      throw new Error('_saveConfig must be implemented in subclass');
    }
  }, {
    key: "_getClients",
    value: function _getClients() {
      return this._registryConfig.clients || (this._registryConfig.clients = {});
    }
  }, {
    key: "_getConnections",
    value: function _getConnections() {
      return this._registryConfig.connections || (this._registryConfig.connections = {});
    }
  }, {
    key: "getConnectionNames",
    value: function () {
      var _getConnectionNames = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {
        return _regeneratorRuntime.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                return _context.abrupt("return", _Object$keys(this._getConnections()));
              case 1:
              case "end":
                return _context.stop();
            }
          }
        }, _callee, this);
      }));
      function getConnectionNames() {
        return _getConnectionNames.apply(this, arguments);
      }
      return getConnectionNames;
    }()
  }, {
    key: "getConnection",
    value: function () {
      var _getConnection = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(name) {
        var config;
        return _regeneratorRuntime.wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                _context2.next = 2;
                return this.getConnectionConfig(name);
              case 2:
                config = _context2.sent;
                return _context2.abrupt("return", config ? new Connection(config) : null);
              case 4:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2, this);
      }));
      function getConnection(_x) {
        return _getConnection.apply(this, arguments);
      }
      return getConnection;
    }()
  }, {
    key: "getConnectionConfig",
    value: function () {
      var _getConnectionConfig = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(name) {
        var connections, connConfig, client, connConfig_;
        return _regeneratorRuntime.wrap(function _callee3$(_context3) {
          while (1) {
            switch (_context3.prev = _context3.next) {
              case 0:
                if (!name) {
                  name = this._registryConfig['default'];
                }
                connections = this._getConnections();
                connConfig = name ? connections[name] : undefined;
                if (connConfig) {
                  _context3.next = 5;
                  break;
                }
                return _context3.abrupt("return", null);
              case 5:
                client = connConfig.client, connConfig_ = _objectWithoutProperties(connConfig, ["client"]);
                if (!client) {
                  _context3.next = 18;
                  break;
                }
                _context3.t0 = _objectSpread;
                _context3.t1 = _objectSpread({}, connConfig_);
                _context3.t2 = {};
                _context3.t3 = _objectSpread;
                _context3.t4 = {};
                _context3.next = 14;
                return this.getClientConfig(client);
              case 14:
                _context3.t5 = _context3.sent;
                _context3.t6 = (0, _context3.t3)(_context3.t4, _context3.t5);
                _context3.t7 = {
                  oauth2: _context3.t6
                };
                return _context3.abrupt("return", (0, _context3.t0)(_context3.t1, _context3.t2, _context3.t7));
              case 18:
                return _context3.abrupt("return", connConfig_);
              case 19:
              case "end":
                return _context3.stop();
            }
          }
        }, _callee3, this);
      }));
      function getConnectionConfig(_x2) {
        return _getConnectionConfig.apply(this, arguments);
      }
      return getConnectionConfig;
    }()
  }, {
    key: "saveConnectionConfig",
    value: function () {
      var _saveConnectionConfig = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(name, connConfig) {
        var connections, oauth2, connConfig_, persistConnConfig, clientName;
        return _regeneratorRuntime.wrap(function _callee4$(_context4) {
          while (1) {
            switch (_context4.prev = _context4.next) {
              case 0:
                connections = this._getConnections();
                oauth2 = connConfig.oauth2, connConfig_ = _objectWithoutProperties(connConfig, ["oauth2"]);
                persistConnConfig = connConfig_;
                if (oauth2) {
                  clientName = this._findClientName(oauth2);
                  if (clientName) {
                    persistConnConfig = _objectSpread(_objectSpread({}, persistConnConfig), {}, {
                      client: clientName
                    });
                  }
                  delete connConfig.oauth2;
                }
                connections[name] = persistConnConfig;
                this._saveConfig();
              case 6:
              case "end":
                return _context4.stop();
            }
          }
        }, _callee4, this);
      }));
      function saveConnectionConfig(_x3, _x4) {
        return _saveConnectionConfig.apply(this, arguments);
      }
      return saveConnectionConfig;
    }()
  }, {
    key: "_findClientName",
    value: function _findClientName(_ref) {
      var clientId = _ref.clientId,
        loginUrl = _ref.loginUrl;
      var clients = this._getClients();
      for (var _i = 0, _Object$keys2 = _Object$keys(clients); _i < _Object$keys2.length; _i++) {
        var name = _Object$keys2[_i];
        var client = clients[name];
        if (client.clientId === clientId && (client.loginUrl || 'https://login.salesforce.com') === loginUrl) {
          return name;
        }
      }
      return null;
    }
  }, {
    key: "setDefaultConnection",
    value: function () {
      var _setDefaultConnection = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(name) {
        return _regeneratorRuntime.wrap(function _callee5$(_context5) {
          while (1) {
            switch (_context5.prev = _context5.next) {
              case 0:
                this._registryConfig['default'] = name;
                this._saveConfig();
              case 2:
              case "end":
                return _context5.stop();
            }
          }
        }, _callee5, this);
      }));
      function setDefaultConnection(_x5) {
        return _setDefaultConnection.apply(this, arguments);
      }
      return setDefaultConnection;
    }()
  }, {
    key: "removeConnectionConfig",
    value: function () {
      var _removeConnectionConfig = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(name) {
        var connections;
        return _regeneratorRuntime.wrap(function _callee6$(_context6) {
          while (1) {
            switch (_context6.prev = _context6.next) {
              case 0:
                connections = this._getConnections();
                delete connections[name];
                this._saveConfig();
              case 3:
              case "end":
                return _context6.stop();
            }
          }
        }, _callee6, this);
      }));
      function removeConnectionConfig(_x6) {
        return _removeConnectionConfig.apply(this, arguments);
      }
      return removeConnectionConfig;
    }()
  }, {
    key: "getClientConfig",
    value: function () {
      var _getClientConfig = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7(name) {
        var clients, clientConfig;
        return _regeneratorRuntime.wrap(function _callee7$(_context7) {
          while (1) {
            switch (_context7.prev = _context7.next) {
              case 0:
                clients = this._getClients();
                clientConfig = clients[name];
                return _context7.abrupt("return", clientConfig && _objectSpread({}, clientConfig));
              case 3:
              case "end":
                return _context7.stop();
            }
          }
        }, _callee7, this);
      }));
      function getClientConfig(_x7) {
        return _getClientConfig.apply(this, arguments);
      }
      return getClientConfig;
    }()
  }, {
    key: "getClientNames",
    value: function () {
      var _getClientNames = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee8() {
        return _regeneratorRuntime.wrap(function _callee8$(_context8) {
          while (1) {
            switch (_context8.prev = _context8.next) {
              case 0:
                return _context8.abrupt("return", _Object$keys(this._getClients()));
              case 1:
              case "end":
                return _context8.stop();
            }
          }
        }, _callee8, this);
      }));
      function getClientNames() {
        return _getClientNames.apply(this, arguments);
      }
      return getClientNames;
    }()
  }, {
    key: "registerClientConfig",
    value: function () {
      var _registerClientConfig = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee9(name, clientConfig) {
        var clients;
        return _regeneratorRuntime.wrap(function _callee9$(_context9) {
          while (1) {
            switch (_context9.prev = _context9.next) {
              case 0:
                clients = this._getClients();
                clients[name] = clientConfig;
                this._saveConfig();
              case 3:
              case "end":
                return _context9.stop();
            }
          }
        }, _callee9, this);
      }));
      function registerClientConfig(_x8, _x9) {
        return _registerClientConfig.apply(this, arguments);
      }
      return registerClientConfig;
    }()
  }]);
  return BaseRegistry;
}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJDb25uZWN0aW9uIiwiQmFzZVJlZ2lzdHJ5IiwiX2NsYXNzQ2FsbENoZWNrIiwiX2RlZmluZVByb3BlcnR5IiwiX2NyZWF0ZUNsYXNzIiwia2V5IiwidmFsdWUiLCJfc2F2ZUNvbmZpZyIsIkVycm9yIiwiX2dldENsaWVudHMiLCJfcmVnaXN0cnlDb25maWciLCJjbGllbnRzIiwiX2dldENvbm5lY3Rpb25zIiwiY29ubmVjdGlvbnMiLCJfZ2V0Q29ubmVjdGlvbk5hbWVzIiwiX2FzeW5jVG9HZW5lcmF0b3IiLCJfcmVnZW5lcmF0b3JSdW50aW1lIiwibWFyayIsIl9jYWxsZWUiLCJ3cmFwIiwiX2NhbGxlZSQiLCJfY29udGV4dCIsInByZXYiLCJuZXh0IiwiYWJydXB0IiwiX09iamVjdCRrZXlzIiwic3RvcCIsImdldENvbm5lY3Rpb25OYW1lcyIsImFwcGx5IiwiYXJndW1lbnRzIiwiX2dldENvbm5lY3Rpb24iLCJfY2FsbGVlMiIsIm5hbWUiLCJjb25maWciLCJfY2FsbGVlMiQiLCJfY29udGV4dDIiLCJnZXRDb25uZWN0aW9uQ29uZmlnIiwic2VudCIsImdldENvbm5lY3Rpb24iLCJfeCIsIl9nZXRDb25uZWN0aW9uQ29uZmlnIiwiX2NhbGxlZTMiLCJjb25uQ29uZmlnIiwiY2xpZW50IiwiY29ubkNvbmZpZ18iLCJfY2FsbGVlMyQiLCJfY29udGV4dDMiLCJ1bmRlZmluZWQiLCJfb2JqZWN0V2l0aG91dFByb3BlcnRpZXMiLCJ0MCIsIl9vYmplY3RTcHJlYWQiLCJ0MSIsInQyIiwidDMiLCJ0NCIsImdldENsaWVudENvbmZpZyIsInQ1IiwidDYiLCJ0NyIsIm9hdXRoMiIsIl94MiIsIl9zYXZlQ29ubmVjdGlvbkNvbmZpZyIsIl9jYWxsZWU0IiwicGVyc2lzdENvbm5Db25maWciLCJjbGllbnROYW1lIiwiX2NhbGxlZTQkIiwiX2NvbnRleHQ0IiwiX2ZpbmRDbGllbnROYW1lIiwic2F2ZUNvbm5lY3Rpb25Db25maWciLCJfeDMiLCJfeDQiLCJfcmVmIiwiY2xpZW50SWQiLCJsb2dpblVybCIsIl9pIiwiX09iamVjdCRrZXlzMiIsImxlbmd0aCIsIl9zZXREZWZhdWx0Q29ubmVjdGlvbiIsIl9jYWxsZWU1IiwiX2NhbGxlZTUkIiwiX2NvbnRleHQ1Iiwic2V0RGVmYXVsdENvbm5lY3Rpb24iLCJfeDUiLCJfcmVtb3ZlQ29ubmVjdGlvbkNvbmZpZyIsIl9jYWxsZWU2IiwiX2NhbGxlZTYkIiwiX2NvbnRleHQ2IiwicmVtb3ZlQ29ubmVjdGlvbkNvbmZpZyIsIl94NiIsIl9nZXRDbGllbnRDb25maWciLCJfY2FsbGVlNyIsImNsaWVudENvbmZpZyIsIl9jYWxsZWU3JCIsIl9jb250ZXh0NyIsIl94NyIsIl9nZXRDbGllbnROYW1lcyIsIl9jYWxsZWU4IiwiX2NhbGxlZTgkIiwiX2NvbnRleHQ4IiwiZ2V0Q2xpZW50TmFtZXMiLCJfcmVnaXN0ZXJDbGllbnRDb25maWciLCJfY2FsbGVlOSIsIl9jYWxsZWU5JCIsIl9jb250ZXh0OSIsInJlZ2lzdGVyQ2xpZW50Q29uZmlnIiwiX3g4IiwiX3g5Il0sInNvdXJjZXMiOlsiLi4vLi4vc3JjL3JlZ2lzdHJ5L2Jhc2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IENvbm5lY3Rpb24gZnJvbSAnLi4vY29ubmVjdGlvbic7XG5pbXBvcnQge1xuICBSZWdpc3RyeUNvbmZpZyxcbiAgUmVnaXN0cnksXG4gIENvbm5lY3Rpb25Db25maWcsXG4gIFBlcnNpc3RDb25uZWN0aW9uQ29uZmlnLFxuICBDbGllbnRDb25maWcsXG59IGZyb20gJy4vdHlwZXMnO1xuaW1wb3J0IHsgU2NoZW1hIH0gZnJvbSAnLi4vdHlwZXMnO1xuXG4vKipcbiAqXG4gKi9cbmV4cG9ydCBjbGFzcyBCYXNlUmVnaXN0cnkgaW1wbGVtZW50cyBSZWdpc3RyeSB7XG4gIF9yZWdpc3RyeUNvbmZpZzogUmVnaXN0cnlDb25maWcgPSB7fTtcblxuICBfc2F2ZUNvbmZpZygpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ19zYXZlQ29uZmlnIG11c3QgYmUgaW1wbGVtZW50ZWQgaW4gc3ViY2xhc3MnKTtcbiAgfVxuXG4gIF9nZXRDbGllbnRzKCkge1xuICAgIHJldHVybiB0aGlzLl9yZWdpc3RyeUNvbmZpZy5jbGllbnRzIHx8ICh0aGlzLl9yZWdpc3RyeUNvbmZpZy5jbGllbnRzID0ge30pO1xuICB9XG5cbiAgX2dldENvbm5lY3Rpb25zKCkge1xuICAgIHJldHVybiAoXG4gICAgICB0aGlzLl9yZWdpc3RyeUNvbmZpZy5jb25uZWN0aW9ucyB8fFxuICAgICAgKHRoaXMuX3JlZ2lzdHJ5Q29uZmlnLmNvbm5lY3Rpb25zID0ge30pXG4gICAgKTtcbiAgfVxuXG4gIGFzeW5jIGdldENvbm5lY3Rpb25OYW1lcygpIHtcbiAgICByZXR1cm4gT2JqZWN0LmtleXModGhpcy5fZ2V0Q29ubmVjdGlvbnMoKSk7XG4gIH1cblxuICBhc3luYyBnZXRDb25uZWN0aW9uPFMgZXh0ZW5kcyBTY2hlbWEgPSBTY2hlbWE+KG5hbWU6IHN0cmluZykge1xuICAgIGNvbnN0IGNvbmZpZyA9IGF3YWl0IHRoaXMuZ2V0Q29ubmVjdGlvbkNvbmZpZyhuYW1lKTtcbiAgICByZXR1cm4gY29uZmlnID8gbmV3IENvbm5lY3Rpb248Uz4oY29uZmlnKSA6IG51bGw7XG4gIH1cblxuICBhc3luYyBnZXRDb25uZWN0aW9uQ29uZmlnKG5hbWU/OiBzdHJpbmcpIHtcbiAgICBpZiAoIW5hbWUpIHtcbiAgICAgIG5hbWUgPSB0aGlzLl9yZWdpc3RyeUNvbmZpZ1snZGVmYXVsdCddO1xuICAgIH1cbiAgICBjb25zdCBjb25uZWN0aW9ucyA9IHRoaXMuX2dldENvbm5lY3Rpb25zKCk7XG4gICAgY29uc3QgY29ubkNvbmZpZyA9IG5hbWUgPyBjb25uZWN0aW9uc1tuYW1lXSA6IHVuZGVmaW5lZDtcbiAgICBpZiAoIWNvbm5Db25maWcpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCB7IGNsaWVudCwgLi4uY29ubkNvbmZpZ18gfSA9IGNvbm5Db25maWc7XG4gICAgaWYgKGNsaWVudCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4uY29ubkNvbmZpZ18sXG4gICAgICAgIG9hdXRoMjogeyAuLi4oYXdhaXQgdGhpcy5nZXRDbGllbnRDb25maWcoY2xpZW50KSkgfSxcbiAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBjb25uQ29uZmlnXztcbiAgfVxuXG4gIGFzeW5jIHNhdmVDb25uZWN0aW9uQ29uZmlnKG5hbWU6IHN0cmluZywgY29ubkNvbmZpZzogQ29ubmVjdGlvbkNvbmZpZykge1xuICAgIGNvbnN0IGNvbm5lY3Rpb25zID0gdGhpcy5fZ2V0Q29ubmVjdGlvbnMoKTtcbiAgICBjb25zdCB7IG9hdXRoMiwgLi4uY29ubkNvbmZpZ18gfSA9IGNvbm5Db25maWc7XG4gICAgbGV0IHBlcnNpc3RDb25uQ29uZmlnOiBQZXJzaXN0Q29ubmVjdGlvbkNvbmZpZyA9IGNvbm5Db25maWdfO1xuICAgIGlmIChvYXV0aDIpIHtcbiAgICAgIGNvbnN0IGNsaWVudE5hbWUgPSB0aGlzLl9maW5kQ2xpZW50TmFtZShvYXV0aDIpO1xuICAgICAgaWYgKGNsaWVudE5hbWUpIHtcbiAgICAgICAgcGVyc2lzdENvbm5Db25maWcgPSB7IC4uLnBlcnNpc3RDb25uQ29uZmlnLCBjbGllbnQ6IGNsaWVudE5hbWUgfTtcbiAgICAgIH1cbiAgICAgIGRlbGV0ZSBjb25uQ29uZmlnLm9hdXRoMjtcbiAgICB9XG4gICAgY29ubmVjdGlvbnNbbmFtZV0gPSBwZXJzaXN0Q29ubkNvbmZpZztcbiAgICB0aGlzLl9zYXZlQ29uZmlnKCk7XG4gIH1cblxuICBfZmluZENsaWVudE5hbWUoeyBjbGllbnRJZCwgbG9naW5VcmwgfTogQ2xpZW50Q29uZmlnKSB7XG4gICAgY29uc3QgY2xpZW50cyA9IHRoaXMuX2dldENsaWVudHMoKTtcbiAgICBmb3IgKGNvbnN0IG5hbWUgb2YgT2JqZWN0LmtleXMoY2xpZW50cykpIHtcbiAgICAgIGNvbnN0IGNsaWVudCA9IGNsaWVudHNbbmFtZV07XG4gICAgICBpZiAoXG4gICAgICAgIGNsaWVudC5jbGllbnRJZCA9PT0gY2xpZW50SWQgJiZcbiAgICAgICAgKGNsaWVudC5sb2dpblVybCB8fCAnaHR0cHM6Ly9sb2dpbi5zYWxlc2ZvcmNlLmNvbScpID09PSBsb2dpblVybFxuICAgICAgKSB7XG4gICAgICAgIHJldHVybiBuYW1lO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGFzeW5jIHNldERlZmF1bHRDb25uZWN0aW9uKG5hbWU6IHN0cmluZykge1xuICAgIHRoaXMuX3JlZ2lzdHJ5Q29uZmlnWydkZWZhdWx0J10gPSBuYW1lO1xuICAgIHRoaXMuX3NhdmVDb25maWcoKTtcbiAgfVxuXG4gIGFzeW5jIHJlbW92ZUNvbm5lY3Rpb25Db25maWcobmFtZTogc3RyaW5nKSB7XG4gICAgY29uc3QgY29ubmVjdGlvbnMgPSB0aGlzLl9nZXRDb25uZWN0aW9ucygpO1xuICAgIGRlbGV0ZSBjb25uZWN0aW9uc1tuYW1lXTtcbiAgICB0aGlzLl9zYXZlQ29uZmlnKCk7XG4gIH1cblxuICBhc3luYyBnZXRDbGllbnRDb25maWcobmFtZTogc3RyaW5nKSB7XG4gICAgY29uc3QgY2xpZW50cyA9IHRoaXMuX2dldENsaWVudHMoKTtcbiAgICBjb25zdCBjbGllbnRDb25maWcgPSBjbGllbnRzW25hbWVdO1xuICAgIHJldHVybiBjbGllbnRDb25maWcgJiYgeyAuLi5jbGllbnRDb25maWcgfTtcbiAgfVxuXG4gIGFzeW5jIGdldENsaWVudE5hbWVzKCkge1xuICAgIHJldHVybiBPYmplY3Qua2V5cyh0aGlzLl9nZXRDbGllbnRzKCkpO1xuICB9XG5cbiAgYXN5bmMgcmVnaXN0ZXJDbGllbnRDb25maWcobmFtZTogc3RyaW5nLCBjbGllbnRDb25maWc6IENsaWVudENvbmZpZykge1xuICAgIGNvbnN0IGNsaWVudHMgPSB0aGlzLl9nZXRDbGllbnRzKCk7XG4gICAgY2xpZW50c1tuYW1lXSA9IGNsaWVudENvbmZpZztcbiAgICB0aGlzLl9zYXZl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