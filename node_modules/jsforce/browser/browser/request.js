import _getIterator from "@babel/runtime-corejs3/core-js/get-iterator";
import _Array$isArray from "@babel/runtime-corejs3/core-js-stable/array/is-array";
import _getIteratorMethod from "@babel/runtime-corejs3/core-js/get-iterator-method";
import _Symbol from "@babel/runtime-corejs3/core-js-stable/symbol";
import _Array$from from "@babel/runtime-corejs3/core-js-stable/array/from";
import _sliceInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/slice";
import _Object$defineProperty from "@babel/runtime-corejs3/core-js-stable/object/define-property";
import _Object$defineProperties from "@babel/runtime-corejs3/core-js-stable/object/define-properties";
import _Object$getOwnPropertyDescriptors from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptors";
import _forEachInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/for-each";
import _Object$getOwnPropertyDescriptor from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptor";
import _Object$getOwnPropertySymbols from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-symbols";
import _Object$keys from "@babel/runtime-corejs3/core-js-stable/object/keys";
import "core-js/modules/es.object.to-string";
import "core-js/modules/es.promise";
import "core-js/modules/es.regexp.exec";
import "core-js/modules/es.string.split";
import _reduceInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/reduce";
import _Promise from "@babel/runtime-corejs3/core-js-stable/promise";
import _keysInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/keys";
import _objectWithoutProperties from "@babel/runtime-corejs3/helpers/objectWithoutProperties";
import _regeneratorRuntime from "@babel/runtime-corejs3/regenerator";
import "regenerator-runtime/runtime";
import _defineProperty from "@babel/runtime-corejs3/helpers/defineProperty";
import _mapInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/map";
import _trimInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/trim";
import _filterInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/filter";
import _asyncToGenerator from "@babel/runtime-corejs3/helpers/asyncToGenerator";
function _createForOfIteratorHelper(o, allowArrayLike) { var it; if (typeof _Symbol === "undefined" || _getIteratorMethod(o) == null) { if (_Array$isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = _getIterator(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it.return != null) it.return(); } finally { if (didErr) throw err; } } }; }
function _unsupportedIterableToArray(o, minLen) { var _context9; if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = _sliceInstanceProperty(_context9 = Object.prototype.toString.call(o)).call(_context9, 8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return _Array$from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }
function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }
function ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = _filterInstanceProperty(symbols).call(symbols, function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }
function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { var _context7; _forEachInstanceProperty(_context7 = ownKeys(Object(source), true)).call(_context7, function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { var _context8; _forEachInstanceProperty(_context8 = ownKeys(Object(source))).call(_context8, function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }
import { createHttpRequestHandlerStreams, executeWithTimeout, isRedirect, performRedirectRequest } from '../request-helper';
import { readAll } from '../util/stream';
/**
 * As the request streming is not yet supported on major browsers,
 * it is set to false for now.
 */
var supportsReadableStream = false;

/*
(async () => {
  try {
    if (
      typeof fetch === 'function' &&
      typeof Request === 'function' &&
      typeof ReadableStream === 'function'
    ) {
      // this feature detection requires dummy POST request
      const req = new Request('data:text/plain,', {
        method: 'POST',
        body: new ReadableStream(),
      });
      // if it has content-type header it doesn't regard body as stream
      if (req.headers.has('Content-Type')) {
        return false;
      }
      await (await fetch(req)).text();
      return true;
    }
  } catch (e) {
    // error might occur in env with CSP without connect-src data:
    return false;
  }
  return false;
})();
*/

/**
 *
 */
function toWhatwgReadableStream(ins) {
  return new ReadableStream({
    start: function start(controller) {
      ins.on('data', function (chunk) {
        return controller.enqueue(chunk);
      });
      ins.on('end', function () {
        return controller.close();
      });
    }
  });
}

/**
 *
 */
function readWhatwgReadableStream(_x, _x2) {
  return _readWhatwgReadableStream.apply(this, arguments);
}
/**
 *
 */
function _readWhatwgReadableStream() {
  _readWhatwgReadableStream = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(rs, outs) {
    var reader, readAndWrite, _readAndWrite;
    return _regeneratorRuntime.wrap(function _callee2$(_context3) {
      while (1) {
        switch (_context3.prev = _context3.next) {
          case 0:
            _readAndWrite = function _readAndWrite3() {
              _readAndWrite = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {
                var _yield$reader$read, done, value;
                return _regeneratorRuntime.wrap(function _callee$(_context2) {
                  while (1) {
                    switch (_context2.prev = _context2.next) {
                      case 0:
                        _context2.next = 2;
                        return reader.read();
                      case 2:
                        _yield$reader$read = _context2.sent;
                        done = _yield$reader$read.done;
                        value = _yield$reader$read.value;
                        if (!done) {
                          _context2.next = 8;
                          break;
                        }
                        outs.end();
                        return _context2.abrupt("return", false);
                      case 8:
                        outs.write(value);
                        return _context2.abrupt("return", true);
                      case 10:
                      case "end":
                        return _context2.stop();
                    }
                  }
                }, _callee);
              }));
              return _readAndWrite.apply(this, arguments);
            };
            readAndWrite = function _readAndWrite2() {
              return _readAndWrite.apply(this, arguments);
            };
            reader = rs.getReader();
          case 3:
            _context3.next = 5;
            return readAndWrite();
          case 5:
            if (!_context3.sent) {
              _context3.next = 9;
              break;
            }
            ;
            _context3.next = 3;
            break;
          case 9:
          case "end":
            return _context3.stop();
        }
      }
    }, _callee2);
  }));
  return _readWhatwgReadableStream.apply(this, arguments);
}
function startFetchRequest(_x3, _x4, _x5, _x6, _x7) {
  return _startFetchRequest.apply(this, arguments);
}
/**
 *
 */
function _startFetchRequest() {
  _startFetchRequest = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(request, options, input, output, emitter) {
    var _context4;
    var counter,
      followRedirect,
      url,
      reqBody,
      rreq,
      body,
      controller,
      res,
      headers,
      _iterator,
      _step,
      headerName,
      response,
      _args3 = arguments;
    return _regeneratorRuntime.wrap(function _callee3$(_context5) {
      while (1) {
        switch (_context5.prev = _context5.next) {
          case 0:
            counter = _args3.length > 5 && _args3[5] !== undefined ? _args3[5] : 0;
            followRedirect = options.followRedirect;
            url = request.url, reqBody = request.body, rreq = _objectWithoutProperties(request, ["url", "body"]);
            if (!(input && /^(post|put|patch)$/i.test(request.method))) {
              _context5.next = 14;
              break;
            }
            if (!supportsReadableStream) {
              _context5.next = 8;
              break;
            }
            _context5.t1 = toWhatwgReadableStream(input);
            _context5.next = 11;
            break;
          case 8:
            _context5.next = 10;
            return readAll(input);
          case 10:
            _context5.t1 = _context5.sent;
          case 11:
            _context5.t0 = _context5.t1;
            _context5.next = 15;
            break;
          case 14:
            _context5.t0 = undefined;
          case 15:
            body = _context5.t0;
            controller = typeof AbortController !== 'undefined' ? new AbortController() : undefined;
            _context5.next = 19;
            return executeWithTimeout(function () {
              return fetch(url, _objectSpread(_objectSpread(_objectSpread(_objectSpread({}, rreq), body ? {
                body: body
              } : {}), {}, {
                redirect: 'manual'
              }, controller ? {
                signal: controller.signal
              } : {}), {
                allowHTTP1ForStreamingUpload: true
              }));
            }, options.timeout, function () {
              return controller === null || controller === void 0 ? void 0 : controller.abort();
            });
          case 19:
            res = _context5.sent;
            headers = {};
            _iterator = _createForOfIteratorHelper(_keysInstanceProperty(_context4 = res.headers).call(_context4));
            try {
              for (_iterator.s(); !(_step = _iterator.n()).done;) {
                headerName = _step.value;
                headers[headerName.toLowerCase()] = res.headers.get(headerName);
              }
            } catch (err) {
              _iterator.e(err);
            } finally {
              _iterator.f();
            }
            response = {
              statusCode: res.status,
              headers: headers
            };
            if (!(followRedirect && isRedirect(response.statusCode))) {
              _context5.next = 27;
              break;
            }
            try {
              performRedirectRequest(request, response, followRedirect, counter, function (req) {
                return startFetchRequest(req, options, undefined, output, emitter, counter + 1);
              });
            } catch (err) {
              emitter.emit('error', err);
            }
            return _context5.abrupt("return");
          case 27:
            emitter.emit('response', response);
            if (res.body) {
              readWhatwgReadableStream(res.body, output);
            } else {
              output.end();
            }
          case 29:
          case "end":
            return _context5.stop();
        }
      }
    }, _callee3);
  }));
  return _startFetchRequest.apply(this, arguments);
}
function getResponseHeaderNames(xhr) {
  var _context;
  var headerLines = _filterInstanceProperty(_context = (xhr.getAllResponseHeaders() || '').split(/[\r\n]+/)).call(_context, function (l) {
    return _trimInstanceProperty(l).call(l) !== '';
  });
  return _mapInstanceProperty(headerLines).call(headerLines, function (headerLine) {
    return headerLine.split(/\s*:/)[0].toLowerCase();
  });
}

/**
 *
 */
function startXmlHttpRequest(_x8, _x9, _x10, _x11, _x12) {
  return _startXmlHttpRequest.apply(this, arguments);
}
/**
 *
 */
function _startXmlHttpRequest() {
  _startXmlHttpRequest = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(request, options, input, output, emitter) {
    var counter,
      method,
      url,
      reqHeaders,
      followRedirect,
      reqBody,
      xhr,
      headerNames,
      headers,
      response,
      body,
      _args4 = arguments;
    return _regeneratorRuntime.wrap(function _callee4$(_context6) {
      while (1) {
        switch (_context6.prev = _context6.next) {
          case 0:
            counter = _args4.length > 5 && _args4[5] !== undefined ? _args4[5] : 0;
            method = request.method, url = request.url, reqHeaders = request.headers;
            followRedirect = options.followRedirect;
            if (!(input && /^(post|put|patch)$/i.test(method))) {
              _context6.next = 9;
              break;
            }
            _context6.next = 6;
            return readAll(input);
          case 6:
            _context6.t0 = _context6.sent;
            _context6.next = 10;
            break;
          case 9:
            _context6.t0 = null;
          case 10:
            reqBody = _context6.t0;
            xhr = new XMLHttpRequest();
            _context6.next = 14;
            return executeWithTimeout(function () {
              xhr.open(method, url);
              if (reqHeaders) {
                for (var header in reqHeaders) {
                  xhr.setRequestHeader(header, reqHeaders[header]);
                }
              }
              if (options.timeout) {
                xhr.timeout = options.timeout;
              }
              xhr.responseType = 'arraybuffer';
              xhr.send(reqBody);
              return new _Promise(function (resolve, reject) {
                xhr.onload = function () {
                  return resolve();
                };
                xhr.onerror = reject;
                xhr.ontimeout = reject;
                xhr.onabort = reject;
              });
            }, options.timeout, function () {
              return xhr.abort();
            });
          case 14:
            headerNames = getResponseHeaderNames(xhr);
            headers = _reduceInstanceProperty(headerNames).call(headerNames, function (headers, headerName) {
              return _objectSpread(_objectSpread({}, headers), {}, _defineProperty({}, headerName, xhr.getResponseHeader(headerName) || ''));
            }, {});
            response = {
              statusCode: xhr.status,
              headers: headers
            };
            if (!(followRedirect && isRedirect(response.statusCode))) {
              _context6.next = 20;
              break;
            }
            try {
              performRedirectRequest(request, response, followRedirect, counter, function (req) {
                return startXmlHttpRequest(req, options, undefined, output, emitter, counter + 1);
              });
            } catch (err) {
              emitter.emit('error', err);
            }
            return _context6.abrupt("return");
          case 20:
            if (!response.statusCode) {
              response.statusCode = 400;
              body = Buffer.from('Access Declined');
            } else {
              body = Buffer.from(xhr.response);
            }
            emitter.emit('response', response);
            output.write(body);
            output.end();
          case 24:
          case "end":
            return _context6.stop();
        }
      }
    }, _callee4);
  }));
  return _startXmlHttpRequest.apply(this, arguments);
}
var defaults = {};

/**
 *
 */
export function setDefaults(defaults_) {
  defaults = defaults_;
}

/**
 *
 */
export default function request(req) {
  var options_ = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
  var options = _objectSpread(_objectSpread({}, defaults), options_);
  var _createHttpRequestHan = createHttpRequestHandlerStreams(req, options),
    input = _createHttpRequestHan.input,
    output = _createHttpRequestHan.output,
    stream = _createHttpRequestHan.stream;
  if (typeof window !== 'undefined' && typeof window.fetch === 'function') {
    startFetchRequest(req, options, input, output, stream);
  } else {
    startXmlHttpRequest(req, options, input, output, stream);
  }
  return stream;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjcmVhdGVIdHRwUmVxdWVzdEhhbmRsZXJTdHJlYW1zIiwiZXhlY3V0ZVdpdGhUaW1lb3V0IiwiaXNSZWRpcmVjdCIsInBlcmZvcm1SZWRpcmVjdFJlcXVlc3QiLCJyZWFkQWxsIiwic3VwcG9ydHNSZWFkYWJsZVN0cmVhbSIsInRvV2hhdHdnUmVhZGFibGVTdHJlYW0iLCJpbnMiLCJSZWFkYWJsZVN0cmVhbSIsInN0YXJ0IiwiY29udHJvbGxlciIsIm9uIiwiY2h1bmsiLCJlbnF1ZXVlIiwiY2xvc2UiLCJyZWFkV2hhdHdnUmVhZGFibGVTdHJlYW0iLCJfeCIsIl94MiIsIl9yZWFkV2hhdHdnUmVhZGFibGVTdHJlYW0iLCJhcHBseSIsImFyZ3VtZW50cyIsIl9hc3luY1RvR2VuZXJhdG9yIiwiX3JlZ2VuZXJhdG9yUnVudGltZSIsIm1hcmsiLCJfY2FsbGVlMiIsInJzIiwib3V0cyIsInJlYWRlciIsInJlYWRBbmRXcml0ZSIsIl9yZWFkQW5kV3JpdGUiLCJ3cmFwIiwiX2NhbGxlZTIkIiwiX2NvbnRleHQzIiwicHJldiIsIm5leHQiLCJfcmVhZEFuZFdyaXRlMyIsIl9jYWxsZWUiLCJfeWllbGQkcmVhZGVyJHJlYWQiLCJkb25lIiwidmFsdWUiLCJfY2FsbGVlJCIsIl9jb250ZXh0MiIsInJlYWQiLCJzZW50IiwiZW5kIiwiYWJydXB0Iiwid3JpdGUiLCJzdG9wIiwiX3JlYWRBbmRXcml0ZTIiLCJnZXRSZWFkZXIiLCJzdGFydEZldGNoUmVxdWVzdCIsIl94MyIsIl94NCIsIl94NSIsIl94NiIsIl94NyIsIl9zdGFydEZldGNoUmVxdWVzdCIsIl9jYWxsZWUzIiwicmVxdWVzdCIsIm9wdGlvbnMiLCJpbnB1dCIsIm91dHB1dCIsImVtaXR0ZXIiLCJfY29udGV4dDQiLCJjb3VudGVyIiwiZm9sbG93UmVkaXJlY3QiLCJ1cmwiLCJyZXFCb2R5IiwicnJlcSIsImJvZHkiLCJyZXMiLCJoZWFkZXJzIiwiX2l0ZXJhdG9yIiwiX3N0ZXAiLCJoZWFkZXJOYW1lIiwicmVzcG9uc2UiLCJfYXJnczMiLCJfY2FsbGVlMyQiLCJfY29udGV4dDUiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJfb2JqZWN0V2l0aG91dFByb3BlcnRpZXMiLCJ0ZXN0IiwibWV0aG9kIiwidDEiLCJ0MCIsIkFib3J0Q29udHJvbGxlciIsImZldGNoIiwiX29iamVjdFNwcmVhZCIsInJlZGlyZWN0Iiwic2lnbmFsIiwiYWxsb3dIVFRQMUZvclN0cmVhbWluZ1VwbG9hZCIsInRpbWVvdXQiLCJhYm9ydCIsIl9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyIiwiX2tleXNJbnN0YW5jZVByb3BlcnR5IiwiY2FsbCIsInMiLCJuIiwidG9Mb3dlckNhc2UiLCJnZXQiLCJlcnIiLCJlIiwiZiIsInN0YXR1c0NvZGUiLCJzdGF0dXMiLCJyZXEiLCJlbWl0IiwiZ2V0UmVzcG9uc2VIZWFkZXJOYW1lcyIsInhociIsIl9jb250ZXh0IiwiaGVhZGVyTGluZXMiLCJfZmlsdGVySW5zdGFuY2VQcm9wZXJ0eSIsImdldEFsbFJlc3BvbnNlSGVhZGVycyIsInNwbGl0IiwibCIsIl90cmltSW5zdGFuY2VQcm9wZXJ0eSIsIl9tYXBJbnN0YW5jZVByb3BlcnR5IiwiaGVhZGVyTGluZSIsInN0YXJ0WG1sSHR0cFJlcXVlc3QiLCJfeDgiLCJfeDkiLCJfeDEwIiwiX3gxMSIsIl94MTIiLCJfc3RhcnRYbWxIdHRwUmVxdWVzdCIsIl9jYWxsZWU0IiwicmVxSGVhZGVycyIsImhlYWRlck5hbWVzIiwiX2FyZ3M0IiwiX2NhbGxlZTQkIiwiX2NvbnRleHQ2IiwiWE1MSHR0cFJlcXVlc3QiLCJvcGVuIiwiaGVhZGVyIiwic2V0UmVxdWVzdEhlYWRlciIsInJlc3BvbnNlVHlwZSIsInNlbmQiLCJfUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJvbmxvYWQiLCJvbmVycm9yIiwib250aW1lb3V0Iiwib25hYm9ydCIsIl9yZWR1Y2VJbnN0YW5jZVByb3BlcnR5IiwiX2RlZmluZVByb3BlcnR5IiwiZ2V0UmVzcG9uc2VIZWFkZXIiLCJCdWZmZXIiLCJmcm9tIiwiZGVmYXVsdHMiLCJzZXREZWZhdWx0cyIsImRlZmF1bHRzXyIsIm9wdGlvbnNfIiwiX2NyZWF0ZUh0dHBSZXF1ZXN0SGFuIiwic3RyZWFtIiwid2luZG93Il0sInNvdXJjZXMiOlsiLi4vLi4vc3JjL2Jyb3dzZXIvcmVxdWVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFdmVudEVtaXR0ZXIgfSBmcm9tICdldmVudHMnO1xuaW1wb3J0IHsgUmVhZGFibGUsIFdyaXRhYmxlIH0gZnJvbSAnc3RyZWFtJztcbmltcG9ydCB7XG4gIGNyZWF0ZUh0dHBSZXF1ZXN0SGFuZGxlclN0cmVhbXMsXG4gIGV4ZWN1dGVXaXRoVGltZW91dCxcbiAgaXNSZWRpcmVjdCxcbiAgcGVyZm9ybVJlZGlyZWN0UmVxdWVzdCxcbn0gZnJvbSAnLi4vcmVxdWVzdC1oZWxwZXInO1xuaW1wb3J0IHsgcmVhZEFsbCB9IGZyb20gJy4uL3V0aWwvc3RyZWFtJztcbmltcG9ydCB7IEh0dHBSZXF1ZXN0LCBIdHRwUmVxdWVzdE9wdGlvbnMgfSBmcm9tICcuLi90eXBlcyc7XG5cbi8qKlxuICogQXMgdGhlIHJlcXVlc3Qgc3RyZW1pbmcgaXMgbm90IHlldCBzdXBwb3J0ZWQgb24gbWFqb3IgYnJvd3NlcnMsXG4gKiBpdCBpcyBzZXQgdG8gZmFsc2UgZm9yIG5vdy5cbiAqL1xuY29uc3Qgc3VwcG9ydHNSZWFkYWJsZVN0cmVhbSA9IGZhbHNlO1xuXG4vKlxuKGFzeW5jICgpID0+IHtcbiAgdHJ5IHtcbiAgICBpZiAoXG4gICAgICB0eXBlb2YgZmV0Y2ggPT09ICdmdW5jdGlvbicgJiZcbiAgICAgIHR5cGVvZiBSZXF1ZXN0ID09PSAnZnVuY3Rpb24nICYmXG4gICAgICB0eXBlb2YgUmVhZGFibGVTdHJlYW0gPT09ICdmdW5jdGlvbidcbiAgICApIHtcbiAgICAgIC8vIHRoaXMgZmVhdHVyZSBkZXRlY3Rpb24gcmVxdWlyZXMgZHVtbXkgUE9TVCByZXF1ZXN0XG4gICAgICBjb25zdCByZXEgPSBuZXcgUmVxdWVzdCgnZGF0YTp0ZXh0L3BsYWluLCcsIHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIGJvZHk6IG5ldyBSZWFkYWJsZVN0cmVhbSgpLFxuICAgICAgfSk7XG4gICAgICAvLyBpZiBpdCBoYXMgY29udGVudC10eXBlIGhlYWRlciBpdCBkb2Vzbid0IHJlZ2FyZCBib2R5IGFzIHN0cmVhbVxuICAgICAgaWYgKHJlcS5oZWFkZXJzLmhhcygnQ29udGVudC1UeXBlJykpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgYXdhaXQgKGF3YWl0IGZldGNoKHJlcSkpLnRleHQoKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfSBjYXRjaCAoZSkge1xuICAgIC8vIGVycm9yIG1pZ2h0IG9jY3VyIGluIGVudiB3aXRoIENTUCB3aXRob3V0IGNvbm5lY3Qtc3JjIGRhdGE6XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHJldHVybiBmYWxzZTtcbn0pKCk7XG4qL1xuXG4vKipcbiAqXG4gKi9cbmZ1bmN0aW9uIHRvV2hhdHdnUmVhZGFibGVTdHJlYW0oaW5zOiBSZWFkYWJsZSk6IFJlYWRhYmxlU3RyZWFtIHtcbiAgcmV0dXJuIG5ldyBSZWFkYWJsZVN0cmVhbSh7XG4gICAgc3RhcnQoY29udHJvbGxlcikge1xuICAgICAgaW5zLm9uKCdkYXRhJywgKGNodW5rKSA9PiBjb250cm9sbGVyLmVucXVldWUoY2h1bmspKTtcbiAgICAgIGlucy5vbignZW5kJywgKCkgPT4gY29udHJvbGxlci5jbG9zZSgpKTtcbiAgICB9LFxuICB9KTtcbn1cblxuLyoqXG4gKlxuICovXG5hc3luYyBmdW5jdGlvbiByZWFkV2hhdHdnUmVhZGFibGVTdHJlYW0ocnM6IFJlYWRhYmxlU3RyZWFtLCBvdXRzOiBXcml0YWJsZSkge1xuICBjb25zdCByZWFkZXIgPSBycy5nZXRSZWFkZXIoKTtcbiAgYXN5bmMgZnVuY3Rpb24gcmVhZEFuZFdyaXRlKCkge1xuICAgIGNvbnN0IHsgZG9uZSwgdmFsdWUgfSA9IGF3YWl0IHJlYWRlci5yZWFkKCk7XG4gICAgaWYgKGRvbmUpIHtcbiAgICAgIG91dHMuZW5kKCk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIG91dHMud3JpdGUodmFsdWUpO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIHdoaWxlIChhd2FpdCByZWFkQW5kV3JpdGUoKSk7XG59XG5cbi8qKlxuICpcbiAqL1xuYXN5bmMgZnVuY3Rpb24gc3RhcnRGZXRjaFJlcXVlc3QoXG4gIHJlcXVlc3Q6IEh0dHBSZXF1ZXN0LFxuICBvcHRpb25zOiBIdHRwUmVxdWVzdE9wdGlvbnMsXG4gIGlucHV0OiBSZWFkYWJsZSB8IHVuZGVmaW5lZCxcbiAgb3V0cHV0OiBXcml0YWJsZSxcbiAgZW1pdHRlcjogRXZlbnRFbWl0dGVyLFxuICBjb3VudGVyOiBudW1iZXIgPSAwLFxuKSB7XG4gIGNvbnN0IHsgZm9sbG93UmVkaXJlY3QgfSA9IG9wdGlvbnM7XG4gIGNvbnN0IHsgdXJsLCBib2R5OiByZXFCb2R5LCAuLi5ycmVxIH0gPSByZXF1ZXN0O1xuICBjb25zdCBib2R5ID1cbiAgICBpbnB1dCAmJiAvXihwb3N0fHB1dHxwYXRjaCkkL2kudGVzdChyZXF1ZXN0Lm1ldGhvZClcbiAgICAgID8gc3VwcG9ydHNSZWFkYWJsZVN0cmVhbVxuICAgICAgICA/IHRvV2hhdHdnUmVhZGFibGVTdHJlYW0oaW5wdXQpXG4gICAgICAgIDogYXdhaXQgcmVhZEFsbChpbnB1dClcbiAgICAgIDogdW5kZWZpbmVkO1xuICBjb25zdCBjb250cm9sbGVyID1cbiAgICB0eXBlb2YgQWJvcnRDb250cm9sbGVyICE9PSAndW5kZWZpbmVkJyA/IG5ldyBBYm9ydENvbnRyb2xsZXIoKSA6IHVuZGVmaW5lZDtcbiAgY29uc3QgcmVzID0gYXdhaXQgZXhlY3V0ZVdpdGhUaW1lb3V0KFxuICAgICgpID0+XG4gICAgICBmZXRjaCh1cmwsIHtcbiAgICAgICAgLi4ucnJlcSxcbiAgICAgICAgLi4uKGJvZHkgPyB7IGJvZHkgfSA6IHt9KSxcbiAgICAgICAgcmVkaXJlY3Q6ICdtYW51YWwnLFxuICAgICAgICAuLi4oY29udHJvbGxlciA/IHsgc2lnbmFsOiBjb250cm9sbGVyLnNpZ25hbCB9IDoge30pLFxuICAgICAgICAuLi4oeyBhbGxvd0hUVFAxRm9yU3RyZWFtaW5nVXBsb2FkOiB0cnVlIH0gYXMgYW55KSwgLy8gQ2hyb21lIGFsbG93cyByZXF1ZXN0IHN0cmVhbSBvbmx5IGluIEhUVFAyL1FVSUMgdW5sZXNzIHRoaXMgb3B0LWluIGZsYWdcbiAgICAgIH0pLFxuICAgIG9wdGlvbnMudGltZW91dCxcbiAgICAoKSA9PiBjb250cm9sbGVyPy5hYm9ydCgpLFxuICApO1xuICBjb25zdCBoZWFkZXJzOiB7IFtrZXk6IHN0cmluZ106IGFueSB9ID0ge307XG4gIGZvciAoY29uc3QgaGVhZGVyTmFtZSBvZiByZXMuaGVhZGVycy5rZXlzKCkpIHtcbiAgICBoZWFkZXJzW2hlYWRlck5hbWUudG9Mb3dlckNhc2UoKV0gPSByZXMuaGVhZGVycy5nZXQoaGVhZGVyTmFtZSk7XG4gIH1cbiAgY29uc3QgcmVzcG9uc2UgPSB7XG4gICAgc3RhdHVzQ29kZTogcmVzLnN0YXR1cyxcbiAgICBoZWFkZXJzLFxuICB9O1xuICBpZiAoZm9sbG93UmVkaXJlY3QgJiYgaXNSZWRpcmVjdChyZXNwb25zZS5zdGF0dXNDb2RlKSkge1xuICAgIHRyeSB7XG4gICAgICBwZXJmb3JtUmVkaXJlY3RSZXF1ZXN0KFxuICAgICAgICByZXF1ZXN0LFxuICAgICAgICByZXNwb25zZSxcbiAgICAgICAgZm9sbG93UmVkaXJlY3QsXG4gICAgICAgIGNvdW50ZXIsXG4gICAgICAgIChyZXEpID0+XG4gICAgICAgICAgc3RhcnRGZXRjaFJlcXVlc3QoXG4gICAgICAgICAgICByZXEsXG4gICAgICAgICAgICBvcHRpb25zLFxuICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgb3V0cHV0LFxuICAgICAgICAgICAgZW1pdHRlcixcbiAgICAgICAgICAgIGNvdW50ZXIgKyAxLFxuICAgICAgICAgICksXG4gICAgICApO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgZW1pdHRlci5lbWl0KCdlcnJvcicsIGVycik7XG4gICAgfVxuICAgIHJldHVybjtcbiAgfVxuICBlbWl0dGVyLmVtaXQoJ3Jlc3BvbnNlJywgcmVzcG9uc2UpO1xuICBpZiAocmVzLmJvZHkpIHtcbiAgICByZWFkV2hhdHdnUmVhZGFibGVTdHJlYW0ocmVzLmJvZHksIG91dHB1dCk7XG4gIH0gZWxzZSB7XG4gICAgb3V0cHV0LmVuZCgpO1xuICB9XG59XG5cbi8qKlxuICpcbiAqL1xuZnVuY3Rpb24gZ2V0UmVzcG9uc2VIZWFkZXJOYW1lcyh4aHI6IFhNTEh0dHBSZXF1ZXN0KSB7XG4gIGNvbnN0IGhlYWRlckxpbmVzID0gKHhoci5nZXRBbGxSZXNwb25zZUhlYWRlcnMoKSB8fCAnJylcbiAgICAuc3BsaXQoL1tcXHJcXG5dKy8pXG4gICAgLmZpbHRlcigobCkgPT4gbC50cmltKCkgIT09ICcnKTtcbiAgcmV0dXJuIGhlYWRlckxpbmVzLm1hcCgoaGVhZGVyTGluZSkgPT5cbiAgICBoZWFkZXJMaW5lLnNwbGl0KC9cXHMqOi8pWzBdLnRvTG93ZXJDYXNlKCksXG4gICk7XG59XG5cbi8qKlxuICpcbiAqL1xuYXN5bmMgZnVuY3Rpb24gc3RhcnRYbWxIdHRwUmVxdWVzdChcbiAgcmVxdWVzdDogSHR0cFJlcXVlc3QsXG4gIG9wdGlvbnM6IEh0dHBSZXF1ZXN0T3B0aW9ucyxcbiAgaW5wdXQ6IFJlYWRhYmxlIHwgdW5kZWZpbmVkLFxuICBvdXRwdXQ6IFdyaXRhYmxlLFxuICBlbWl0dGVyOiBFdmVudEVtaXR0ZXIsXG4gIGNvdW50ZXI6IG51bWJlciA9IDAsXG4pIHtcbiAgY29uc3QgeyBtZXRob2QsIHVybCwgaGVhZGVyczogcmVxSGVhZGVycyB9ID0gcmVxdWVzdDtcbiAgY29uc3QgeyBmb2xsb3dSZWRpcmVjdCB9ID0gb3B0aW9ucztcbiAgY29uc3QgcmVxQm9keSA9XG4gICAgaW5wdXQgJiYgL14ocG9zdHxwdXR8cGF0Y2gpJC9pLnRlc3QobWV0aG9kKSA/IGF3YWl0IHJlYWRBbGwoaW5wdXQpIDogbnVsbDtcbiAgY29uc3QgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gIGF3YWl0IGV4ZWN1dGVXaXRoVGltZW91dChcbiAgICAoKSA9PiB7XG4gICAgICB4aHIub3BlbihtZXRob2QsIHVybCk7XG4gICAgICBpZiAocmVxSGVhZGVycykge1xuICAgICAgICBmb3IgKGNvbnN0IGhlYWRlciBpbiByZXFIZWFkZXJzKSB7XG4gICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoaGVhZGVyLCByZXFIZWFkZXJzW2hlYWRlcl0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAob3B0aW9ucy50aW1lb3V0KSB7XG4gICAgICAgIHhoci50aW1lb3V0ID0gb3B0aW9ucy50aW1lb3V0O1xuICAgICAgfVxuICAgICAgeGhyLnJlc3BvbnNlVHlwZSA9ICdhcnJheWJ1ZmZlcic7XG4gICAgICB4aHIuc2VuZChyZXFCb2R5KTtcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZTx2b2lkPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIHhoci5vbmxvYWQgPSAoKSA9PiByZXNvbHZlKCk7XG4gICAgICAgIHhoci5vbmVycm9yID0gcmVqZWN0O1xuICAgICAgICB4aHIub250aW1lb3V0ID0gcmVqZWN0O1xuICAgICAgICB4aHIub25hYm9ydCA9IHJlamVjdDtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgb3B0aW9ucy50aW1lb3V0LFxuICAgICgpID0+IHhoci5hYm9ydCgpLFxuICApO1xuICBjb25zdCBoZWFkZXJOYW1lcyA9IGdldFJlc3BvbnNlSGVhZGVyTmFtZXMoeGhyKTtcbiAgY29uc3QgaGVhZGVycyA9IGhlYWRlck5hbWVzLnJlZHVjZShcbiAgICAoaGVhZGVycywgaGVhZGVyTmFtZSkgPT4gKHtcbiAgICAgIC4uLmhlYWRlcnMsXG4gICAgICBbaGVhZGVyTmFtZV06IHhoci5nZXRSZXNwb25zZUhlYWRlcihoZWFkZXJOYW1lKSB8fCAnJyxcbiAgICB9KSxcbiAgICB7fSBhcyB7IFtuYW1lOiBzdHJpbmddOiBzdHJpbmcgfSxcbiAgKTtcbiAgY29uc3QgcmVzcG9uc2UgPSB7XG4gICAgc3RhdHVzQ29kZTogeGhyLnN0YXR1cyxcbiAgICBoZWFkZXJzOiBoZWFkZXJzLFxuICB9O1xuICBpZiAoZm9sbG93UmVkaXJlY3QgJiYgaXNSZWRpcmVjdChyZXNwb25zZS5zdGF0dXNDb2RlKSkge1xuICAgIHRyeSB7XG4gICAgICBwZXJmb3JtUmVkaXJlY3RSZXF1ZXN0KFxuICAgICAgICByZXF1ZXN0LFxuICAgICAgICByZXNwb25zZSxcbiAgICAgICAgZm9sbG93UmVkaXJlY3QsXG4gICAgICAgIGNvdW50ZXIsXG4gICAgICAgIChyZXEpID0+XG4gICAgICAgICAgc3RhcnRYbWxIdHRwUmVxdWVzdChcbiAgICAgICAgICAgIHJlcSxcbiAgICAgICAgICAgIG9wdGlvbnMsXG4gICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICBvdXRwdXQsXG4gICAgICAgICAgICBlbWl0dGVyLFxuICAgICAgICAgICAgY291bnRlciArIDEsXG4gICAgICAgICAgKSxcbiAgICAgICk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBlbWl0dGVyLmVtaXQoJ2Vycm9yJywgZXJyKTtcbiAgICB9XG4gICAgcmV0dXJuO1xuICB9XG4gIGxldCBib2R5OiBCdWZmZXI7XG4gIGlmICghcmVzcG9uc2Uuc3RhdHVzQ29kZSkge1xuICAgIHJlc3BvbnNlLnN0YXR1c0NvZGUgPSA0MDA7XG4gICAgYm9keSA9IEJ1ZmZlci5mcm9tKCdBY2Nlc3MgRGVjbGluZWQnKTtcbiAgfSBlbHNlIHtcbiAgICBib2R5ID0gQnVmZmVyLmZyb20oeGhyLnJlc3BvbnNlKTtcbiAgfVxuICBlbWl0dGVyLmVtaXQoJ3Jlc3BvbnNlJywgcmVzcG9uc2UpO1xuICBvdXRwdXQud3JpdGUoYm9keSk7XG4gIG91dHB1dC5lbmQoKTtcbn1cblxuLyoqXG4gKlxuICovXG5sZXQgZGVmYXVsdHM6IEh0dHBSZXF1ZXN0T3B0aW9ucyA9IHt9O1xuXG4vKipcbiAqXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzZXREZWZhdWx0cyhkZWZhdWx0c186IEh0dHBSZXF1ZXN0T3B0aW9ucykge1xuICBkZWZhdWx0cyA9IGRlZmF1bHRzXztcbn1cblxuLyoqXG4gKlxuICovXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiByZXF1ZXN0KFxuICByZXE6IEh0dHBSZXF1ZXN0LFxuICBvcHRpb25zXzogSHR0cFJlcXVlc3RPcHRpb25zID0ge30sXG4pIHtcbiAgY29uc3Qgb3B0aW9ucyA9IHsgLi4uZGVmYXVsdHMsIC4uLm9wdGlvbnNfIH07XG4gIGNvbnN0IHsgaW5wdXQsIG91dHB1dCwgc3RyZWFtIH0gPSBjcmVhdGVIdHRwUmVxdWVzdEhhbmRsZXJTdHJlYW1zKFxuICAgIHJlcSxcbiAgICBvcHRpb25zLFxuICApO1xuICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIHdpbmRvdy5mZXRjaCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIHN0YXJ0RmV0Y2hSZXF1ZXN0KHJlcSwgb3B0aW9ucywgaW5wdXQsIG91dHB1dCwgc3RyZWFtKTtcbiAgfSBlbHNlIHtcbiAgICBzdGFydFhtbEh0dHBSZXF1ZXN0KHJlcSwgb3B0aW9ucywgaW5wdXQsIG91dHB1dCwgc3RyZWFtKTtcbiAgfVxuICByZXR1cm4gc3RyZWFtO1xufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFQSxTQUNFQSwrQkFBK0IsRUFDL0JDLGtCQUFrQixFQUNsQkMsVUFBVSxFQUNWQyxzQkFBc0IsUUFDakIsbUJBQW1CO0FBQzFCLFNBQVNDLE9BQU8sUUFBUSxnQkFBZ0I7QUFHeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFNQyxzQkFBc0IsR0FBRyxLQUFLOztBQUVwQztBQUNB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