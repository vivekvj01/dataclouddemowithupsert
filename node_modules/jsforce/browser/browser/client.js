import _Object$defineProperty from "@babel/runtime-corejs3/core-js-stable/object/define-property";
import _Object$defineProperties from "@babel/runtime-corejs3/core-js-stable/object/define-properties";
import _Object$getOwnPropertyDescriptors from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptors";
import _forEachInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/for-each";
import _Object$getOwnPropertyDescriptor from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptor";
import _filterInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/filter";
import _Object$getOwnPropertySymbols from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-symbols";
import _Object$keys from "@babel/runtime-corejs3/core-js-stable/object/keys";
import _Reflect$construct from "@babel/runtime-corejs3/core-js-stable/reflect/construct";
import "core-js/modules/es.array.join";
import "core-js/modules/es.number.constructor";
import "core-js/modules/es.object.to-string";
import "core-js/modules/es.regexp.constructor";
import "core-js/modules/es.regexp.exec";
import "core-js/modules/es.regexp.to-string";
import "core-js/modules/es.string.match";
import "core-js/modules/es.string.search";
import "core-js/modules/es.string.split";
import _JSON$stringify from "@babel/runtime-corejs3/core-js-stable/json/stringify";
import _reverseInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/reverse";
import _Date$now from "@babel/runtime-corejs3/core-js-stable/date/now";
import _setInterval from "@babel/runtime-corejs3/core-js-stable/set-interval";
import _Promise from "@babel/runtime-corejs3/core-js-stable/promise";
import _setTimeout from "@babel/runtime-corejs3/core-js-stable/set-timeout";
import _classCallCheck from "@babel/runtime-corejs3/helpers/classCallCheck";
import _createClass from "@babel/runtime-corejs3/helpers/createClass";
import _assertThisInitialized from "@babel/runtime-corejs3/helpers/assertThisInitialized";
import _inherits from "@babel/runtime-corejs3/helpers/inherits";
import _possibleConstructorReturn from "@babel/runtime-corejs3/helpers/possibleConstructorReturn";
import _getPrototypeOf from "@babel/runtime-corejs3/helpers/getPrototypeOf";
import _defineProperty from "@babel/runtime-corejs3/helpers/defineProperty";
import _slicedToArray from "@babel/runtime-corejs3/helpers/slicedToArray";
import _concatInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/concat";
function ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = _filterInstanceProperty(symbols).call(symbols, function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }
function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { var _context5; _forEachInstanceProperty(_context5 = ownKeys(Object(source), true)).call(_context5, function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { var _context6; _forEachInstanceProperty(_context6 = ownKeys(Object(source))).call(_context6, function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }
function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = _Reflect$construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }
function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !_Reflect$construct) return false; if (_Reflect$construct.sham) return false; if (typeof Proxy === "function") return true; try { Date.prototype.toString.call(_Reflect$construct(Date, [], function () {})); return true; } catch (e) { return false; } }
/**
 * @file Browser client connection management class
 * @author Shinichi Tomita <shinichi.tomita@gmail.com>
 */
import { EventEmitter } from 'events';
import qs from 'querystring';
import Connection from '../connection';
import OAuth2 from '../oauth2';

/**
 * @private
 */
function popupWin(url, w, h) {
  var _context, _context2, _context3;
  var left = screen.width / 2 - w / 2;
  var top = screen.height / 2 - h / 2;
  return window.open(url, undefined, _concatInstanceProperty(_context = _concatInstanceProperty(_context2 = _concatInstanceProperty(_context3 = "location=yes,toolbar=no,status=no,menubar=no,width=".concat(w, ",height=")).call(_context3, h, ",top=")).call(_context2, top, ",left=")).call(_context, left));
}

/**
 * @private
 */
function handleCallbackResponse() {
  var res = checkCallbackResponse();
  var state = localStorage.getItem('jsforce_state');
  if (res && state && res.body.state === state) {
    localStorage.removeItem('jsforce_state');
    var _state$split = state.split('.'),
      _state$split2 = _slicedToArray(_state$split, 2),
      prefix = _state$split2[0],
      promptType = _state$split2[1];
    var cli = new BrowserClient(prefix);
    if (res.success) {
      cli._storeTokens(res.body);
      location.hash = '';
    } else {
      cli._storeError(res.body);
    }
    if (promptType === 'popup') {
      window.close();
    }
    return true;
  }
}

/**
 * @private
 */
function checkCallbackResponse() {
  var params;
  if (window.location.hash) {
    params = qs.parse(window.location.hash.substring(1));
    if (params.access_token) {
      return {
        success: true,
        body: params
      };
    }
  } else if (window.location.search) {
    params = qs.parse(window.location.search.substring(1));
    if (params.error) {
      return {
        success: false,
        body: params
      };
    }
  }
}

/**
 *
 */

/**
 *
 */
var DEFAULT_POPUP_WIN_WIDTH = 912;
var DEFAULT_POPUP_WIN_HEIGHT = 513;

/** @private **/
var clientIdx = 0;

/**
 *
 */
export var BrowserClient = /*#__PURE__*/function (_EventEmitter) {
  _inherits(BrowserClient, _EventEmitter);
  var _super = _createSuper(BrowserClient);
  /**
   *
   */
  function BrowserClient(prefix) {
    var _this;
    _classCallCheck(this, BrowserClient);
    _this = _super.call(this);
    _defineProperty(_assertThisInitialized(_this), "_prefix", void 0);
    _defineProperty(_assertThisInitialized(_this), "_config", void 0);
    _defineProperty(_assertThisInitialized(_this), "_connection", void 0);
    _this._prefix = prefix || 'jsforce' + clientIdx++;
    return _this;
  }
  _createClass(BrowserClient, [{
    key: "init",
    /**
     *
     */
    value: function init(config) {
      var _this2 = this;
      if (handleCallbackResponse()) {
        return;
      }
      this._config = config;
      var tokens = this._getTokens();
      if (tokens) {
        this.connection._establish(tokens);
        _setTimeout(function () {
          _this2.emit('connect', _this2.connection);
        }, 10);
      }
    }
    /**
     *
     */
  }, {
    key: "login",
    value: function login() {
      var _this$_config,
        _size$width,
        _size$height,
        _this3 = this;
      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
      var scope = options.scope,
        size = options.size;
      var oauth2 = new OAuth2((_this$_config = this._config) !== null && _this$_config !== void 0 ? _this$_config : {});
      var rand = Math.random().toString(36).substring(2);
      var state = [this._prefix, 'popup', rand].join('.');
      localStorage.setItem('jsforce_state', state);
      var authzUrl = oauth2.getAuthorizationUrl(_objectSpread({
        response_type: 'token',
        state: state
      }, scope ? {
        scope: scope
      } : {}));
      var pw = popupWin(authzUrl, (_size$width = size === null || size === void 0 ? void 0 : size.width) !== null && _size$width !== void 0 ? _size$width : DEFAULT_POPUP_WIN_WIDTH, (_size$height = size === null || size === void 0 ? void 0 : size.height) !== null && _size$height !== void 0 ? _size$height : DEFAULT_POPUP_WIN_HEIGHT);
      return new _Promise(function (resolve, reject) {
        if (!pw) {
          var _state = [_this3._prefix, 'redirect', rand].join('.');
          localStorage.setItem('jsforce_state', _state);
          var _authzUrl = oauth2.getAuthorizationUrl(_objectSpread({
            response_type: 'token',
            state: _state
          }, scope ? {
            scope: scope
          } : {}));
          location.href = _authzUrl;
          return;
        }
        _this3._removeTokens();
        var pid = _setInterval(function () {
          try {
            if (!pw || pw.closed) {
              clearInterval(pid);
              var tokens = _this3._getTokens();
              if (tokens) {
                _this3.connection._establish(tokens);
                _this3.emit('connect', _this3.connection);
                resolve({
                  status: 'connect'
                });
              } else {
                var err = _this3._getError();
                if (err) {
                  reject(new Error(err.error + ': ' + err.error_description));
                } else {
                  resolve({
                    status: 'cancel'
                  });
                }
              }
            }
          } catch (e) {
            //
          }
        }, 1000);
      });
    }
    /**
     *
     */
  }, {
    key: "isLoggedIn",
    value: function isLoggedIn() {
      return !!this.connection.accessToken;
    }
    /**
     *
     */
  }, {
    key: "logout",
    value: function logout() {
      this.connection.logout();
      this._removeTokens();
      this.emit('disconnect');
    }
    /**
     * @private
     */
  }, {
    key: "_getTokens",
    value: function _getTokens() {
      var regexp = new RegExp('(^|;\\s*)' + this._prefix + '_loggedin=true(;|$)');
      if (document.cookie.match(regexp)) {
        var issuedAt = Number(localStorage.getItem(this._prefix + '_issued_at'));
        // 2 hours
        if (_Date$now() < issuedAt + 2 * 60 * 60 * 1000) {
          var userInfo;
          var idUrl = localStorage.getItem(this._prefix + '_id');
          if (idUrl) {
            var _context4;
            var _idUrl$split$reverse = _reverseInstanceProperty(_context4 = idUrl.split('/')).call(_context4),
              _idUrl$split$reverse2 = _slicedToArray(_idUrl$split$reverse, 2),
              id = _idUrl$split$reverse2[0],
              organizationId = _idUrl$split$reverse2[1];
            userInfo = {
              id: id,
              organizationId: organizationId,
              url: idUrl
            };
          }
          return {
            accessToken: localStorage.getItem(this._prefix + '_access_token'),
            instanceUrl: localStorage.getItem(this._prefix + '_instance_url'),
            userInfo: userInfo
          };
        }
      }
      return null;
    }
    /**
     * @private
     */
  }, {
    key: "_storeTokens",
    value: function _storeTokens(params) {
      localStorage.setItem(this._prefix + '_access_token', params.access_token);
      localStorage.setItem(this._prefix + '_instance_url', params.instance_url);
      localStorage.setItem(this._prefix + '_issued_at', params.issued_at);
      localStorage.setItem(this._prefix + '_id', params.id);
      document.cookie = this._prefix + '_loggedin=true;';
    }
    /**
     * @private
     */
  }, {
    key: "_removeTokens",
    value: function _removeTokens() {
      localStorage.removeItem(this._prefix + '_access_token');
      localStorage.removeItem(this._prefix + '_instance_url');
      localStorage.removeItem(this._prefix + '_issued_at');
      localStorage.removeItem(this._prefix + '_id');
      document.cookie = this._prefix + '_loggedin=';
    }
    /**
     * @private
     */
  }, {
    key: "_getError",
    value: function _getError() {
      try {
        var _localStorage$getItem;
        var err = JSON.parse((_localStorage$getItem = localStorage.getItem(this._prefix + '_error')) !== null && _localStorage$getItem !== void 0 ? _localStorage$getItem : '');
        localStorage.removeItem(this._prefix + '_error');
        return err;
      } catch (e) {
        //
      }
    }
    /**
     * @private
     */
  }, {
    key: "_storeError",
    value: function _storeError(err) {
      localStorage.setItem(this._prefix + '_error', _JSON$stringify(err));
    }
  }, {
    key: "connection",
    get: function get() {
      if (!this._connection) {
        this._connection = new Connection(this._config);
      }
      return this._connection;
    }
  }]);
  return BrowserClient;
}(EventEmitter);

/**
 *
 */
var client = new BrowserClient();
export default client;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJFdmVudEVtaXR0ZXIiLCJxcyIsIkNvbm5lY3Rpb24iLCJPQXV0aDIiLCJwb3B1cFdpbiIsInVybCIsInciLCJoIiwiX2NvbnRleHQiLCJfY29udGV4dDIiLCJfY29udGV4dDMiLCJsZWZ0Iiwic2NyZWVuIiwid2lkdGgiLCJ0b3AiLCJoZWlnaHQiLCJ3aW5kb3ciLCJvcGVuIiwidW5kZWZpbmVkIiwiX2NvbmNhdEluc3RhbmNlUHJvcGVydHkiLCJjb25jYXQiLCJjYWxsIiwiaGFuZGxlQ2FsbGJhY2tSZXNwb25zZSIsInJlcyIsImNoZWNrQ2FsbGJhY2tSZXNwb25zZSIsInN0YXRlIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsImJvZHkiLCJyZW1vdmVJdGVtIiwiX3N0YXRlJHNwbGl0Iiwic3BsaXQiLCJfc3RhdGUkc3BsaXQyIiwiX3NsaWNlZFRvQXJyYXkiLCJwcmVmaXgiLCJwcm9tcHRUeXBlIiwiY2xpIiwiQnJvd3NlckNsaWVudCIsInN1Y2Nlc3MiLCJfc3RvcmVUb2tlbnMiLCJsb2NhdGlvbiIsImhhc2giLCJfc3RvcmVFcnJvciIsImNsb3NlIiwicGFyYW1zIiwicGFyc2UiLCJzdWJzdHJpbmciLCJhY2Nlc3NfdG9rZW4iLCJzZWFyY2giLCJlcnJvciIsIkRFRkFVTFRfUE9QVVBfV0lOX1dJRFRIIiwiREVGQVVMVF9QT1BVUF9XSU5fSEVJR0hUIiwiY2xpZW50SWR4IiwiX0V2ZW50RW1pdHRlciIsIl9pbmhlcml0cyIsIl9zdXBlciIsIl9jcmVhdGVTdXBlciIsIl90aGlzIiwiX2NsYXNzQ2FsbENoZWNrIiwiX2RlZmluZVByb3BlcnR5IiwiX2Fzc2VydFRoaXNJbml0aWFsaXplZCIsIl9wcmVmaXgiLCJfY3JlYXRlQ2xhc3MiLCJrZXkiLCJ2YWx1ZSIsImluaXQiLCJjb25maWciLCJfdGhpczIiLCJfY29uZmlnIiwidG9rZW5zIiwiX2dldFRva2VucyIsImNvbm5lY3Rpb24iLCJfZXN0YWJsaXNoIiwiX3NldFRpbWVvdXQiLCJlbWl0IiwibG9naW4iLCJfdGhpcyRfY29uZmlnIiwiX3NpemUkd2lkdGgiLCJfc2l6ZSRoZWlnaHQiLCJfdGhpczMiLCJvcHRpb25zIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwic2NvcGUiLCJzaXplIiwib2F1dGgyIiwicmFuZCIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsImpvaW4iLCJzZXRJdGVtIiwiYXV0aHpVcmwiLCJnZXRBdXRob3JpemF0aW9uVXJsIiwiX29iamVjdFNwcmVhZCIsInJlc3BvbnNlX3R5cGUiLCJwdyIsIl9Qcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImhyZWYiLCJfcmVtb3ZlVG9rZW5zIiwicGlkIiwiX3NldEludGVydmFsIiwiY2xvc2VkIiwiY2xlYXJJbnRlcnZhbCIsInN0YXR1cyIsImVyciIsIl9nZXRFcnJvciIsIkVycm9yIiwiZXJyb3JfZGVzY3JpcHRpb24iLCJlIiwiaXNMb2dnZWRJbiIsImFjY2Vzc1Rva2VuIiwibG9nb3V0IiwicmVnZXhwIiwiUmVnRXhwIiwiZG9jdW1lbnQiLCJjb29raWUiLCJtYXRjaCIsImlzc3VlZEF0IiwiTnVtYmVyIiwiX0RhdGUkbm93IiwidXNlckluZm8iLCJpZFVybCIsIl9jb250ZXh0NCIsIl9pZFVybCRzcGxpdCRyZXZlcnNlIiwiX3JldmVyc2VJbnN0YW5jZVByb3BlcnR5IiwiX2lkVXJsJHNwbGl0JHJldmVyc2UyIiwiaWQiLCJvcmdhbml6YXRpb25JZCIsImluc3RhbmNlVXJsIiwiaW5zdGFuY2VfdXJsIiwiaXNzdWVkX2F0IiwiX2xvY2FsU3RvcmFnZSRnZXRJdGVtIiwiSlNPTiIsIl9KU09OJHN0cmluZ2lmeSIsImdldCIsIl9jb25uZWN0aW9uIiwiY2xpZW50Il0sInNvdXJjZXMiOlsiLi4vLi4vc3JjL2Jyb3dzZXIvY2xpZW50LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgQnJvd3NlciBjbGllbnQgY29ubmVjdGlvbiBtYW5hZ2VtZW50IGNsYXNzXG4gKiBAYXV0aG9yIFNoaW5pY2hpIFRvbWl0YSA8c2hpbmljaGkudG9taXRhQGdtYWlsLmNvbT5cbiAqL1xuaW1wb3J0IHsgRXZlbnRFbWl0dGVyIH0gZnJvbSAnZXZlbnRzJztcbmltcG9ydCBxcyBmcm9tICdxdWVyeXN0cmluZyc7XG5pbXBvcnQgQ29ubmVjdGlvbiwgeyBDb25uZWN0aW9uQ29uZmlnIH0gZnJvbSAnLi4vY29ubmVjdGlvbic7XG5pbXBvcnQgT0F1dGgyLCB7IFRva2VuUmVzcG9uc2UgfSBmcm9tICcuLi9vYXV0aDInO1xuXG4vKipcbiAqIEBwcml2YXRlXG4gKi9cbmZ1bmN0aW9uIHBvcHVwV2luKHVybDogc3RyaW5nLCB3OiBudW1iZXIsIGg6IG51bWJlcikge1xuICBjb25zdCBsZWZ0ID0gc2NyZWVuLndpZHRoIC8gMiAtIHcgLyAyO1xuICBjb25zdCB0b3AgPSBzY3JlZW4uaGVpZ2h0IC8gMiAtIGggLyAyO1xuICByZXR1cm4gd2luZG93Lm9wZW4oXG4gICAgdXJsLFxuICAgIHVuZGVmaW5lZCxcbiAgICBgbG9jYXRpb249eWVzLHRvb2xiYXI9bm8sc3RhdHVzPW5vLG1lbnViYXI9bm8sd2lkdGg9JHt3fSxoZWlnaHQ9JHtofSx0b3A9JHt0b3B9LGxlZnQ9JHtsZWZ0fWAsXG4gICk7XG59XG5cbi8qKlxuICogQHByaXZhdGVcbiAqL1xuZnVuY3Rpb24gaGFuZGxlQ2FsbGJhY2tSZXNwb25zZSgpIHtcbiAgY29uc3QgcmVzID0gY2hlY2tDYWxsYmFja1Jlc3BvbnNlKCk7XG4gIGNvbnN0IHN0YXRlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2pzZm9yY2Vfc3RhdGUnKTtcbiAgaWYgKHJlcyAmJiBzdGF0ZSAmJiByZXMuYm9keS5zdGF0ZSA9PT0gc3RhdGUpIHtcbiAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnanNmb3JjZV9zdGF0ZScpO1xuICAgIGNvbnN0IFtwcmVmaXgsIHByb21wdFR5cGVdID0gc3RhdGUuc3BsaXQoJy4nKTtcbiAgICBjb25zdCBjbGkgPSBuZXcgQnJvd3NlckNsaWVudChwcmVmaXgpO1xuICAgIGlmIChyZXMuc3VjY2Vzcykge1xuICAgICAgY2xpLl9zdG9yZVRva2VucyhyZXMuYm9keSBhcyBUb2tlblJlc3BvbnNlKTtcbiAgICAgIGxvY2F0aW9uLmhhc2ggPSAnJztcbiAgICB9IGVsc2Uge1xuICAgICAgY2xpLl9zdG9yZUVycm9yKHJlcy5ib2R5KTtcbiAgICB9XG4gICAgaWYgKHByb21wdFR5cGUgPT09ICdwb3B1cCcpIHtcbiAgICAgIHdpbmRvdy5jbG9zZSgpO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufVxuXG4vKipcbiAqIEBwcml2YXRlXG4gKi9cbmZ1bmN0aW9uIGNoZWNrQ2FsbGJhY2tSZXNwb25zZSgpIHtcbiAgbGV0IHBhcmFtcztcbiAgaWYgKHdpbmRvdy5sb2NhdGlvbi5oYXNoKSB7XG4gICAgcGFyYW1zID0gcXMucGFyc2Uod2luZG93LmxvY2F0aW9uLmhhc2guc3Vic3RyaW5nKDEpKTtcbiAgICBpZiAocGFyYW1zLmFjY2Vzc190b2tlbikge1xuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYm9keTogcGFyYW1zIH07XG4gICAgfVxuICB9IGVsc2UgaWYgKHdpbmRvdy5sb2NhdGlvbi5zZWFyY2gpIHtcbiAgICBwYXJhbXMgPSBxcy5wYXJzZSh3aW5kb3cubG9jYXRpb24uc2VhcmNoLnN1YnN0cmluZygxKSk7XG4gICAgaWYgKHBhcmFtcy5lcnJvcikge1xuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGJvZHk6IHBhcmFtcyB9O1xuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqXG4gKi9cbmV4cG9ydCB0eXBlIExvZ2luT3B0aW9ucyA9IHtcbiAgc2NvcGU/OiBzdHJpbmc7XG4gIHNpemU/OiB7IHdpZHRoOiBudW1iZXI7IGhlaWdodDogbnVtYmVyIH07XG59O1xuXG4vKipcbiAqXG4gKi9cbmNvbnN0IERFRkFVTFRfUE9QVVBfV0lOX1dJRFRIID0gOTEyO1xuY29uc3QgREVGQVVMVF9QT1BVUF9XSU5fSEVJR0hUID0gNTEzO1xuXG4vKiogQHByaXZhdGUgKiovXG5sZXQgY2xpZW50SWR4ID0gMDtcblxuLyoqXG4gKlxuICovXG5leHBvcnQgY2xhc3MgQnJvd3NlckNsaWVudCBleHRlbmRzIEV2ZW50RW1pdHRlciB7XG4gIF9wcmVmaXg6IHN0cmluZztcbiAgX2NvbmZpZzogQ29ubmVjdGlvbkNvbmZpZyB8IHVuZGVmaW5lZDtcbiAgX2Nvbm5lY3Rpb246IENvbm5lY3Rpb24gfCB1bmRlZmluZWQ7XG5cbiAgLyoqXG4gICAqXG4gICAqL1xuICBjb25zdHJ1Y3RvcihwcmVmaXg/OiBzdHJpbmcpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuX3ByZWZpeCA9IHByZWZpeCB8fCAnanNmb3JjZScgKyBjbGllbnRJZHgrKztcbiAgfVxuXG4gIGdldCBjb25uZWN0aW9uKCk6IENvbm5lY3Rpb24ge1xuICAgIGlmICghdGhpcy5fY29ubmVjdGlvbikge1xuICAgICAgdGhpcy5fY29ubmVjdGlvbiA9IG5ldyBDb25uZWN0aW9uKHRoaXMuX2NvbmZpZyk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9jb25uZWN0aW9uO1xuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqL1xuICBpbml0KGNvbmZpZzogQ29ubmVjdGlvbkNvbmZpZykge1xuICAgIGlmIChoYW5kbGVDYWxsYmFja1Jlc3BvbnNlKCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5fY29uZmlnID0gY29uZmlnO1xuICAgIGNvbnN0IHRva2VucyA9IHRoaXMuX2dldFRva2VucygpO1xuICAgIGlmICh0b2tlbnMpIHtcbiAgICAgIHRoaXMuY29ubmVjdGlvbi5fZXN0YWJsaXNoKHRva2Vucyk7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdGhpcy5lbWl0KCdjb25uZWN0JywgdGhpcy5jb25uZWN0aW9uKTtcbiAgICAgIH0sIDEwKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICpcbiAgICovXG4gIGxvZ2luKG9wdGlvbnM6IExvZ2luT3B0aW9ucyA9IHt9KSB7XG4gICAgY29uc3QgeyBzY29wZSwgc2l6ZSB9ID0gb3B0aW9ucztcbiAgICBjb25zdCBvYXV0aDIgPSBuZXcgT0F1dGgyKHRoaXMuX2NvbmZpZyA/PyB7fSk7XG4gICAgY29uc3QgcmFuZCA9IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygyKTtcbiAgICBjb25zdCBzdGF0ZSA9IFt0aGlzLl9wcmVmaXgsICdwb3B1cCcsIHJhbmRdLmpvaW4oJy4nKTtcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnanNmb3JjZV9zdGF0ZScsIHN0YXRlKTtcbiAgICBjb25zdCBhdXRoelVybCA9IG9hdXRoMi5nZXRBdXRob3JpemF0aW9uVXJsKHtcbiAgICAgIHJlc3BvbnNlX3R5cGU6ICd0b2tlbicsXG4gICAgICBzdGF0ZSxcbiAgICAgIC4uLihzY29wZSA/IHsgc2NvcGUgfSA6IHt9KSxcbiAgICB9KTtcbiAgICBjb25zdCBwdyA9IHBvcHVwV2luKFxuICAgICAgYXV0aHpVcmwsXG4gICAgICBzaXplPy53aWR0aCA/PyBERUZBVUxUX1BPUFVQX1dJTl9XSURUSCxcbiAgICAgIHNpemU/LmhlaWdodCA/PyBERUZBVUxUX1BPUFVQX1dJTl9IRUlHSFQsXG4gICAgKTtcbiAgICByZXR1cm4gbmV3IFByb21pc2U8eyBzdGF0dXM6IHN0cmluZyB9PigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBpZiAoIXB3KSB7XG4gICAgICAgIGNvbnN0IHN0YXRlID0gW3RoaXMuX3ByZWZpeCwgJ3JlZGlyZWN0JywgcmFuZF0uam9pbignLicpO1xuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnanNmb3JjZV9zdGF0ZScsIHN0YXRlKTtcbiAgICAgICAgY29uc3QgYXV0aHpVcmwgPSBvYXV0aDIuZ2V0QXV0aG9yaXphdGlvblVybCh7XG4gICAgICAgICAgcmVzcG9uc2VfdHlwZTogJ3Rva2VuJyxcbiAgICAgICAgICBzdGF0ZSxcbiAgICAgICAgICAuLi4oc2NvcGUgPyB7IHNjb3BlIH0gOiB7fSksXG4gICAgICAgIH0pO1xuICAgICAgICBsb2NhdGlvbi5ocmVmID0gYXV0aHpVcmw7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMuX3JlbW92ZVRva2VucygpO1xuICAgICAgY29uc3QgcGlkID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGlmICghcHcgfHwgcHcuY2xvc2VkKSB7XG4gICAgICAgICAgICBjbGVhckludGVydmFsKHBpZCk7XG4gICAgICAgICAgICBjb25zdCB0b2tlbnMgPSB0aGlzLl9nZXRUb2tlbnMoKTtcbiAgICAgICAgICAgIGlmICh0b2tlbnMpIHtcbiAgICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uLl9lc3RhYmxpc2godG9rZW5zKTtcbiAgICAgICAgICAgICAgdGhpcy5lbWl0KCdjb25uZWN0JywgdGhpcy5jb25uZWN0aW9uKTtcbiAgICAgICAgICAgICAgcmVzb2x2ZSh7IHN0YXR1czogJ2Nvbm5lY3QnIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgY29uc3QgZXJyID0gdGhpcy5fZ2V0RXJyb3IoKTtcbiAgICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoZXJyLmVycm9yICsgJzogJyArIGVyci5lcnJvcl9kZXNjcmlwdGlvbikpO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc29sdmUoeyBzdGF0dXM6ICdjYW5jZWwnIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgLy9cbiAgICAgICAgfVxuICAgICAgfSwgMTAwMCk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICpcbiAgICovXG4gIGlzTG9nZ2VkSW4oKSB7XG4gICAgcmV0dXJuICEhdGhpcy5jb25uZWN0aW9uLmFjY2Vzc1Rva2VuO1xuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqL1xuICBsb2dvdXQoKSB7XG4gICAgdGhpcy5jb25uZWN0aW9uLmxvZ291dCgpO1xuICAgIHRoaXMuX3JlbW92ZVRva2VucygpO1xuICAgIHRoaXMuZW1pdCgnZGlzY29ubmVjdCcpO1xuICB9XG5cbiAgLyoqXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBfZ2V0VG9rZW5zKCkge1xuICAgIGNvbnN0IHJlZ2V4cCA9IG5ldyBSZWdFeHAoXG4gICAgICAnKF58O1xcXFxzKiknICsgdGhpcy5fcHJlZml4ICsgJ19sb2dnZWRpbj10cnVlKDt8JCknLFxuICAgICk7XG4gICAgaWYgKGRvY3VtZW50LmNvb2tpZS5tYXRjaChyZWdleHApKSB7XG4gICAgICBjb25zdCBpc3N1ZWRBdCA9IE51bWJlcihcbiAgICAgICAgbG9jYWxTdG9yYWdlLmdldEl0ZW0odGhpcy5fcHJlZml4ICsgJ19pc3N1ZWRfYXQnKSxcbiAgICAgICk7XG4gICAgICAvLyAyIGhvdXJzXG4gICAgICBpZiAoRGF0ZS5ub3coKSA8IGlzc3VlZEF0ICsgMiAqIDYwICogNjAgKiAxMDAwKSB7XG4gICAgICAgIGxldCB1c2VySW5mbztcbiAgICAgICAgY29uc3QgaWRVcmwgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSh0aGlzLl9wcmVmaXggKyAnX2lkJyk7XG4gICAgICAgIGlmIChpZFVybCkge1xuICAgICAgICAgIGNvbnN0IFtpZCwgb3JnYW5pemF0aW9uSWRdID0gaWRVcmwuc3BsaXQoJy8nKS5yZXZlcnNlKCk7XG4gICAgICAgICAgdXNlckluZm8gPSB7IGlkLCBvcmdhbml6YXRpb25JZCwgdXJsOiBpZFVybCB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYWNjZXNzVG9rZW46IGxvY2FsU3RvcmFnZS5nZXRJdGVtKHRoaXMuX3ByZWZpeCArICdfYWNjZXNzX3Rva2VuJyksXG4gICAgICAgICAgaW5zdGFuY2VVcmw6IGxvY2FsU3RvcmFnZS5nZXRJdGVtKHRoaXMuX3ByZWZpeCArICdfaW5zdGFuY2VfdXJsJyksXG4gICAgICAgICAgdXNlckluZm8sXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBfc3RvcmVUb2tlbnMocGFyYW1zOiBUb2tlblJlc3BvbnNlKSB7XG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0odGhpcy5fcHJlZml4ICsgJ19hY2Nlc3NfdG9rZW4nLCBwYXJhbXMuYWNjZXNzX3Rva2VuKTtcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0aGlzLl9wcmVmaXggKyAnX2luc3RhbmNlX3VybCcsIHBhcmFtcy5pbnN0YW5jZV91cmwpO1xuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHRoaXMuX3ByZWZpeCArICdfaXNzdWVkX2F0JywgcGFyYW1zLmlzc3VlZF9hdCk7XG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0odGhpcy5fcHJlZml4ICsgJ19pZCcsIHBhcmFtcy5pZCk7XG4gICAgZG9jdW1lbnQuY29va2llID0gdGhpcy5fcHJlZml4ICsgJ19sb2dnZWRpbj10cnVlOyc7XG4gIH1cblxuICAvKipcbiAgICogQHByaXZhdGVcbiAgICovXG4gIF9yZW1vdmVUb2tlbnMoKSB7XG4gICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0odGhpcy5fcHJlZml4ICsgJ19hY2Nlc3NfdG9rZW4nKTtcbiAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSh0aGlzLl9wcmVmaXggKyAnX2luc3RhbmNlX3VybCcpO1xuICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKHRoaXMuX3ByZWZpeCArICdfaXNzdWVkX2F0Jyk7XG4gICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0odGhpcy5fcHJlZml4ICsgJ19pZCcpO1xuICAgIGRvY3VtZW50LmNvb2tpZSA9IHRoaXMuX3ByZWZpeCArICdfbG9nZ2VkaW49JztcbiAgfVxuXG4gIC8qKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgX2dldEVycm9yKCkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBlcnIgPSBKU09OLnBhcnNlKFxuICAgICAgICBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSh0aGlzLl9wcmVmaXggKyAnX2Vycm9yJykgPz8gJycsXG4gICAgICApO1xuICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0odGhpcy5fcHJlZml4ICsgJ19lcnJvcicpO1xuICAgICAgcmV0dXJuIGVycjtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAvL1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgX3N0b3JlRXJyb3IoZXJyOiBhbnkpIHtcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0aGlzLl9wcmVmaXggKyAnX2Vycm9yJywgSlNPTi5zdHJpbmdpZnkoZXJyKSk7XG4gIH1cbn1cblxuLyoqXG4gKlxuICovXG5jb25zdCBjbGllbnQgPSBuZXcgQnJvd3NlckNsaWVudCgpO1xuXG5leHBvcnQgZGVmYXVsdCBjbGllbnQ7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVNBLFlBQVksUUFBUSxRQUFRO0FBQ3JDLE9BQU9DLEVBQUUsTUFBTSxhQUFhO0FBQzVCLE9BQU9DLFVBQVUsTUFBNEIsZUFBZTtBQUM1RCxPQUFPQyxNQUFNLE1BQXlCLFdBQVc7O0FBRWpEO0FBQ0E7QUFDQTtBQUNBLFNBQVNDLFFBQVFBLENBQUNDLEdBQVcsRUFBRUMsQ0FBUyxFQUFFQyxDQUFTLEVBQUU7RUFBQSxJQUFBQyxRQUFBLEVBQUFDLFNBQUEsRUFBQUMsU0FBQTtFQUNuRCxJQUFNQyxJQUFJLEdBQUdDLE1BQU0sQ0FBQ0MsS0FBSyxHQUFHLENBQUMsR0FBR1AsQ0FBQyxHQUFHLENBQUM7RUFDckMsSUFBTVEsR0FBRyxHQUFHRixNQUFNLENBQUNHLE1BQU0sR0FBRyxDQUFDLEdBQUdSLENBQUMsR0FBRyxD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